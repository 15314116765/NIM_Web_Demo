!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.NRTC=t():e.NRTC=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(99),o=n(i),a=r(359),s=n(a),c=r(49),u=r(67),d=r(310),l=n(d),p="5.0.0",f="3.9.0";r(112),t["default"]=(0,o["default"])({version:p,versionRtc:f},c.constantRtc,u.RtcSupport,l["default"],{getInstance:function(e){return new s["default"](e)},destroy:function(e){e&&(e.destroy(),e=null)}}),e.exports=t["default"]},,function(e,t){var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(e,t,r){var n=r(35)("wks"),i=r(22),o=r(2).Symbol,a="function"==typeof o,s=e.exports=function(e){return n[e]||(n[e]=a&&o[e]||(a?o:i)("Symbol."+e))};s.store=n},function(e,t,r){(function(t){"use strict";var r="'a8127541deb97f1499a6e47e6f8a199a894d782b",n="a812754'",i="5.0.0",o="2.6.0.328",a="3.9.0",s="46",c="1",u=1,d="https://lbs.netease.im/lbs/webconf.jsp",l="roomserver.netease.im",p="https://dr.netease.im/1.gif",f="development"===t.env.NODE_ENV?6e3:42e3,h={info:{hash:r,shortHash:n,version:i,sdkVersion:s,nrtcVersion:a,nrtcSdkVersion:c,protocolVersion:u},agentVersion:o,lbsUrl:d,roomserver:l,connectTimeout:f,xhrTimeout:f,socketTimeout:f,reconnectionDelay:656.25,reconnectionDelayMax:f,reconnectionJitter:.1,heartbeatInterval:18e4,cmdTimeout:f,defaultReportUrl:p};h.formatSocketUrl=function(e){var t=e.url,r=e.secure,n=r?"https":"http";return t.indexOf("http")===-1?n+"://"+t:t},h.uploadUrl="https://nos.netease.com",h.replaceUrl="https://{bucket}.nosdn.127.net/{object}",h.downloadHost="nos.netease.com",h.downloadUrl="https://{bucket}.nosdn.127.net/{object}",h.httpsEnabled=!1,h.genUploadUrl=function(e){return h.uploadUrl+"/"+e},h.genDownloadUrl=function(e,t){var r=h.replaceUrl;return/^http/.test(r)?h.httpsEnabled&&(r=r.replace("http","https")):r=h.httpsEnabled?"https://"+r:"http://"+r,r.replace("{bucket}",e).replace("{object}",t)},e.exports=h}).call(t,r(31))},function(e,t,r){(function(t,n){/*!
	 * @overview es6-promise - a tiny implementation of Promises/A+.
	 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
	 * @license   Licensed under MIT license
	 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
	 * @version   4.0.5
	 */
!function(t,r){e.exports=r()}(this,function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function i(e){return"function"==typeof e}function o(e){Q=e}function a(e){$=e}function s(){return function(){return t.nextTick(p)}}function c(){return"undefined"!=typeof J?function(){J(p)}:l()}function u(){var e=0,t=new Z(p),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}function d(){var e=new MessageChannel;return e.port1.onmessage=p,function(){return e.port2.postMessage(0)}}function l(){var e=setTimeout;return function(){return e(p,1)}}function p(){for(var e=0;e<K;e+=2){var t=re[e],r=re[e+1];t(r),re[e]=void 0,re[e+1]=void 0}K=0}function f(){try{var e=r(96);return J=e.runOnLoop||e.runOnContext,c()}catch(t){return l()}}function h(e,t){var r=arguments,n=this,i=new this.constructor(v);void 0===i[ie]&&L(i);var o=n._state;return o?!function(){var e=r[o-1];$(function(){return x(o,i,e,n._result)})}():P(n,i,e,t),i}function m(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var r=new t(v);return w(r,e),r}function v(){}function g(){return new TypeError("You cannot resolve a promise with itself")}function y(){return new TypeError("A promises callback cannot return that same promise.")}function S(e){try{return e.then}catch(t){return ce.error=t,ce}}function b(e,t,r,n){try{e.call(t,r,n)}catch(i){return i}}function _(e,t,r){$(function(e){var n=!1,i=b(r,t,function(r){n||(n=!0,t!==r?w(e,r):E(e,r))},function(t){n||(n=!0,O(e,t))},"Settle: "+(e._label||" unknown promise"));!n&&i&&(n=!0,O(e,i))},e)}function C(e,t){t._state===ae?E(e,t._result):t._state===se?O(e,t._result):P(t,void 0,function(t){return w(e,t)},function(t){return O(e,t)})}function T(e,t,r){t.constructor===e.constructor&&r===h&&t.constructor.resolve===m?C(e,t):r===ce?O(e,ce.error):void 0===r?E(e,t):i(r)?_(e,t,r):E(e,t)}function w(t,r){t===r?O(t,g()):e(r)?T(t,r,S(r)):E(t,r)}function R(e){e._onerror&&e._onerror(e._result),k(e)}function E(e,t){e._state===oe&&(e._result=t,e._state=ae,0!==e._subscribers.length&&$(k,e))}function O(e,t){e._state===oe&&(e._state=se,e._result=t,$(R,e))}function P(e,t,r,n){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+ae]=r,i[o+se]=n,0===o&&e._state&&$(k,e)}function k(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n=void 0,i=void 0,o=e._result,a=0;a<t.length;a+=3)n=t[a],i=t[a+r],n?x(r,n,i,o):i(o);e._subscribers.length=0}}function I(){this.error=null}function A(e,t){try{return e(t)}catch(r){return ue.error=r,ue}}function x(e,t,r,n){var o=i(r),a=void 0,s=void 0,c=void 0,u=void 0;if(o){if(a=A(r,n),a===ue?(u=!0,s=a.error,a=null):c=!0,t===a)return void O(t,y())}else a=n,c=!0;t._state!==oe||(o&&c?w(t,a):u?O(t,s):e===ae?E(t,a):e===se&&O(t,a))}function M(e,t){try{t(function(t){w(e,t)},function(t){O(e,t)})}catch(r){O(e,r)}}function D(){return de++}function L(e){e[ie]=de++,e._state=void 0,e._result=void 0,e._subscribers=[]}function j(e,t){this._instanceConstructor=e,this.promise=new e(v),this.promise[ie]||L(this.promise),z(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?E(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&E(this.promise,this._result))):O(this.promise,N())}function N(){return new Error("Array Methods must be provided an Array")}function V(e){return new j(this,e).promise}function U(e){var t=this;return new t(z(e)?function(r,n){for(var i=e.length,o=0;o<i;o++)t.resolve(e[o]).then(r,n)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function F(e){var t=this,r=new t(v);return O(r,e),r}function B(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function G(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function W(e){this[ie]=D(),this._result=this._state=void 0,this._subscribers=[],v!==e&&("function"!=typeof e&&B(),this instanceof W?M(this,e):G())}function H(){var e=void 0;if("undefined"!=typeof n)e=n;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var r=e.Promise;if(r){var i=null;try{i=Object.prototype.toString.call(r.resolve())}catch(t){}if("[object Promise]"===i&&!r.cast)return}e.Promise=W}var Y=void 0;Y=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var z=Y,K=0,J=void 0,Q=void 0,$=function(e,t){re[K]=e,re[K+1]=t,K+=2,2===K&&(Q?Q(p):ne())},q="undefined"!=typeof window?window:void 0,X=q||{},Z=X.MutationObserver||X.WebKitMutationObserver,ee="undefined"==typeof self&&"undefined"!=typeof t&&"[object process]"==={}.toString.call(t),te="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,re=new Array(1e3),ne=void 0;ne=ee?s():Z?u():te?d():void 0===q?f():l();var ie=Math.random().toString(36).substring(16),oe=void 0,ae=1,se=2,ce=new I,ue=new I,de=0;return j.prototype._enumerate=function(){for(var e=this.length,t=this._input,r=0;this._state===oe&&r<e;r++)this._eachEntry(t[r],r)},j.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===m){var i=S(e);if(i===h&&e._state!==oe)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(r===W){var o=new r(v);T(o,e,i),this._willSettleAt(o,t)}else this._willSettleAt(new r(function(t){return t(e)}),t)}else this._willSettleAt(n(e),t)},j.prototype._settledAt=function(e,t,r){var n=this.promise;n._state===oe&&(this._remaining--,e===se?O(n,r):this._result[t]=r),0===this._remaining&&E(n,this._result)},j.prototype._willSettleAt=function(e,t){var r=this;P(e,void 0,function(e){return r._settledAt(ae,t,e)},function(e){return r._settledAt(se,t,e)})},W.all=V,W.race=U,W.resolve=m,W.reject=F,W._setScheduler=o,W._setAsap=a,W._asap=$,W.prototype={constructor:W,then:h,"catch":function(e){return this.then(null,e)}},W.polyfill=H,W.Promise=W,W})}).call(t,r(31),function(){return this}())},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t){"use strict";t.__esModule=!0,t["default"]=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,r){e.exports=!r(19)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,r){var n=r(10),i=r(21);e.exports=r(8)?function(e,t,r){return n.f(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){var n=r(14),i=r(51),o=r(37),a=Object.defineProperty;t.f=r(8)?Object.defineProperty:function(e,t,r){if(n(e),t=o(t,!0),n(r),i)try{return a(e,t,r)}catch(s){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},function(e,t){var r=e.exports={version:"2.5.3"};"number"==typeof __e&&(__e=r)},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,r){var n=r(58),i=r(32);e.exports=function(e){return n(i(e))}},function(e,t,r){var n=r(12);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(76),o=n(i),a=r(75),s=n(a),c="function"==typeof s["default"]&&"symbol"==typeof o["default"]?function(e){return typeof e}:function(e){return e&&"function"==typeof s["default"]&&e.constructor===s["default"]&&e!==s["default"].prototype?"symbol":typeof e};t["default"]="function"==typeof s["default"]&&"symbol"===c(o["default"])?function(e){return"undefined"==typeof e?"undefined":c(e)}:function(e){return e&&"function"==typeof s["default"]&&e.constructor===s["default"]&&e!==s["default"].prototype?"symbol":"undefined"==typeof e?"undefined":c(e)}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(122),o=n(i),a=r(121),s=n(a),c=r(15),u=n(c);t["default"]=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":(0,u["default"])(t)));e.prototype=(0,s["default"])(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(o["default"]?(0,o["default"])(e,t):e.__proto__=t)}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(15),o=n(i);t["default"]=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":(0,o["default"])(t))&&"function"!=typeof t?e:t}},function(e,t,r){var n=r(2),i=r(11),o=r(45),a=r(9),s="prototype",c=function(e,t,r){var u,d,l,p=e&c.F,f=e&c.G,h=e&c.S,m=e&c.P,v=e&c.B,g=e&c.W,y=f?i:i[t]||(i[t]={}),S=y[s],b=f?n:h?n[t]:(n[t]||{})[s];f&&(r=t);for(u in r)d=!p&&b&&void 0!==b[u],d&&u in y||(l=d?b[u]:r[u],y[u]=f&&"function"!=typeof b[u]?r[u]:v&&d?o(l,n):g&&b[u]==l?function(e){var t=function(t,r,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,n)}return e.apply(this,arguments)};return t[s]=e[s],t}(l):m&&"function"==typeof l?o(Function.call,l):l,m&&((y.virtual||(y.virtual={}))[u]=l,e&c.R&&S&&!S[u]&&a(S,u,l)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},function(e,t){e.exports=function(e){try{return!!e()}catch(t){return!0}}},function(e,t,r){"use strict";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(){this._events=new n,this._eventsCount=0}var a=Object.prototype.hasOwnProperty,s="~";Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(s=!1)),o.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)a.call(e,t)&&r.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},o.prototype.listeners=function(e,t){var r=s?s+e:e,n=this._events[r];if(t)return!!n;if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,a=new Array(o);i<o;i++)a[i]=n[i].fn;return a},o.prototype.emit=function(e,t,r,n,i,o){var a=s?s+e:e;if(!this._events[a])return!1;var c,u,d=this._events[a],l=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),l){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,r),!0;case 4:return d.fn.call(d.context,t,r,n),!0;case 5:return d.fn.call(d.context,t,r,n,i),!0;case 6:return d.fn.call(d.context,t,r,n,i,o),!0}for(u=1,c=new Array(l-1);u<l;u++)c[u-1]=arguments[u];d.fn.apply(d.context,c)}else{var p,f=d.length;for(u=0;u<f;u++)switch(d[u].once&&this.removeListener(e,d[u].fn,void 0,!0),l){case 1:d[u].fn.call(d[u].context);break;case 2:d[u].fn.call(d[u].context,t);break;case 3:d[u].fn.call(d[u].context,t,r);break;case 4:d[u].fn.call(d[u].context,t,r,n);break;default:if(!c)for(p=1,c=new Array(l-1);p<l;p++)c[p-1]=arguments[p];d[u].fn.apply(d[u].context,c)}}return!0},o.prototype.on=function(e,t,r){var n=new i(t,r||this),o=s?s+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],n]:this._events[o].push(n):(this._events[o]=n,this._eventsCount++),this},o.prototype.once=function(e,t,r){var n=new i(t,r||this,!0),o=s?s+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],n]:this._events[o].push(n):(this._events[o]=n,this._eventsCount++),this},o.prototype.removeListener=function(e,t,r,i){var o=s?s+e:e;if(!this._events[o])return this;if(!t)return 0===--this._eventsCount?this._events=new n:delete this._events[o],this;var a=this._events[o];if(a.fn)a.fn!==t||i&&!a.once||r&&a.context!==r||(0===--this._eventsCount?this._events=new n:delete this._events[o]);else{for(var c=0,u=[],d=a.length;c<d;c++)(a[c].fn!==t||i&&!a[c].once||r&&a[c].context!==r)&&u.push(a[c]);u.length?this._events[o]=1===u.length?u[0]:u:0===--this._eventsCount?this._events=new n:delete this._events[o]}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&(0===--this._eventsCount?this._events=new n:delete this._events[t])):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prototype.setMaxListeners=function(){return this},o.prefixed=s,o.EventEmitter=o,e.exports=o},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){var r=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+n).toString(36))}},,function(e,t,r){var n=r(54),i=r(33);e.exports=Object.keys||function(e){return n(e,i)}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t){e.exports={}},,,function(e,t){e.exports=!0},function(e,t,r){var n=r(10).f,i=r(6),o=r(3)("toStringTag");e.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,o)&&n(e,o,{configurable:!0,value:t})}},function(e,t){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function i(e){if(d===setTimeout)return setTimeout(e,0);if((d===r||!d)&&setTimeout)return d=setTimeout,setTimeout(e,0);try{return d(e,0)}catch(t){try{return d.call(null,e,0)}catch(t){return d.call(this,e,0)}}}function o(e){if(l===clearTimeout)return clearTimeout(e);if((l===n||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(e);try{return l(e)}catch(t){try{return l.call(null,e)}catch(t){return l.call(this,e)}}}function a(){m&&f&&(m=!1,f.length?h=f.concat(h):v=-1,h.length&&s())}function s(){if(!m){var e=i(a);m=!0;for(var t=h.length;t;){for(f=h,h=[];++v<t;)f&&f[v].run();v=-1,t=h.length}f=null,m=!1,o(e)}}function c(e,t){this.fun=e,this.array=t}function u(){}var d,l,p=e.exports={};!function(){try{d="function"==typeof setTimeout?setTimeout:r}catch(e){d=r}try{l="function"==typeof clearTimeout?clearTimeout:n}catch(e){l=n}}();var f,h=[],m=!1,v=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];h.push(new c(e,t)),1!==h.length||m||i(s)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=u,p.addListener=u,p.once=u,p.off=u,p.removeListener=u,p.removeAllListeners=u,p.emit=u,p.prependListener=u,p.prependOnceListener=u,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,r){var n=r(35)("keys"),i=r(22);e.exports=function(e){return n[e]||(n[e]=i(e))}},function(e,t,r){var n=r(2),i="__core-js_shared__",o=n[i]||(n[i]={});e.exports=function(e){return o[e]||(o[e]={})}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t,r){var n=r(12);e.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,r){var n=r(2),i=r(11),o=r(29),a=r(39),s=r(10).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:n.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:a.f(e)})}},function(e,t,r){t.f=r(3)},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(109);Object.defineProperty(t,"ajax",{enumerable:!0,get:function(){return n(i)["default"]}});var o=r(118);Object.defineProperty(t,"element",{enumerable:!0,get:function(){return n(o)["default"]}});var a=r(110);Object.defineProperty(t,"tool",{enumerable:!0,get:function(){return n(a)["default"]}})},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){var n=r(14),i=r(86),o=r(33),a=r(34)("IE_PROTO"),s=function(){},c="prototype",u=function(){var e,t=r(47)("iframe"),n=o.length,i="<",a=">";for(t.style.display="none",r(68).appendChild(t),t.src="javascript:",e=t.contentWindow.document,e.open(),e.write(i+"script"+a+"document.F=Object"+i+"/script"+a),e.close(),u=e.F;n--;)delete u[c][o[n]];return u()};e.exports=Object.create||function(e,t){var r;return null!==e?(s[c]=n(e),r=new s,s[c]=null,r[a]=e):r=u(),void 0===t?r:i(r,t)}},function(e,t){t.f=Object.getOwnPropertySymbols},,function(e,t,r){var n=r(56);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){var n;(function(e,i){(function(){"use strict";function o(e){return e=String(e),e.charAt(0).toUpperCase()+e.slice(1)}function a(e,t,r){var n={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&r&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(n=n[/[\d.]+$/.exec(e)])&&(e="Windows "+n),e=String(e),t&&r&&(e=e.replace(RegExp(t,"i"),r)),e=c(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}function s(e,t){var r=-1,n=e?e.length:0;if("number"==typeof n&&n>-1&&n<=_)for(;++r<n;)t(e[r],r,e);else u(e,t)}function c(e){return e=h(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:o(e)}function u(e,t){for(var r in e)w.call(e,r)&&t(e[r],r,e)}function d(e){return null==e?o(e):R.call(e).slice(8,-1)}function l(e,t){var r=null!=e?typeof e[t]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(r)||"object"==r&&!e[t])}function p(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function f(e,t){var r=null;return s(e,function(n,i){r=t(r,n,i,e)}),r}function h(e){return String(e).replace(/^ +| +$/g,"")}function m(e){function t(t){return f(t,function(t,r){return t||RegExp("\\b"+(r.pattern||p(r))+"\\b","i").exec(e)&&(r.label||r)})}function r(t){return f(t,function(t,r,n){return t||(r[z]||r[/^[a-z]+(?: +[a-z]+\b)*/i.exec(z)]||RegExp("\\b"+p(n)+"(?:\\b|\\w*\\d)","i").exec(e))&&n})}function n(t){return f(t,function(t,r){return t||RegExp("\\b"+(r.pattern||p(r))+"\\b","i").exec(e)&&(r.label||r)})}function i(t){return f(t,function(t,r){var n=r.pattern||p(r);return!t&&(t=RegExp("\\b"+n+"(?:/[\\d.]+|[ \\w.]*)","i").exec(e))&&(t=a(t,n,r.label||r)),t})}function o(t){return f(t,function(t,r){var n=r.pattern||p(r);return!t&&(t=RegExp("\\b"+n+" *\\d+[.\\w_]*","i").exec(e)||RegExp("\\b"+n+" *\\w+-[\\w]*","i").exec(e)||RegExp("\\b"+n+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(e))&&((t=String(r.label&&!RegExp(n,"i").test(r.label)?r.label:t).split("/"))[1]&&!/[\d.]+/.test(t[0])&&(t[0]+=" "+t[1]),r=r.label||r,t=c(t[0].replace(RegExp(n,"i"),r).replace(RegExp("; *(?:"+r+"[_-])?","i")," ").replace(RegExp("("+r+")[-_.]?(\\w)","i"),"$1 $2"))),t})}function s(t){return f(t,function(t,r){return t||(RegExp(r+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(e)||0)[1]||null})}function v(){return this.description||""}var y=g,S=e&&"object"==typeof e&&"String"!=d(e);S&&(y=e,e=null);var b=y.navigator||{},_=b.userAgent||"";e||(e=_);var T,w,E=S?!!b.likeChrome:/\bChrome\b/.test(e)&&!/internal|\n/i.test(R.toString()),O="Object",P=S?O:"ScriptBridgingProxyObject",k=S?O:"Environment",I=S&&y.java?"JavaPackage":d(y.java),A=S?O:"RuntimeObject",x=/\bJava/.test(I)&&y.java,M=x&&d(y.environment)==k,D=x?"a":"α",L=x?"b":"β",j=y.document||{},N=y.operamini||y.opera,V=C.test(V=S&&N?N["[[Class]]"]:d(N))?V:N=null,U=e,F=[],B=null,G=e==_,W=G&&N&&"function"==typeof N.version&&N.version(),H=t([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),Y=n(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),z=o([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),K=r({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),J=i(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);if(H&&(H=[H]),K&&!z&&(z=o([K])),(T=/\bGoogle TV\b/.exec(z))&&(z=T[0]),/\bSimulator\b/i.test(e)&&(z=(z?z+" ":"")+"Simulator"),"Opera Mini"==Y&&/\bOPiOS\b/.test(e)&&F.push("running in Turbo/Uncompressed mode"),"IE"==Y&&/\blike iPhone OS\b/.test(e)?(T=m(e.replace(/like iPhone OS/,"")),K=T.manufacturer,z=T.product):/^iP/.test(z)?(Y||(Y="Safari"),J="iOS"+((T=/ OS ([\d_]+)/i.exec(e))?" "+T[1].replace(/_/g,"."):"")):"Konqueror"!=Y||/buntu/i.test(J)?K&&"Google"!=K&&(/Chrome/.test(Y)&&!/\bMobile Safari\b/i.test(e)||/\bVita\b/.test(z))||/\bAndroid\b/.test(J)&&/^Chrome/.test(Y)&&/\bVersion\//i.test(e)?(Y="Android Browser",J=/\bAndroid\b/.test(J)?J:"Android"):"Silk"==Y?(/\bMobi/i.test(e)||(J="Android",F.unshift("desktop mode")),/Accelerated *= *true/i.test(e)&&F.unshift("accelerated")):"PaleMoon"==Y&&(T=/\bFirefox\/([\d.]+)\b/.exec(e))?F.push("identifying as Firefox "+T[1]):"Firefox"==Y&&(T=/\b(Mobile|Tablet|TV)\b/i.exec(e))?(J||(J="Firefox OS"),z||(z=T[1])):!Y||(T=!/\bMinefield\b/i.test(e)&&/\b(?:Firefox|Safari)\b/.exec(Y))?(Y&&!z&&/[\/,]|^[^(]+?\)/.test(e.slice(e.indexOf(T+"/")+8))&&(Y=null),(T=z||K||J)&&(z||K||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(J))&&(Y=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(J)?J:T)+" Browser")):"Electron"==Y&&(T=(/\bChrome\/([\d.]+)\b/.exec(e)||0)[1])&&F.push("Chromium "+T):J="Kubuntu",W||(W=s(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",p(Y),"(?:Firefox|Minefield|NetFront)"])),(T="iCab"==H&&parseFloat(W)>3&&"WebKit"||/\bOpera\b/.test(Y)&&(/\bOPR\b/.test(e)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(e)&&!/^(?:Trident|EdgeHTML)$/.test(H)&&"WebKit"||!H&&/\bMSIE\b/i.test(e)&&("Mac OS"==J?"Tasman":"Trident")||"WebKit"==H&&/\bPlayStation\b(?! Vita\b)/i.test(Y)&&"NetFront")&&(H=[T]),"IE"==Y&&(T=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(e)||0)[1])?(Y+=" Mobile",J="Windows Phone "+(/\+$/.test(T)?T:T+".x"),F.unshift("desktop mode")):/\bWPDesktop\b/i.test(e)?(Y="IE Mobile",J="Windows Phone 8.x",F.unshift("desktop mode"),W||(W=(/\brv:([\d.]+)/.exec(e)||0)[1])):"IE"!=Y&&"Trident"==H&&(T=/\brv:([\d.]+)/.exec(e))&&(Y&&F.push("identifying as "+Y+(W?" "+W:"")),Y="IE",W=T[1]),G){if(l(y,"global"))if(x&&(T=x.lang.System,U=T.getProperty("os.arch"),J=J||T.getProperty("os.name")+" "+T.getProperty("os.version")),M){try{W=y.require("ringo/engine").version.join("."),Y="RingoJS"}catch(Q){(T=y.system)&&T.global.system==y.system&&(Y="Narwhal",J||(J=T[0].os||null))}Y||(Y="Rhino")}else"object"==typeof y.process&&!y.process.browser&&(T=y.process)&&("object"==typeof T.versions&&("string"==typeof T.versions.electron?(F.push("Node "+T.versions.node),Y="Electron",W=T.versions.electron):"string"==typeof T.versions.nw&&(F.push("Chromium "+W,"Node "+T.versions.node),Y="NW.js",W=T.versions.nw)),Y||(Y="Node.js",U=T.arch,J=T.platform,W=/[\d.]+/.exec(T.version),W=W?W[0]:null));else d(T=y.runtime)==P?(Y="Adobe AIR",J=T.flash.system.Capabilities.os):d(T=y.phantom)==A?(Y="PhantomJS",W=(T=T.version||null)&&T.major+"."+T.minor+"."+T.patch):"number"==typeof j.documentMode&&(T=/\bTrident\/(\d+)/i.exec(e))?(W=[W,j.documentMode],(T=+T[1]+4)!=W[1]&&(F.push("IE "+W[1]+" mode"),H&&(H[1]=""),W[1]=T),W="IE"==Y?String(W[1].toFixed(1)):W[0]):"number"==typeof j.documentMode&&/^(?:Chrome|Firefox)\b/.test(Y)&&(F.push("masking as "+Y+" "+W),Y="IE",W="11.0",H=["Trident"],J="Windows");J=J&&c(J)}if(W&&(T=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(W)||/(?:alpha|beta)(?: ?\d)?/i.exec(e+";"+(G&&b.appMinorVersion))||/\bMinefield\b/i.test(e)&&"a")&&(B=/b/i.test(T)?"beta":"alpha",W=W.replace(RegExp(T+"\\+?$"),"")+("beta"==B?L:D)+(/\d+\+?/.exec(T)||"")),"Fennec"==Y||"Firefox"==Y&&/\b(?:Android|Firefox OS)\b/.test(J))Y="Firefox Mobile";else if("Maxthon"==Y&&W)W=W.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(z))"Xbox 360"==z&&(J=null),"Xbox 360"==z&&/\bIEMobile\b/.test(e)&&F.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(Y)&&(!Y||z||/Browser|Mobi/.test(Y))||"Windows CE"!=J&&!/Mobi/i.test(e))if("IE"==Y&&G)try{null===y.external&&F.unshift("platform preview")}catch(Q){F.unshift("embedded")}else(/\bBlackBerry\b/.test(z)||/\bBB10\b/.test(e))&&(T=(RegExp(z.replace(/ +/g," *")+"/([.\\d]+)","i").exec(e)||0)[1]||W)?(T=[T,/BB10/.test(e)],J=(T[1]?(z=null,K="BlackBerry"):"Device Software")+" "+T[0],W=null):this!=u&&"Wii"!=z&&(G&&N||/Opera/.test(Y)&&/\b(?:MSIE|Firefox)\b/i.test(e)||"Firefox"==Y&&/\bOS X (?:\d+\.){2,}/.test(J)||"IE"==Y&&(J&&!/^Win/.test(J)&&W>5.5||/\bWindows XP\b/.test(J)&&W>8||8==W&&!/\bTrident\b/.test(e)))&&!C.test(T=m.call(u,e.replace(C,"")+";"))&&T.name&&(T="ing as "+T.name+((T=T.version)?" "+T:""),C.test(Y)?(/\bIE\b/.test(T)&&"Mac OS"==J&&(J=null),T="identify"+T):(T="mask"+T,Y=V?c(V.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(T)&&(J=null),G||(W=null)),H=["Presto"],F.push(T));else Y+=" Mobile";(T=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(e)||0)[1])&&(T=[parseFloat(T.replace(/\.(\d)$/,".0$1")),T],"Safari"==Y&&"+"==T[1].slice(-1)?(Y="WebKit Nightly",B="alpha",W=T[1].slice(0,-1)):W!=T[1]&&W!=(T[2]=(/\bSafari\/([\d.]+\+?)/i.exec(e)||0)[1])||(W=null),T[1]=(/\bChrome\/([\d.]+)/i.exec(e)||0)[1],537.36==T[0]&&537.36==T[2]&&parseFloat(T[1])>=28&&"WebKit"==H&&(H=["Blink"]),G&&(E||T[1])?(H&&(H[1]="like Chrome"),T=T[1]||(T=T[0],T<530?1:T<532?2:T<532.05?3:T<533?4:T<534.03?5:T<534.07?6:T<534.1?7:T<534.13?8:T<534.16?9:T<534.24?10:T<534.3?11:T<535.01?12:T<535.02?"13+":T<535.07?15:T<535.11?16:T<535.19?17:T<536.05?18:T<536.1?19:T<537.01?20:T<537.11?"21+":T<537.13?23:T<537.18?24:T<537.24?25:T<537.36?26:"Blink"!=H?"27":"28")):(H&&(H[1]="like Safari"),T=T[0],T=T<400?1:T<500?2:T<526?3:T<533?4:T<534?"4+":T<535?5:T<537?6:T<538?7:T<601?8:"8"),H&&(H[1]+=" "+(T+="number"==typeof T?".x":/[.+]/.test(T)?"":"+")),"Safari"==Y&&(!W||parseInt(W)>45)&&(W=T)),"Opera"==Y&&(T=/\bzbov|zvav$/.exec(J))?(Y+=" ",F.unshift("desktop mode"),"zvav"==T?(Y+="Mini",W=null):Y+="Mobile",J=J.replace(RegExp(" *"+T+"$"),"")):"Safari"==Y&&/\bChrome\b/.exec(H&&H[1])&&(F.unshift("desktop mode"),Y="Chrome Mobile",W=null,/\bOS X\b/.test(J)?(K="Apple",J="iOS 4.3+"):J=null),W&&0==W.indexOf(T=/[\d.]+$/.exec(J))&&e.indexOf("/"+T+"-")>-1&&(J=h(J.replace(T,""))),H&&!/\b(?:Avant|Nook)\b/.test(Y)&&(/Browser|Lunascape|Maxthon/.test(Y)||"Safari"!=Y&&/^iOS/.test(J)&&/\bSafari\b/.test(H[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(Y)&&H[1])&&(T=H[H.length-1])&&F.push(T),F.length&&(F=["("+F.join("; ")+")"]),K&&z&&z.indexOf(K)<0&&F.push("on "+K),z&&F.push((/^on /.test(F[F.length-1])?"":"on ")+z),J&&(T=/ ([\d.+]+)$/.exec(J),w=T&&"/"==J.charAt(J.length-T[0].length-1),J={architecture:32,family:T&&!w?J.replace(T[0],""):J,version:T?T[1]:null,toString:function(){var e=this.version;return this.family+(e&&!w?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(T=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(U))&&!/\bi686\b/i.test(U)?(J&&(J.architecture=64,J.family=J.family.replace(RegExp(" *"+T),"")),Y&&(/\bWOW64\b/i.test(e)||G&&/\w(?:86|32)$/.test(b.cpuClass||b.platform)&&!/\bWin64; x64\b/i.test(e))&&F.unshift("32-bit")):J&&/^OS X/.test(J.family)&&"Chrome"==Y&&parseFloat(W)>=39&&(J.architecture=64),e||(e=null);var $={};return $.description=e,$.layout=H&&H[0],$.manufacturer=K,$.name=Y,$.prerelease=B,$.product=z,$.ua=e,$.version=Y&&W,$.os=J||{architecture:null,family:null,version:null,toString:function(){return"null"}},$.parse=m,$.toString=v,$.version&&F.unshift(W),$.name&&F.unshift(Y),J&&Y&&(J!=String(J).split(" ")[0]||J!=Y.split(" ")[0]&&!z)&&F.push(z?"("+J+")":"on "+J),F.length&&($.description=F.join(" ")),$}var v={"function":!0,object:!0},g=v[typeof window]&&window||this,y=v[typeof t]&&t,S=v[typeof e]&&e&&!e.nodeType&&e,b=y&&S&&"object"==typeof i&&i;!b||b.global!==b&&b.window!==b&&b.self!==b||(g=b);var _=Math.pow(2,53)-1,C=/\bOpera/,T=Object.prototype,w=T.hasOwnProperty,R=T.toString,E=m();g.platform=E,n=function(){return E}.call(t,r,t,e),!(void 0!==n&&(e.exports=n))}).call(this)}).call(t,r(57)(e),function(){return this}())},function(e,t,r){var n=r(12),i=r(2).document,o=n(i)&&n(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},,function(e,t){"use strict";t.__esModule=!0;var r,n,i,o,a={CONTROL_COMMAND_BUSY:9,CONTROL_COMMAND_SELF_ON_BACKGROUND:12,CONTROL_COMMAND_START_NOTIFY_RECEIVED:13},s={NETCALL_CONTROL_COMMAND_NOTIFY_AUDIO_ON:1,NETCALL_CONTROL_COMMAND_NOTIFY_AUDIO_OFF:2,NETCALL_CONTROL_COMMAND_NOTIFY_VIDEO_ON:3,NETCALL_CONTROL_COMMAND_NOTIFY_VIDEO_OFF:4,NETCALL_CONTROL_COMMAND_SWITCH_AUDIO_TO_VIDEO:5,NETCALL_CONTROL_COMMAND_SWITCH_AUDIO_TO_VIDEO_AGREE:6,NETCALL_CONTROL_COMMAND_SWITCH_AUDIO_TO_VIDEO_REJECT:7,NETCALL_CONTROL_COMMAND_SWITCH_VIDEO_TO_AUDIO:8,NETCALL_CONTROL_COMMAND_BUSY:9,NETCALL_CONTROL_COMMAND_SELF_CAMERA_INVALID:10,NETCALL_CONTROL_COMMAND_SELF_AUDIO_INVALID:11,NETCALL_CONTROL_COMMAND_SELF_ON_BACKGROUND:12,NETCALL_CONTROL_COMMAND_START_NOTIFY_RECEIVED:13,NETCALL_CONTROL_COMMAND_NOTIFY_RECORD_START:14,NETCALL_CONTROL_COMMAND_NOTIFY_RECORD_STOP:15},c={HANGUP_TYPE_NORMAL:0,HANGUP_TYPE_TIMEOUT:-1},u={NETCALL_TYPE_AUDIO:1,NETCALL_TYPE_VIDEO:2,
DEVICE_TYPE_AUDIO_IN:0,DEVICE_TYPE_AUDIO_OUT_LOCAL:1,DEVICE_TYPE_AUDIO_OUT_CHAT:2,DEVICE_TYPE_VIDEO:3,DEVICE_TYPE_DESKTOP_SCREEN:4,DEVICE_TYPE_DESKTOP_WINDOW:5,CHAT_VIDEO_QUALITY_NORMAL:0,CHAT_VIDEO_QUALITY_LOW:1,CHAT_VIDEO_QUALITY_MEDIUM:2,CHAT_VIDEO_QUALITY_HIGH:3,CHAT_VIDEO_QUALITY_480P:4,CHAT_VIDEO_QUALITY_540P:5,CHAT_VIDEO_QUALITY_720P:6,CHAT_VIDEO_FRAME_RATE_NORMAL:0,CHAT_VIDEO_FRAME_RATE_5:1,CHAT_VIDEO_FRAME_RATE_10:2,CHAT_VIDEO_FRAME_RATE_15:3,CHAT_VIDEO_FRAME_RATE_20:4,CHAT_VIDEO_FRAME_RATE_25:5,LAYOUT_SPLITBOTTOMHORFLOATING:0,LAYOUT_SPLITTOPHORFLOATING:1,LAYOUT_SPLITLATTICETILE:2,LAYOUT_SPLITLATTICECUTTINGTILE:3,LAYOUT_SPLITCUSTOM:4,ROLE_PLAYER:0,ROLE_AUDIENCE:1},d={WB_TYPE_TCP:2,WB_TYPE_UDP:3,CALL_TYPE_NONE:0,CALL_TYPE_AUDIO:1,HANGUP_TYPE_NORMAL:0,HANGUP_TYPE_TIMEOUT:-1};u.deviceTypeMap=(r={},r[u.DEVICE_TYPE_AUDIO_IN]="audioIn",r[u.DEVICE_TYPE_AUDIO_OUT_CHAT]="audioOut",r[u.DEVICE_TYPE_VIDEO]="video",r),u.deviceTypeMap=(n={},n[u.DEVICE_TYPE_AUDIO_IN]="audioIn",n[u.DEVICE_TYPE_AUDIO_OUT_LOCAL]="audioOut",n[u.DEVICE_TYPE_AUDIO_OUT_CHAT]="audioOut",n[u.DEVICE_TYPE_VIDEO]="video",n),u.videoMap={frame:(i={},i[u.CHAT_VIDEO_QUALITY_NORMAL]="480x320",i[u.CHAT_VIDEO_QUALITY_LOW]="176x144",i[u.CHAT_VIDEO_QUALITY_MEDIUM]="352x288",i[u.CHAT_VIDEO_QUALITY_HIGH]="480x320",i[u.CHAT_VIDEO_QUALITY_480P]="640x480",i[u.CHAT_VIDEO_QUALITY_540P]="960x540",i[u.CHAT_VIDEO_QUALITY_720P]="1280x720",i),frameRate:(o={},o[u.CHAT_VIDEO_FRAME_RATE_NORMAL]=15,o[u.CHAT_VIDEO_FRAME_RATE_5]=5,o[u.CHAT_VIDEO_FRAME_RATE_10]=10,o[u.CHAT_VIDEO_FRAME_RATE_15]=15,o[u.CHAT_VIDEO_FRAME_RATE_20]=20,o[u.CHAT_VIDEO_FRAME_RATE_25]=25,o)};var l={getVideoSessionConfig:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.quality,r=void 0===t?u.CHAT_VIDEO_QUALITY_NORMAL:t,n=e.frameRate,i=void 0===n?u.CHAT_VIDEO_FRAME_RATE_NORMAL:n,o={},a=u.videoMap.frame[r];return o.frameRate=u.videoMap.frameRate[i],o.width=+a.split("x")[0],o.height=+a.split("x")[1],o},getDeviceTypeStr:function(e){return u.deviceTypeMap[e]},getDeviceTypeMap:function(e){return u.deviceTypeMap[e]}},p=Object.assign(u,s,c),f=Object.assign(d,a,c);t.constantTool=l,t.constantRtc=p,t.constantBB=f},,function(e,t,r){e.exports=!r(8)&&!r(19)(function(){return 7!=Object.defineProperty(r(47)("div"),"a",{get:function(){return 7}}).a})},function(e,t,r){"use strict";var n=r(29),i=r(18),o=r(55),a=r(9),s=r(6),c=r(26),u=r(83),d=r(30),l=r(88),p=r(3)("iterator"),f=!([].keys&&"next"in[].keys()),h="@@iterator",m="keys",v="values",g=function(){return this};e.exports=function(e,t,r,y,S,b,_){u(r,t,y);var C,T,w,R=function(e){if(!f&&e in k)return k[e];switch(e){case m:return function(){return new r(this,e)};case v:return function(){return new r(this,e)}}return function(){return new r(this,e)}},E=t+" Iterator",O=S==v,P=!1,k=e.prototype,I=k[p]||k[h]||S&&k[S],A=!f&&I||R(S),x=S?O?R("entries"):A:void 0,M="Array"==t?k.entries||I:I;if(M&&(w=l(M.call(new e)),w!==Object.prototype&&w.next&&(d(w,E,!0),n||s(w,p)||a(w,p,g))),O&&I&&I.name!==v&&(P=!0,A=function(){return I.call(this)}),n&&!_||!f&&!P&&k[p]||a(k,p,A),c[t]=A,c[E]=g,S)if(C={values:O?A:R(v),keys:b?A:R(m),entries:x},_)for(T in C)T in k||o(k,T,C[T]);else i(i.P+i.F*(f||P),t,C);return C}},function(e,t,r){var n=r(54),i=r(33).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},function(e,t,r){var n=r(6),i=r(13),o=r(80)(!1),a=r(34)("IE_PROTO");e.exports=function(e,t){var r,s=i(e),c=0,u=[];for(r in s)r!=a&&n(s,r)&&u.push(r);for(;t.length>c;)n(s,r=t[c++])&&(~o(u,r)||u.push(r));return u}},function(e,t,r){e.exports=r(9)},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t,r){var n=r(41);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},function(e,t,r){var n=r(25),i=r(21),o=r(13),a=r(37),s=r(6),c=r(51),u=Object.getOwnPropertyDescriptor;t.f=r(8)?u:function(e,t){if(e=o(e),t=a(t,!0),c)try{return u(e,t)}catch(r){}if(s(e,t))return i(!n.f.call(e,t),e[t])}},function(e,t,r){var n=r(32);e.exports=function(e){return Object(n(e))}},function(e,t){"use strict";t.__esModule=!0;var r,n,i={CURRENT:{SDK_TYPE:null},SDK_TYPE:{NETCALL:1,WEBRTC:2,WHITEBOARD:3,NRTC:4},SDK_NAME:{1:"Netcall",2:"WebRTC",3:"WhiteBoard",4:"NRTC"}};i.STATS_FUN=(r={},r[i.SDK_TYPE.NETCALL]=1,r[i.SDK_TYPE.WEBRTC]=1,r[i.SDK_TYPE.NRTC]=1,r[i.SDK_TYPE.WHITEBOARD]=0,r),i.STATS_RTC=(n={},n[i.SDK_TYPE.WEBRTC]=1,n[i.SDK_TYPE.NRTC]=1,n[i.SDK_TYPE.WHITEBOARD]=0,n),t["default"]=i,e.exports=t["default"]},,,,,,function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(292);Object.defineProperty(t,"RtcUtil",{enumerable:!0,get:function(){return n(i)["default"]}});var o=r(293);Object.defineProperty(t,"SdpUtil",{enumerable:!0,get:function(){return n(o)["default"]}});var a=r(294);Object.defineProperty(t,"RtcStats",{enumerable:!0,get:function(){return n(a)["default"]}});var s=r(295);Object.defineProperty(t,"RtcStatsNew",{enumerable:!0,get:function(){return n(s)["default"]}});var c=r(174);Object.defineProperty(t,"RtcSupport",{enumerable:!0,get:function(){return n(c)["default"]}})},function(e,t,r){var n=r(2).document;e.exports=n&&n.documentElement},function(e,t,r){var n=r(36),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t){},function(e,t,r){"use strict";var n=r(89)(!0);r(52)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=n(t,r),this._i+=e.length,{value:e,done:!1})})},function(e,t,r){r(91);for(var n=r(2),i=r(9),o=r(26),a=r(3)("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),c=0;c<s.length;c++){var u=s[c],d=n[u],l=d&&d.prototype;l&&!l[a]&&i(l,a,u),o[u]=o.Array}},function(e,t){"use strict";var r=!0,n=!0,i={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(r=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(n=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(r)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){n&&console.warn(e+" is deprecated, please use "+t+" instead.")},extractVersion:function(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)},detectBrowser:function(e){var t=e&&e.navigator,r={};if(r.browser=null,r.version=null,"undefined"==typeof e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=this.extractVersion(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)if(e.webkitRTCPeerConnection)r.browser="chrome",r.version=this.extractVersion(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!t.userAgent.match(/Version\/(\d+).(\d+)/))return r.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",r;r.browser="safari",r.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=this.extractVersion(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!t.mediaDevices||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return r}};e.exports={log:i.log,deprecated:i.deprecated,disableLog:i.disableLog,disableWarnings:i.disableWarnings,extractVersion:i.extractVersion,shimCreateObjectURL:i.shimCreateObjectURL,detectBrowser:i.detectBrowser.bind(i)}},,function(e,t,r){e.exports={"default":r(77),__esModule:!0}},function(e,t,r){e.exports={"default":r(78),__esModule:!0}},function(e,t,r){r(92),r(70),r(93),r(94),e.exports=r(11).Symbol},function(e,t,r){r(71),r(72),e.exports=r(39).f("iterator")},function(e,t){e.exports=function(){}},function(e,t,r){var n=r(13),i=r(69),o=r(90);e.exports=function(e){return function(t,r,a){var s,c=n(t),u=i(c.length),d=o(a,u);if(e&&r!=r){for(;u>d;)if(s=c[d++],s!=s)return!0}else for(;u>d;d++)if((e||d in c)&&c[d]===r)return e||d||0;return!e&&-1}}},function(e,t,r){var n=r(24),i=r(43),o=r(25);e.exports=function(e){var t=n(e),r=i.f;if(r)for(var a,s=r(e),c=o.f,u=0;s.length>u;)c.call(e,a=s[u++])&&t.push(a);return t}},function(e,t,r){var n=r(41);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,r){"use strict";var n=r(42),i=r(21),o=r(30),a={};r(9)(a,r(3)("iterator"),function(){return this}),e.exports=function(e,t,r){e.prototype=n(a,{next:i(1,r)}),o(e,t+" Iterator")}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,r){var n=r(22)("meta"),i=r(12),o=r(6),a=r(10).f,s=0,c=Object.isExtensible||function(){return!0},u=!r(19)(function(){return c(Object.preventExtensions({}))}),d=function(e){a(e,n,{value:{i:"O"+ ++s,w:{}}})},l=function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,n)){if(!c(e))return"F";if(!t)return"E";d(e)}return e[n].i},p=function(e,t){if(!o(e,n)){if(!c(e))return!0;if(!t)return!1;d(e)}return e[n].w},f=function(e){return u&&h.NEED&&c(e)&&!o(e,n)&&d(e),e},h=e.exports={KEY:n,NEED:!1,fastKey:l,getWeak:p,onFreeze:f}},function(e,t,r){var n=r(10),i=r(14),o=r(24);e.exports=r(8)?Object.defineProperties:function(e,t){i(e);for(var r,a=o(t),s=a.length,c=0;s>c;)n.f(e,r=a[c++],t[r]);return e}},function(e,t,r){var n=r(13),i=r(53).f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],s=function(e){try{return i(e)}catch(t){return a.slice()}};e.exports.f=function(e){return a&&"[object Window]"==o.call(e)?s(e):i(n(e))}},function(e,t,r){var n=r(6),i=r(60),o=r(34)("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),n(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},function(e,t,r){var n=r(36),i=r(32);e.exports=function(e){return function(t,r){var o,a,s=String(i(t)),c=n(r),u=s.length;return c<0||c>=u?e?"":void 0:(o=s.charCodeAt(c),o<55296||o>56319||c+1===u||(a=s.charCodeAt(c+1))<56320||a>57343?e?s.charAt(c):o:e?s.slice(c,c+2):(o-55296<<10)+(a-56320)+65536)}}},function(e,t,r){var n=r(36),i=Math.max,o=Math.min;e.exports=function(e,t){return e=n(e),e<0?i(e+t,0):o(e,t)}},function(e,t,r){"use strict";var n=r(79),i=r(84),o=r(26),a=r(13);e.exports=r(52)(Array,"Array",function(e,t){this._t=a(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,i(1)):"keys"==t?i(0,r):"values"==t?i(0,e[r]):i(0,[r,e[r]])},"values"),o.Arguments=o.Array,n("keys"),n("values"),n("entries")},function(e,t,r){"use strict";var n=r(2),i=r(6),o=r(8),a=r(18),s=r(55),c=r(85).KEY,u=r(19),d=r(35),l=r(30),p=r(22),f=r(3),h=r(39),m=r(38),v=r(81),g=r(82),y=r(14),S=r(12),b=r(13),_=r(37),C=r(21),T=r(42),w=r(87),R=r(59),E=r(10),O=r(24),P=R.f,k=E.f,I=w.f,A=n.Symbol,x=n.JSON,M=x&&x.stringify,D="prototype",L=f("_hidden"),j=f("toPrimitive"),N={}.propertyIsEnumerable,V=d("symbol-registry"),U=d("symbols"),F=d("op-symbols"),B=Object[D],G="function"==typeof A,W=n.QObject,H=!W||!W[D]||!W[D].findChild,Y=o&&u(function(){return 7!=T(k({},"a",{get:function(){return k(this,"a",{value:7}).a}})).a})?function(e,t,r){var n=P(B,t);n&&delete B[t],k(e,t,r),n&&e!==B&&k(B,t,n)}:k,z=function(e){var t=U[e]=T(A[D]);return t._k=e,t},K=G&&"symbol"==typeof A.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof A},J=function(e,t,r){return e===B&&J(F,t,r),y(e),t=_(t,!0),y(r),i(U,t)?(r.enumerable?(i(e,L)&&e[L][t]&&(e[L][t]=!1),r=T(r,{enumerable:C(0,!1)})):(i(e,L)||k(e,L,C(1,{})),e[L][t]=!0),Y(e,t,r)):k(e,t,r)},Q=function(e,t){y(e);for(var r,n=v(t=b(t)),i=0,o=n.length;o>i;)J(e,r=n[i++],t[r]);return e},$=function(e,t){return void 0===t?T(e):Q(T(e),t)},q=function(e){var t=N.call(this,e=_(e,!0));return!(this===B&&i(U,e)&&!i(F,e))&&(!(t||!i(this,e)||!i(U,e)||i(this,L)&&this[L][e])||t)},X=function(e,t){if(e=b(e),t=_(t,!0),e!==B||!i(U,t)||i(F,t)){var r=P(e,t);return!r||!i(U,t)||i(e,L)&&e[L][t]||(r.enumerable=!0),r}},Z=function(e){for(var t,r=I(b(e)),n=[],o=0;r.length>o;)i(U,t=r[o++])||t==L||t==c||n.push(t);return n},ee=function(e){for(var t,r=e===B,n=I(r?F:b(e)),o=[],a=0;n.length>a;)!i(U,t=n[a++])||r&&!i(B,t)||o.push(U[t]);return o};G||(A=function(){if(this instanceof A)throw TypeError("Symbol is not a constructor!");var e=p(arguments.length>0?arguments[0]:void 0),t=function(r){this===B&&t.call(F,r),i(this,L)&&i(this[L],e)&&(this[L][e]=!1),Y(this,e,C(1,r))};return o&&H&&Y(B,e,{configurable:!0,set:t}),z(e)},s(A[D],"toString",function(){return this._k}),R.f=X,E.f=J,r(53).f=w.f=Z,r(25).f=q,r(43).f=ee,o&&!r(29)&&s(B,"propertyIsEnumerable",q,!0),h.f=function(e){return z(f(e))}),a(a.G+a.W+a.F*!G,{Symbol:A});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),re=0;te.length>re;)f(te[re++]);for(var ne=O(f.store),ie=0;ne.length>ie;)m(ne[ie++]);a(a.S+a.F*!G,"Symbol",{"for":function(e){return i(V,e+="")?V[e]:V[e]=A(e)},keyFor:function(e){if(!K(e))throw TypeError(e+" is not a symbol!");for(var t in V)if(V[t]===e)return t},useSetter:function(){H=!0},useSimple:function(){H=!1}}),a(a.S+a.F*!G,"Object",{create:$,defineProperty:J,defineProperties:Q,getOwnPropertyDescriptor:X,getOwnPropertyNames:Z,getOwnPropertySymbols:ee}),x&&a(a.S+a.F*(!G||u(function(){var e=A();return"[null]"!=M([e])||"{}"!=M({a:e})||"{}"!=M(Object(e))})),"JSON",{stringify:function(e){for(var t,r,n=[e],i=1;arguments.length>i;)n.push(arguments[i++]);if(r=t=n[1],(S(t)||void 0!==e)&&!K(e))return g(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!K(t))return t}),n[1]=t,M.apply(x,n)}}),A[D][j]||r(9)(A[D],j,A[D].valueOf),l(A,"Symbol"),l(Math,"Math",!0),l(n.JSON,"JSON",!0)},function(e,t,r){r(38)("asyncIterator")},function(e,t,r){r(38)("observable")},function(e,t,r){var n,i;!function(o,a){"use strict";n=a,i="function"==typeof n?n.call(t,r,t,e):n,!(void 0!==i&&(e.exports=i))}(this,function(){var e,t,r,n,i=Function.call,o=Object.prototype,a=i.bind(o.hasOwnProperty),s=i.bind(o.propertyIsEnumerable),c=i.bind(o.toString),u=a(o,"__defineGetter__");u&&(e=i.bind(o.__defineGetter__),t=i.bind(o.__defineSetter__),r=i.bind(o.__lookupGetter__),n=i.bind(o.__lookupSetter__));var d=function(e){return null==e||"object"!=typeof e&&"function"!=typeof e};Object.getPrototypeOf||(Object.getPrototypeOf=function(e){var t=e.__proto__;return t||null===t?t:"[object Function]"===c(e.constructor)?e.constructor.prototype:e instanceof Object?o:null});var l=function(e){try{return e.sentinel=0,0===Object.getOwnPropertyDescriptor(e,"sentinel").value}catch(t){return!1}};if(Object.defineProperty){var p=l({}),f="undefined"==typeof document||l(document.createElement("div"));if(!f||!p)var h=Object.getOwnPropertyDescriptor}if(!Object.getOwnPropertyDescriptor||h){var m="Object.getOwnPropertyDescriptor called on a non-object: ";Object.getOwnPropertyDescriptor=function(e,t){if(d(e))throw new TypeError(m+e);if(h)try{return h.call(Object,e,t)}catch(i){}var c;if(!a(e,t))return c;if(c={enumerable:s(e,t),configurable:!0},u){var l=e.__proto__,p=e!==o;p&&(e.__proto__=o);var f=r(e,t),v=n(e,t);if(p&&(e.__proto__=l),f||v)return f&&(c.get=f),v&&(c.set=v),c}return c.value=e[t],c.writable=!0,c}}if(Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(e){return Object.keys(e)}),!Object.create){var v,g=!({__proto__:null}instanceof Object),y=function(){if(!document.domain)return!1;try{return!!new ActiveXObject("htmlfile")}catch(e){return!1}},S=function(){var e,t;t=new ActiveXObject("htmlfile");var r="script";return t.write("<"+r+"></"+r+">"),t.close(),e=t.parentWindow.Object.prototype,t=null,e},b=function(){var e,t=document.createElement("iframe"),r=document.body||document.documentElement;return t.style.display="none",r.appendChild(t),t.src="javascript:",e=t.contentWindow.Object.prototype,r.removeChild(t),t=null,e};v=g||"undefined"==typeof document?function(){return{__proto__:null}}:function(){var e=y()?S():b();delete e.constructor,delete e.hasOwnProperty,delete e.propertyIsEnumerable,delete e.isPrototypeOf,delete e.toLocaleString,delete e.toString,delete e.valueOf;var t=function(){};return t.prototype=e,v=function(){return new t},new t},Object.create=function(e,t){var r,n=function(){};if(null===e)r=v();else{if(null!==e&&d(e))throw new TypeError("Object prototype may only be an Object or null");n.prototype=e,r=new n,r.__proto__=e}return void 0!==t&&Object.defineProperties(r,t),r}}var _=function(e){try{return Object.defineProperty(e,"sentinel",{}),"sentinel"in e}catch(t){return!1}};if(Object.defineProperty){var C=_({}),T="undefined"==typeof document||_(document.createElement("div"));if(!C||!T)var w=Object.defineProperty,R=Object.defineProperties}if(!Object.defineProperty||w){var E="Property description must be an object: ",O="Object.defineProperty called on non-object: ",P="getters & setters can not be defined on this javascript engine";Object.defineProperty=function(i,a,s){if(d(i))throw new TypeError(O+i);if(d(s))throw new TypeError(E+s);if(w)try{return w.call(Object,i,a,s)}catch(c){}if("value"in s)if(u&&(r(i,a)||n(i,a))){var l=i.__proto__;i.__proto__=o,delete i[a],i[a]=s.value,i.__proto__=l}else i[a]=s.value;else{var p="get"in s,f="set"in s;if(!u&&(p||f))throw new TypeError(P);p&&e(i,a,s.get),f&&t(i,a,s.set)}return i}}Object.defineProperties&&!R||(Object.defineProperties=function(e,t){if(R)try{return R.call(Object,e,t)}catch(r){}return Object.keys(t).forEach(function(r){"__proto__"!==r&&Object.defineProperty(e,r,t[r])}),e}),Object.seal||(Object.seal=function(e){if(Object(e)!==e)throw new TypeError("Object.seal can only be called on Objects.");return e}),Object.freeze||(Object.freeze=function(e){if(Object(e)!==e)throw new TypeError("Object.freeze can only be called on Objects.");return e});try{Object.freeze(function(){})}catch(k){Object.freeze=function(e){return function(t){return"function"==typeof t?t:e(t)}}(Object.freeze)}Object.preventExtensions||(Object.preventExtensions=function(e){if(Object(e)!==e)throw new TypeError("Object.preventExtensions can only be called on Objects.");return e}),Object.isSealed||(Object.isSealed=function(e){if(Object(e)!==e)throw new TypeError("Object.isSealed can only be called on Objects.");return!1}),Object.isFrozen||(Object.isFrozen=function(e){if(Object(e)!==e)throw new TypeError("Object.isFrozen can only be called on Objects.");return!1}),Object.isExtensible||(Object.isExtensible=function(e){if(Object(e)!==e)throw new TypeError("Object.isExtensible can only be called on Objects.");for(var t="";a(e,t);)t+="?";e[t]=!0;var r=a(e,t);return delete e[t],r})})},function(e,t){},,,function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(120),o=n(i);t["default"]=o["default"]||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}},,,,,,,function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(7),o=n(i),a=r(40),s=r(4),c=s.info.nrtcVersion,u="https://statistic.live.126.net/statistic/realtime/sdkFunctioninfo",d=function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,o["default"])(this,p);var t=e.appkey,r=e.platform;this.apis={},this.isRtc=/WebRTC/.test(r),this.init(t,r),this.resetStatus()};t["default"]=d;var l=d.prototype;l.init=function(e,t){this.apis=Object.assign(this.apis,{ver:1,platform:t,sdk_ver:c||"v4.4.0",uid:null,appkey:e,time:null})},l.start=function(e){this.calling=!0,this.apis=Object.assign(this.apis,e)},l.resetStatus=function(){this.calling=!1,this.apis=Object.assign(this.apis,{p2p:{value:0},meeting:{value:0},bypass:{value:0},call_control_type:{value:0},self_mute:{value:-1},self_mic_mute:{value:-1},switch_p2p_type:{value:0},set_speaker:{value:-1},net_detect:{value:this.isRtc?-1:0},beautify:{value:-1},water_mark:{value:-1},audio_samples:{value:-1},video_samples:{value:-1},pre_view_mirror:{value:-1},code_mirror:{value:-1},custom_audio:{value:-1},custom_video:{value:-1},audio_mix:{value:-1},snap_shot:{value:-1},record:{value:0},audio_record:{value:0},display:{value:0},android_compatibility:{value:-1},hd_audio:{value:0},video_quality:{value:0},fps:{value:0},prefered_video_encoder:{value:-1},prefered_video_decoder:{value:-1},video_max_encode_bitrate:{value:this.isRtc?-1:0},audio_scene:{value:-1},video_adaptive_strategy:{value:this.isRtc?-1:0},ans:{value:this.isRtc?-1:0},agc:{value:-1},dtx:{value:-1},aec:{value:this.isRtc?-1:0},awc:{value:this.isRtc?-1:0}})},l.update=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],r=e.key,n=e.ext;e.constructor===String&&(r=e),n=n||t,this.apis[r]&&(this.apis[r].value=1,void 0!==n&&(this.apis[r].ext=n),/(p2p|meeting)/.test(r)&&(this.calling=!0))},l.send=function(){var e=this;this.calling&&(this.calling=!1,this.apis.time=Date.now(),(0,a.ajax)({type:"post",url:u,data:this.apis}).then(function(t){e.resetStatus()})["catch"](function(t){console.log("err",t),e.resetStatus()}))},e.exports=t["default"]},,,function(e,t){"use strict";t.__esModule=!0,t["default"]=function(e){if(!e.url||!e.data)return Promise.reject("参数不完整，无法发起请求");e.dataType=e.dataType||"json";var t=new XMLHttpRequest;return t.open(e.type||"GET",e.url,!0),t.responseType=""+e.dataType,t.setRequestHeader("Content-type","application/json;charset=UTF-8"),e.header&&Object.keys(e.header).map(function(r){t.setRequestHeader(r,e.header[r])}),new Promise(function(r,n){t.onload=function(){var e=t.response;r(e)},t.onerror=function(e){n(e)},t.send(JSON.stringify(e.data))})};e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0,t["default"]={merge:function(){var e=arguments;return e[0]=Object.assign.apply(Object.assign,arguments),e[0]},verifyOptions:function(){var e=arguments;if(e[0]&&e[0].constructor===Object)for(var t=1;t<arguments.length;t++){var r=e[t];r=r.split(" "),r.map(function(t){if(!e[0][t])throw Error("参数缺失 "+t)})}},guid:function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return function(){return e()+e()+e()+e()+e()+e()+e()+e()}}()},e.exports=t["default"]},,function(e,t,r){"use strict";function n(e,t){for(var r in t)e[r]=t[r];return e}r(95),r(46),r(5).Promise,window.Object.assign||(console.log("Object.assign polyfill"),window.Object.assign=function(){for(var e=arguments,t=1;t<e.length;t++)e[0]=n(e[0],e[t]);return e[0]})},,,,,function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(147);Object.defineProperty(t,"Device",{enumerable:!0,get:function(){return n(i)["default"]}});var o=r(289);Object.defineProperty(t,"MDevices",{enumerable:!0,get:function(){return n(o)["default"]}});var a=r(290);Object.defineProperty(t,"Recorder",{enumerable:!0,get:function(){return n(a)["default"]}});var s=r(291);Object.defineProperty(t,"MStream",{enumerable:!0,get:function(){return n(s)["default"]}})},function(e,t){"use strict";t.__esModule=!0,t["default"]={html2node:function(e){var t=document.createElement("div");t.innerHTML=e;var r,n,i=[];if(t.children)for(r=0,n=t.children.length;r<n;r++)i.push(t.children[r]);else for(r=0,n=t.childNodes.length;r<n;r++){var o=t.childNodes[r];1===o.nodeType&&i.push(o)}return i.length>1?t:i[0]},n2node:function(e){return e?/HTML.+Element/gi.test(e)?e:e[0]&&/HTML.+Element/gi.test(e[0])?e[0]:null:null}},e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0;var r={gateWay:{login:1,loginAck:2,join:3,keep_alive:4,keep_alive_ack:5,keep_alive_node:6,broadcast:7,toUser:8,logout:9}},n={gateWay:{1:"login",2:"loginAck",3:"join",4:"keep_alive",5:"keep_alive_ack",6:"keep_alive_node",7:"broadcast",8:"toUser",9:"logout"}};t.serializeWb=r,t.unserializeWb=n},function(e,t,r){e.exports={"default":r(125),__esModule:!0}},function(e,t,r){e.exports={"default":r(126),__esModule:!0}},function(e,t,r){e.exports={"default":r(127),__esModule:!0}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(311),o=n(i);t["default"]=function(e){return function(){var t=e.apply(this,arguments);return new o["default"](function(e,r){function n(i,a){try{var s=t[i](a),c=s.value}catch(u){return void r(u)}return s.done?void e(c):o["default"].resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}},function(e,t,r){e.exports=r(326)},function(e,t,r){r(130),e.exports=r(11).Object.assign},function(e,t,r){r(131);var n=r(11).Object;e.exports=function(e,t){return n.create(e,t)}},function(e,t,r){r(132),e.exports=r(11).Object.setPrototypeOf},function(e,t,r){"use strict";var n=r(24),i=r(43),o=r(25),a=r(60),s=r(58),c=Object.assign;e.exports=!c||r(19)(function(){var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach(function(e){t[e]=e}),7!=c({},e)[r]||Object.keys(c({},t)).join("")!=n})?function(e,t){for(var r=a(e),c=arguments.length,u=1,d=i.f,l=o.f;c>u;)for(var p,f=s(arguments[u++]),h=d?n(f).concat(d(f)):n(f),m=h.length,v=0;m>v;)l.call(f,p=h[v++])&&(r[p]=f[p]);return r}:c},function(e,t,r){var n=r(12),i=r(14),o=function(e,t){if(i(e),!n(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,n){try{n=r(45)(Function.call,r(59).f(Object.prototype,"__proto__").set,2),n(e,[]),t=!(e instanceof Array)}catch(i){t=!0}return function(e,r){return o(e,r),t?e.__proto__=r:n(e,r),e}}({},!1):void 0),check:o}},function(e,t,r){var n=r(18);n(n.S+n.F,"Object",{assign:r(128)})},function(e,t,r){var n=r(18);n(n.S,"Object",{create:r(42)})},function(e,t,r){var n=r(18);n(n.S,"Object",{setPrototypeOf:r(129).set})},,,function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(7),o=n(i),a=r(17),s=n(a),c=r(16),u=n(c),d=r(61),l=n(d),p=r(119),f=r(20),h=function(e){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,o["default"])(this,t);var n=(0,s["default"])(this,e.call(this));return n.info=Object.assign({},r),n.init(),n.logger=r.logger||window.console,n.autoReconnect=r.autoReconnect||!0,n.isDestroy=!1,n.reConnectCount=0,n.wssUrl=null,n}return(0,u["default"])(t,e),t}(f),m=h.prototype;m.init=function(){this.reset()},m.reset=function(){this.imInfo={}},m.connect=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.url,n=void 0===r?this.wssUrl:r,i=t.imInfo;return this.imInfo=i||this.imInfo,n?new Promise(function(t,r){e.url=n;var i=void 0;try{i=e.ws=new WebSocket("wss://"+n);var o=e;i.onopen=function(r){e.wssUrl=n,o.initSignal(),o.signalConnected=!0,console.log("signalConnected",n),o.emit("signalConnected"),t(o),e.heartbeat()},i.onclose=i.onerror=function(e){o.signalConnected=!1,r(e)}}catch(a){e.logger.error("信令连接建立失败",a),r(a)}}):Promise.reject("信令地址缺失")},m.initSignal=function(){var e=this,t=this.ws,r=t.send;t.send=function(e){r.call(this,JSON.stringify(e))},t.onmessage=function(t){var r=JSON.parse(t.data||null);if(r)return!e.isHeartBeating||"keep_alive_ack"!==r.type&&r.type!==p.serializeWb.gateWay.keep_alive_ack?void e.emit("message",r):void e.onHeartBeat(r)},t.onclose=function(t){e.signalConnected=!1,e.emit("signalTimeout",t)},t.onerror=function(t){e.signalConnected=!1,e.emit("signalError",t)}},m.send=function(e){var t=this;"keep_alive"!==e.type,this.ws&&this.signalConnected&&this.ws.readyState===this.ws.OPEN?(e.browser={},e.browser.name=window.platform.name,e.browser.version=window.platform.version,this.ws.send(e)):this.once("signalConnected",function(){t.send(e)})},m.heartbeat=function(){this.socketData=this.socketData||{uid:this.imInfo.uid,cid:this.imInfo.cid},this.heartBeatList=[],this.bindHearBeat(5)},m.onHeartBeat=function(e){this.heartBeatList.shift(),this.bindHearBeat(5)},m.heartBeatHandler=function(){var e=this.socketData,t=this.heartBeatList;if(t){var r=Date.now(),n=r;if(l["default"].CURRENT.SDK_TYPE===l["default"].SDK_TYPE.WHITEBOARD&&(n=+r.toString().slice(0,-3)),t.constructor===Array&&0===t.length){t.push(r);var i=this.getContentData({type:"keep_alive",uid:l["default"].CURRENT.SDK_TYPE===l["default"].SDK_TYPE.WHITEBOARD?+e.uid:e.uid+"",cid:l["default"].CURRENT.SDK_TYPE===l["default"].SDK_TYPE.WHITEBOARD?+e.cid:e.cid+""},n);return this.send(i),void this.bindHearBeat(5)}var o=Date.now()-t[0];if(o>3e4)this.logger.error("socket error: heartbeat timeout"),this.emit("signalTimeout");else if(o>2e3&&o<3e4){this.logger.warn("socket error: no response, keep heartbeat"),t.push(r);var a=this.getContentData({type:"keep_alive",uid:e.uid,cid:e.cid},n);this.send(a),this.bindHearBeat(2)}}},m.getContentData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];return l["default"].CURRENT.SDK_TYPE===l["default"].SDK_TYPE.WHITEBOARD?(e.version=31,e.type=p.serializeWb.gateWay[e.type],e.content={params:{timestamp:+t}}):e.params={content:{timestamp:t+""}},e},m.bindHearBeat=function(e){this.isHeartBeating&&clearTimeout(this.isHeartBeating),this.isHeartBeating=setTimeout(this.heartBeatHandler.bind(this),1e3*e)},m.stopHeartBeat=function(){this.isHeartBeating&&(this.isHeartBeating&&clearTimeout(this.isHeartBeating),this.heartBeatTimer&&clearInterval(this.heartBeatTimer),this.isHeartBeating=null,this.heartBeatTimer=null,this.heartBeatList=null,this.heartBeatCount=0)},m.logout=function(){var e=this.socketData,t=Date.now().toString(),r=this.getContentData({type:"logout",uid:e.uid,cid:e.cid},t);this.send(r)},m.destroy=function(){this.logger.log("signal close -> signal.js"),this.stopHeartBeat(),this.isDestroy=!0,this.ws&&(this.ws.onopen=null,this.ws.onmessage=null,this.ws.onerror=null,this.ws.onclose=null,this.ws.readyState===WebSocket.OPEN&&this.ws.close(),this.ws=null)},t["default"]=h,e.exports=t["default"]},,,,,,,,,,function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=r(7),o=n(i),a=r(17),s=n(a),c=r(16),u=n(c),d=r(40),l=r(20),p=function(e){function t(r){(0,o["default"])(this,t);var n=(0,s["default"])(this,e.call(this));return r.container=d.element.n2node(r.container),r.remoteContainer=d.element.n2node(r.remoteContainer),d.tool.merge(n,r),n.init(),n}return(0,u["default"])(t,e),t}(l),f=p.prototype;f.init=function(){var e=this;this.resetStatus(),window.addEventListener("beforeunload",this.beforeunload.bind(this));var t=this.nim&&this.nim.logger||window.console;this.logger={log:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.debug&&t.log.apply(t,arguments)},error:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.debug&&t.error.apply(t,arguments)},warn:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.debug&&t.warn.apply(t,arguments)}}},f.resetStatus=function(){this.signalInited=!1,this.channelId=null,this.type=null,this.target={account:null,uid:null},this.sessionConfig={},this.sessionMode=null,this.imInfo={},this.calling=!1,this.isCaller=!1,this.callee=null,this.callAccepted=!1,this.callerInfo=null,this.beCalledInfo=null,this.nim&&(this.nim.protocol&&this.nim.protocol.setCurrentNetcall&&this.nim.protocol.setCurrentNetcall(),this.nim.protocol&&this.nim.protocol.setCurrentWhiteBoard&&this.nim.protocol.setCurrentWhiteBoard()),this.needQueryAccountMap={},
this.accountUidMap={},this.uidAccountMap={},this.isOnHangup=!1},f.beforeunload=function(){this.signalInited&&(this.callerInfo||this.beCalledInfo?this.hangup():this.leaveChannel())},f.baseGetAccount=function(){return this.nim&&this.nim.account},f.baseGetUid=function(){return this.accountUidMap?this.accountUidMap[this.nim.account]||"-1":"-1"},f.parseAccountUidMap=function(e){var t=this;Object.keys(e).forEach(function(r){t.addAccountUidMap({account:r,uid:e[r]})})},f.addAccountUidMap=function(e){var t=e.account,r=e.uid;this.uidAccountMap||(this.uidAccountMap={}),this.uidAccountMap[r]=t,this.accountUidMap||(this.accountUidMap={}),this.accountUidMap[t]=r},f.getAccountWithUid=function(e){if(this.uidAccountMap)return this.uidAccountMap[e]},f.getUidWithAccount=function(e){if(this.accountUidMap)return this.accountUidMap[e]},f.baseIsCurrentChannelId=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.channelId&&this.channelId===e.channelId},f.baseNotCurrentChannelId=function(e){return!this.baseIsCurrentChannelId(e)},f.baseResponse=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.fn||"calleeAck",n=t.beCalledInfo||this.beCalledInfo,i=n.accepted=t.accepted!==!1;return i?(this.sessionMode="p2p",this.type=n.type,this.channelId=n.channelId,this.target.account=n.account,this.calling=!0,this.imInfo=n,this.imInfo.sessionMode=this.sessionMode,this.imInfo.role=0,this.setSessionConfig({signalStartTime:Date.now()})):(this.logger.log("reject call",n),this.packNetcallRecord({type:n.type,channelId:n.channelId,isCaller:!1,target:n.account,recordType:"rejectNetcall"})),this.nim[r](n).then(function(){i&&(t.sessionConfig&&e.setSessionConfig(t.sessionConfig),e.beCalledInfo=n,e.initSession({beCalledInfo:n}))},function(t){throw e.logger.log(t),t})},f.baseControl=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t.channelId=t.channelId||this.channelId,t.command&&t.channelId){this.controller.uploadDataApi("update",{key:"call_control_type"});var r=t.fn||"netcallControl";return t.type=t.command,this.nim[r](t)["catch"](function(t){e.logger.log(t)})}},f.baseHangup=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.controller.uploadDataApi("send");var t=e.channelId,r=void 0===t?this.channelId:t,n=e.recordType;if(r){var i=e.fn||"hangup";this.nim[i]({channelId:r})}r===this.channelId&&(this.isCaller&&!this.callAccepted&&(this.logger.log(n,{channelId:r}),this.packNetcallRecord({recordType:n})),this.resetWhenHangup())},f.baseStartSession=function(){this.imInfo.cid=this.imInfo.cid||this.imInfo.channelId;var e=this.sessionMode=this.sessionMode||"p2p";this.imInfo.sessionMode=e,this.imInfo.sessionConfig=this.sessionConfig,this.imInfo.serverMap&&this.imInfo.serverMap.constructor===String&&(this.imInfo.serverMap=JSON.parse(this.imInfo.serverMap))},f.packNetcallRecord=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.recordType,r=e.type||this.type,n=e.channelId||this.channelId,i=e.duration||0,o=e.isCaller||this.isCaller,a=e.target||this.target.account,s=this.baseGetAccount(),c=o?s:a,u=o?a:s,l=+new Date;this.nim.protocol.onMsg({content:{msg:{attach:JSON.stringify({data:{calltype:r,channel:n,duration:i,ids:[s,a],time:l},id:t}),from:c,fromClientType:o?16:0,fromDeviceId:"",fromNick:"",idClient:d.tool.guid(),idServer:d.tool.guid(),scene:0,time:l,to:u,type:5}}})},f.setSessionConfig=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};d.tool.merge(this.sessionConfig,e)},f.initSignal=function(){return Promise.resolve()},f.initSession=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.sessionMode="p2p";var r=this.isCaller?this.callerInfo:t.beCalledInfo;this.parseAccountUidMap(r.accountUidMap),!r.account&&r.uid&&(r.account=this.getAccountWithUid(r.uid)),this.callAccepted=!0,this.signalInited=!0,this.setSessionConfig({signalEndTime:Date.now()}),this.controller.uploadDataApi("start",{uid:r.uid}),this.target.uid=this.getUidWithAccount(this.target.account);var n={type:r.type,account:this.target&&this.target.account||r.account,channelId:r.channelId};r.netcallType&&(n.netcallType=r.netcallType),this.imInfo.target=this.target,setTimeout(function(){e.emit("callAccepted",n)},1)},f.onBeCalled=function(e){this.signalInited=!0,this.channelId=e.channelId,this.beCalledInfo=e,this.logger.log("beCalling",e),this.emit("beCalling",e)},f.onUserJoin=function(e){if(this.logger.log("client on userJoined",e),e.type=e.type||this.type,e.account=this.getAccountWithUid(e.uid),e.mode=this.sessionMode,e.account!==this.baseGetAccount()){if(e.account)return this.logger.log("userjoin ----> from signal",e),void this.emit("joinChannel",e);this.needQueryAccountMap[e.uid]=e;var t=this.nim.queryAccountUidMap||this.nim.wbQueryAccountUidMap;t.call(this.nim,this.channelName,[e.uid])}},f.onUserLeft=function(e){var t=this;this.imInfo.channelId&&(this.logger.log("leave channel from signal"),"p2p"===this.imInfo.sessionMode?(this.controller.uploadDataApi("send"),setTimeout(function(){t.logger.log("超时处理 onUserLeft"),t.resetWhenHangup()},1e3),this.emit("hangup",{channelId:e.channelId||e.cid,account:this.target.account,type:e.type||0})):this.emit("leaveChannel",{channelId:e.channelId||e.cid,account:this.getAccountWithUid(e.uid),type:e.type||0}))},f.onNotifyJoin=function(e){if(this.logger){this.logger.log("join channel from IM");var t=e.accountUidMap,r=this.needQueryAccountMap;this.parseAccountUidMap(t);for(var n in t){var i=n,o=t[n];if(o in r){var a=r[o];a.account=i,delete r[o],this.logger.log("userjoin ----> from IM",e),this.emit("joinChannel",a)}}}},f.onCalleeAck=function(e){if(this.logger.log("收到被叫的通知",e),!this.baseNotCurrentChannelId(e)){var t=e.account,r=this.beCalledInfo||this.callerInfo;this.target.account=t,this.setSessionConfig({signalEndTime:Date.now()}),e.accepted?(this.callAccepted=!0,this.initSession()):(this.logger.log("call Rejected",e),this.packNetcallRecord({type:e.type,channelId:e.channelId,isCaller:!0,target:e.account,recordType:"netcallRejected"}),this.resetWhenHangup(),this.emit("callRejected",{type:r.type,account:t}))}},f.onHangup=function(e){var t=this;this.channelId&&"p2p"===this.sessionMode&&(this.logger.log("on hangup from IM"),this.controller.uploadDataApi("send"),setTimeout(function(){t.logger.log("超时处理 onHangup"),t.resetWhenHangup()},1e3),this.emit("hangup",{channelId:e.channelId,account:e.account,type:0}))},f.onControl=function(e){this.emit("control",e)},f.onCalleeAckSync=function(e){this.emit("callerAckSync",e),this.baseIsCurrentChannelId(e)&&this.resetWhenHangup()},f.baseCreateChannel=function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d.tool.verifyOptions(r,"channelName"),r.custom=r.custom||"",this.setSessionConfig({signalStartTime:Date.now()}),this.nim[e](r).then(function(e){return Promise.resolve(e)})["catch"](function(e){return t.setSessionConfig({signalEndTime:Date.now()}),Promise.reject(e)})},f.baseJoinChannel=function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.nim[e](r).then(function(e){return t.setSessionConfig({signalEndTime:Date.now()}),t.signalInited=!0,t.sessionMode=e.sessionMode="meeting",t.parseAccountUidMap(e.accountUidMap),e.uid=t.getUidWithAccount(t.nim.account),Promise.resolve(e)})["catch"](function(e){return t.setSessionConfig({signalEndTime:Date.now()}),Promise.reject(e)})},f.format=function(e){return e.rtcServerMap&&(e.rtcServerMap=JSON.parse(e.rtcServerMap),e.rtcServerMap=e.rtcServerMap.webrtcarray||[e.rtcServerMap.webrtc]||e.rtcServerMap),e.wbServerMap&&(e.wbServerMap=JSON.parse(e.wbServerMap),e.wbServerMap=e.wbServerMap.webrtcarray||[e.wbServerMap.webrtc]||e.wbServerMap),e},f.resetWhenHangup=function(){},e.exports=p},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(7),o=n(i),a=r(17),s=n(a),c=r(16),u=n(c),d=r(135),l=n(d),p=r(61),f=n(p),h=r(106),m=n(h),v=r(20),g=function(e){return new m["default"](e)},y=function(e){function t(r){(0,o["default"])(this,t);var n=(0,s["default"])(this,e.call(this,r));return n.info={},n._init(r),n._reset(),n}return(0,u["default"])(t,e),t.prototype._init=function(e){this.info=Object.assign(this.info,e),this.logger=e.logger||window.console,f["default"].STATS_RTC[f["default"].CURRENT.SDK_TYPE]&&(this.dataApi=g({appkey:this.info.appKey,platform:f["default"].SDK_NAME[f["default"].CURRENT.SDK_TYPE]}))},t.prototype._reset=function(){this.signal&&(this.signal.destroy(),this.signal=null),this.sessionConfig={},this.imInfo={},this.target={},this.userJoinTimeoutId=0,this.remoteNodeStatus={}},t.prototype.resetStatus=function(){this._reset()},t.prototype._startSession=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.imInfo||e;t.uid=+t.uid,t.cid=+t.cid,this.setSessionConfig(t.sessionConfig);var r=t.serverMap||{};t.urlArray=t.serverAddrs||r.webrtcarray||[r.webrtc];var n=void 0;return n=this.signal?Promise.resolve(this.signal):this._initSignal()},t.prototype._initSignal=function(){var e=this;if(this.signal)return Promise.resolve();var t=new l["default"]({logger:this.logger}),r=this.imInfo.urlArray;if(r){var n=r.shift();return n?t.connect({url:n,imInfo:this.imInfo}).then(function(t){return e.signal=t,e._initSignalEvent(),Promise.resolve(t.url)})["catch"](function(t){return e._initSignal()}):Promise.reject("无可用的网关服务器地址, 如果当前应用是WebRTC音视频, 请确保对方打开了WebRTC兼容开关")}},t.prototype._initSignalEvent=function(){var e=this,t=this.signal;t.on("signalTimeout",this.onSignalTimeout.bind(this)),t.on("message",this.onSignalMessage.bind(this)),t.on("signalClosed",function(){e.emit("signalClosed"),e.resetStatus()}),this.signal.on("signalError",function(t){e.emit("signalClosed"),e._stopSignal()})},t.prototype._stopSignal=function(){this.signal&&(this.signal.destroy(),this.signal=null)},t.prototype._stopSession=function(){this._stopSignal(),this._reset()},t.prototype._logout=function(){this.signal&&this.signal.logout()},t.prototype.setAppKey=function(e){e&&(this.info.appKey=e)},t.prototype.setSessionConfig=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.sessionConfig=Object.assign(this.sessionConfig,e)},t.prototype.onSignalMessage=function(e){},t.prototype.onSignalTimeout=function(e){},t.prototype.uploadDataApi=function(e,t){f["default"].STATS_FUN[f["default"].CURRENT.SDK_TYPE]&&this.info.appKey&&("start"===e&&(t.appkey=this.info.appKey),this.dataApi[e]&&this.dataApi[e](t))},t}(v);t["default"]=y,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(124),o=n(i),a=r(123),s=n(a);t["default"]={getDevices:function(){var e=this;return(0,s["default"])(o["default"].mark(function t(){var r;return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("开始获取设备列表"),r=null,navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){e.next=4;break}return e.abrupt("return",Promise.reject("your browser not support this feature, see https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/enumerateDevices"));case 4:return e.next=6,navigator.mediaDevices.enumerateDevices().then(function(e){0!==e.length&&(r={video:[],audioIn:[],audioOut:[]},e.forEach(function(e){"videoinput"===e.kind?r.video.push({deviceId:e.deviceId,label:e.label?e.label:"camera "+(r.video.length+1)}):"audioinput"===e.kind?r.audioIn.push({deviceId:e.deviceId,label:e.label?e.label:"microphone "+(r.audioIn.length+1)}):"audiooutput"===e.kind&&r.audioOut.push({deviceId:e.deviceId,label:e.label?e.label:"speaker "+(r.audioOut.length+1)})}))});case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}},t,e)}))()}},e.exports=t["default"]},,,function(e,t,r){"use strict";function n(e){var t,r;this.promise=new e(function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n}),this.resolve=i(t),this.reject=i(r)}var i=r(56);e.exports.f=function(e){return new n(e)}},,function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(106),o=n(i),a=r(172),s=n(a),c=r(173),u=n(c);t["default"]={DataApi:function(e){return new o["default"](e)},DataRtc:function(e){return new s["default"](e)},DataStats:function(e){return new u["default"](e)}},e.exports=t["default"]},,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(7),o=n(i),a=r(40),s=r(4),c=s.info.nrtcVersion,u="https://statistic.live.126.net/statistic/realtime/sdkinfo",d=function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,o["default"])(this,f);var t=e.appkey;this.infos={},this.userlist=[],this.localVolumn=0,this.local={},this.remote={},this.init(t),this.resetStatus()};t["default"]=d;var l=d.prototype;l.init=function(e){this.infos=Object.assign(this.infos,{ver:1,device:-1,isp:-1,platform:p.convertPlatform(platform.os.family)+"-"+platform.os.version,browser:platform.name+"-"+platform.version,sdk_ver:c||"3.6.0",appkey:e,interval:60,samples:30,time:null,qos_algorithm:-1,fec_algorithm:-1,qos_scene:-1,qos_strategy:-1})},l.resetStatus=function(){this.infos=Object.assign(this.infos,{uid:null,cid:null,push_url:null,turn_ip:null,proxy_ip:null,meeting:!1,live:!1}),this.clearInfoData(),this.uidSsrcMap={},this.userlist=[]},l.initInfoData=function(e){var t={uid:e,cid:this.imInfo&&this.imInfo.channelId||-1,push_url:this.sessionConfig&&this.sessionConfig.rtmpUrl||-1,turn_ip:this.imInfo&&this.imInfo.turnMap||-1,proxy_ip:this.imInfo&&this.imInfo.turnMap||-1,meeting:/^meeting$/gi.test(this.imInfo.sessionMode),live:this.sessionConfig&&this.sessionConfig.liveEnable||!1,p2p:!1,isp:-1,net:-1,connect_state:this.imInfo&&this.imInfo.code||200,signalling_time:(this.sessionConfig&&this.sessionConfig.signalEndTime||0)-(this.sessionConfig&&this.sessionConfig.signalStartTime||0),connect_time:(this.sessionConfig&&this.sessionConfig.rtcEndTime||0)-(this.sessionConfig&&this.sessionConfig.rtcStartTime||0)};this.infos=Object.assign(this.infos,t)},l.clearInfoData=function(){this.localVolumn=0,this.infos=Object.assign(this.infos,{rx:{audio:[],video:[]},tx:{a_lost:[],v_lost:[],rtt:[],rtt_mdev:[],set_v_fps:[],qos_v_fps:[],v_fps:[],set_v_quality:[],real_v_res:[],real_v_kbps:[],real_v_kbps_n:[],real_a_kbps:[],real_a_kbps_n:[],set_v_kbps:[],qos_v_kbps:[],tx_bw_kbps:[],a_volume:[]}})},l.start=function(e){var t=this,r=e.info,n=e.imInfo,i=e.remoteUidMsidMap,o=e.sessionConfig,a=e.rtcConnection,s=e.uid;n&&i&&a&&(this.infos.appkey=r.appKey||r.appkey||this.infos.appkey,this.imInfo=n||{},this.remoteUidMsidMap=i||{},this.sessionConfig=o||{},this.rtcConnection=a,this.videoConfig=e.videoConfig||{},this.statsTimer||(this.getTurnMap(),this.initInfoData(s),this.format(),this.statsTimer=setInterval(function(){t.sendInfo()},1e3*this.infos.interval)))},l.stop=function(){this.statsTimer&&(clearInterval(this.statsTimer),this.statsTimer=null,this.resetStatus())},l.update=function(e){this.rtcStats=e,this.format(),this.updateRxMediaInfo(),this.updateTxMediaInfo()},l.updateOnce=function(e){var t=e.imInfo,r=e.remoteUidMsidMap,n=e.sessionConfig,i=e.rtcConnection;t&&(this.imInfo=t||{},this.remoteUidMsidMap=r||{},this.sessionConfig=n||{},this.rtcConnection=i||{},this.videoConfig=e.videoConfig||{},this.getTurnMap(),this.initInfoData(),this.sendInfo())},l.updateLocalVolumn=function(e){this.localVolumn=e},l.updateRxMediaInfo=function(){var e=this,t={u:[],g:[],c:[],bn:[],bc:[]},r={u:[],i:[],bn:[],bc:[],r:[],f:[]};this.userlist.map(function(n){var i=e.getMediaStats(n);t.u.push(i.audio.u),t.g.push(-1),t.c.push(-1),t.bn.push(i.audio.bn),t.bc.push(i.audio.bc),r.u.push(i.video.u),r.i.push(i.video.i),r.bn.push(i.video.bn),r.bc.push(i.video.bc),r.r.push(i.video.r),r.f.push(i.video.f)}),this.infos.rx.audio.push(t),this.infos.rx.video.push(r)},l.getMediaStats=function(e){var t=this.rtcStats,r={audio:{u:+e,g:-1,c:-1,bn:0,bc:0},video:{u:+e,i:-1,bn:0,bc:0,r:-1,f:0}},n={},i=this.uidSsrcMap[e];if(!i)return r;i=i.join("|");var o=new RegExp("("+i+")");return t.results.filter(function(e){return o.test(e.ssrc)&&(n[e.mediaType]=e),o.test(e)}),n.audio&&(r.audio.bn=(n.audio.availableBandwidth||0)-0,r.audio.bc=-1),n.video&&(r.video.bn=(n.video.availableBandwidth||0)-0,r.video.bc=n.video.googFrameWidthReceived+"x"+n.video.googFrameHeightReceived,r.video.f=(n.video.googFrameRateDecoded||0)-0),r},l.getLocalMediaStats=function(){var e=this.rtcStats,t={a_lost:-1,v_lost:-1,rtt:0,rtt_mdev:-1,set_v_fps:this.videoConfig.frameRate||0,qos_v_fps:0,v_fps:0,set_v_quality:this.sessionConfig.videoQuality,real_v_res:0,real_v_kbps:0,real_v_kbps_n:0,real_a_kbps:-1,real_a_kbps_n:0,set_v_kbps:-1,qos_v_kbps:0,tx_bw_kbps:0,a_volume:0},r={},n=this.imInfo.uid,i=this.uidSsrcMap[n];if(!i)return t;i=i.join("|");var o=new RegExp("("+i+")");return e.results.filter(function(e){return e.localCandidateId?void(r.rtt=e):(o.test(e.ssrc)&&(r[e.mediaType]=e),o.test(e))}),r.audio&&(t.real_a_kbps_n=(r.audio.availableBandwidth||e.audio.send.availableBandwidth)-0,t.a_volume=this.localVolumn-0),r.video&&(t.qos_v_fps=r.video.googFrameRateInput-0,t.v_fps=r.video.googFrameRateSent-0,t.real_v_res=r.video.googFrameWidthSent+"x"+r.video.googFrameHeightSent,t.real_v_kbps=r.video.googEncodeUsagePercent-0,t.real_v_kbps_n=r.video.availableBandwidth-0),t.rtt=r.rtt.googRtt-0,t.tx_bw_kbps=(e.connectionType.bitsSentPerSecond||0)-0,t},l.updateTxMediaInfo=function(){var e=this.getLocalMediaStats(),t=this.infos.tx;for(var r in e)t[r].push(e[r]);this.infos.net=p.convertNetwork(this.rtcStats.connectionType.local.networkType[0])},l.getTurnMap=function(){var e=this.imInfo;e.serverMap&&(e.turnMap=JSON.parse(e.serverMap||null),e.turnMap=e.turnMap&&e.turnMap.turnaddrs,e.turnMap=e.turnMap&&e.turnMap[0],e.turnMap=e.turnMap.constructor===Array?e.turnMap[0]:e.turnMap,e.turnMap=e.turnMap&&e.turnMap.match(/\d+\.\d+.\d+\.\d+/),e.turnMap=e.turnMap[0])},l.getSsrc=function(e,t){var r=[],n={audio:this.getTypeSsrc("audio",e,t),video:this.getTypeSsrc("video",e,t)};return n.audio&&r.push(n.audio),n.video&&r.push(n.video),r},l.getTypeSsrc=function(e,t,r){var n=void 0,i="";if(n=new RegExp(e+"[.\\r\\n\\s\\S]*ssrc:(\\d+)\\smsid:"+t),i=r.match(n),i=i&&i[0])return n=new RegExp("ssrc:\\d+\\smsid:"+t),i=i.match(n),i=i.map(function(e){return n=new RegExp("ssrc:(\\d+)\\s"),e=e.match(n),e[1]})},l.format=function(){this.formatLocal(),this.formatRemote()},l.formatLocal=function(){this.localSdp=this.rtcConnection.localDescription,this.localStream=this.rtcConnection.getLocalStreams()[0],this.localStream&&(this.uidSsrcMap[this.imInfo.uid]=this.getSsrc(this.localStream.id,this.localSdp.sdp),this.local.ssrc=this.uidSsrcMap[this.imInfo.uid])},l.formatRemote=function(){this.remoteSdp=this.rtcConnection.remoteDescription,this.userlist=[];var e=this.remoteUidMsidMap;for(var t in e)this.userlist.push(t),this.remote[t]={},this.uidSsrcMap[t]=this.getSsrc(e[t],this.remoteSdp.sdp),this.remote[t].ssrc=this.uidSsrcMap[t]},l.sendInfo=function(){var e=this;this.infos.uid&&this.infos.cid&&(this.infos.time=Date.now(),this.infos.samples=this.infos.rx.audio.length,(0,a.ajax)({type:"post",url:u,data:this.infos}).then(function(t){e.clearInfoData()})["catch"](function(t){e.clearInfoData()}))};var p={convertNetwork:function(e){var t={wlan:"wifi",lan:"ethernet"};return t[e]||"unknown"},convertPlatform:function(e){var t=/Windows/i,r=/OS X/i,n=void 0;return n=t.test(e)&&"Win"||e,n=r.test(n)&&"Mac"||n}};e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(7),o=n(i),a=r(40),s=r(4),c=s.info.nrtcVersion,u="//statistic.live.126.net/webrtc/stat",d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,o["default"])(this,e);var r=t.appkey;this.infos={},this.init(r),this.resetStatus()}return e.prototype.resetStatus=function(){},e.prototype.init=function(e){this.infos=Object.assign(this.infos,{interval:30,ver:1,platform:l.convertPlatform(platform.os.family)+"-"+platform.os.version,browser:platform.name+"-"+platform.version,sdk_ver:c||"3.6.0",uid:null,appkey:e,time:null,data:{}})},e.prototype.clear=function(){this.infos.data={}},e.prototype.start=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.infos.appkey=e.appKey||e.appkey||this.infos.appkey,this.infos.cid=e.cid,this.infos.uid=e.uid},e.prototype.stop=function(){this.clear()},e.prototype.update=function(e){this.infos.data["stat_"+Date.now()]=e,Object.keys(this.infos.data).length===this.infos.interval&&this.send()},e.prototype.send=function(){var e=this;0!==Object.keys(this.infos.data).length&&(this.infos.time=Date.now(),(0,a.ajax)({type:"post",url:u,data:this.infos}).then(function(t){e.clear()})["catch"](function(e){console.log("err",e)}))},e}();t["default"]=d;var l={convertNetwork:function(e){var t={wlan:"wifi",lan:"ethernet"};return t[e]||"unknown"},convertPlatform:function(e){var t=/Windows/i,r=/OS X/i,n=void 0;return n=t.test(e)&&"Win"||e,n=r.test(n)&&"Mac"||n}};e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=void 0,r={ogg:'video/ogg; codecs="theora"',h264:'video/mp4; codecs="avc1.42E01E"',webm:'video/webm; codecs="vp8, vorbis"',vp9:'video/webm; codecs="vp9"',hls:'application/x-mpegURL; codecs="avc1.42E01E"'};return t||(t=document.createElement("video")),!!t.canPlayType(r[e]||e)}function o(){var e=window.platform&&window.platform.name,t=window.platform&&window.platform.version;return console.log("platform",window.platform),t=t&&t.match(/(\d|\.)+/)[0],t=t&&t.match(/\d+/)[0],{prefix:e,version:t}}t.__esModule=!0;var a=r(124),s=n(a),c=r(123),u=n(c),d=r(147),l=n(d),p=navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,f=window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,h=window.RTCPeerConnection=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,m=window.RTCDataChannel=window.RTCDataChannel||window.DataChannel,v=(window.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription,window.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate,window.MediaStream=window.MediaStream||window.webkitMediaStream),g={WebRTC:!!h&&!!v,RTCPeerConnection:!!h,Vp8:i("webm"),Vp9:i("vp9"),H264:i("h264"),GetUserMedia:!!p&&!!navigator.mediaDevices,DataChannel:!!(h&&m&&h.prototype&&h.prototype.createDataChannel),WebAudio:!(!f||!f.prototype.createMediaStreamSource),MediaStream:!!v};t["default"]={checkWebAudio:function(){return{WebAudio:g.WebAudio,MediaStream:g.MediaStream}},checkCompatibility:function(){var e=Object.assign(o(),{system:window.platform&&window.platform.os.family+" "+window.platform.os.version,browser:window.platform&&window.platform.name,version:window.platform&&window.platform.version}),t=!1;return new Promise(function(r,n){var i=this;(0,u["default"])(s["default"].mark(function o(){var n,a;return s["default"].wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return n=Object.assign(e,g,{ScreenSharing:!!t}),i.next=3,l["default"].getDevices()["catch"](function(e){return console.warn(e),r(n)});case 3:return a=i.sent,n.MicrophoneList=a&&a.audioIn||[],n.CameraList=a&&a.video||[],n.Microphone=a&&a.audioIn&&a.audioIn.length>0||!1,n.Camera=a&&a.video&&a.video.length>0||!1,i.abrupt("return",r(n));case 9:case"end":return i.stop()}},o,i)}))()})},checkVersion:function(){return o()}},e.exports=t["default"]},function(e,t,r){"use strict";function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.stream,r=e.uid,n=e.isAnalyze,i=e.isRemote;this.support=o.WebAudio&&o.MediaStream,this.gain=1,this.stream=t,this.support&&(this.audioIn={},this.uid=r||0,this.isAnalyze=n,this.isRemote=i||!1,this.instant=0,this.slow=0,this.clip=0,this.init())}t.__esModule=!0,t["default"]=n;var i=r(67),o=i.RtcSupport.checkWebAudio();n.ac=o.WebAudio&&o.MediaStream?new window.AudioContext:{},n.destination=n.ac.createMediaStreamDestination?n.ac.createMediaStreamDestination():{};var a=n.prototype;a.context=n.ac,a.init=function(){this.validateInput()&&(this.isAnalyze&&this.initMonitor(),this.formatStreams(),this.initWebAudio(),this.initAudioIn())},a.validateInput=function(){return/(Array|MediaStream|LocalMediaStream)/.test(this.stream.constructor)},a.initMonitor=function(){var e=this,t=this.script=this.context.createScriptProcessor(0,1,1);t.onaudioprocess=function(t){var r,n=t.inputBuffer.getChannelData(0),i=0,o=0;for(r=0;r<n.length;++r)i+=Math.abs(n[r]),Math.abs(n[r])>.99&&(o+=1);e.instant=Math.sqrt(i/n.length),e.slow=.95*e.slow+.05*e.instant,e.clip=o/n.length}},a.initWebAudio=function(){var e=this.context;this.gainFilter=e.createGain(),this.destination=this.isRemote?n.destination:e.createMediaStreamDestination(),this.gainFilter.gain.value=this.gain,this.gainFilter.connect(this.destination)},a.initAudioIn=function(){function e(e){if(!/(MediaStream|LocalMediaStream)/.test(e.constructor))return null;if(0===e.getAudioTracks().length)return null;var t=i.createMediaStreamSource(e);return r.isAnalyze&&r.script&&(t.connect(r.script),r.script.connect(r.gainFilter)),t.connect(r.gainFilter),t}var t=this,r=this,n=this.stream,i=this.context,o=void 0;return/(MediaStream|LocalMediaStream)/.test(n.constructor)?(e(n),void(this.outputStream=this.destination.stream)):void(n.constructor===Array&&(n.forEach(function(r){o=e(r),o&&(t.audioIn[r.id]=o)}),this.outputStream=this.destination.stream))},a.formatStreams=function(){var e=this.stream,t=[];return/(MediaStream|LocalMediaStream)/.test(e.constructor)?(e.getAudioTracks().map(function(e){t.push(new MediaStream([e]))}),void(this.stream=t)):void(e.constructor===Array&&(e.map(function(e){e.getAudioTracks().map(function(e){t.push(new MediaStream([e]))})}),this.stream=t))},a.addStream=function(e){var t=this.context;if(0!==e.getAudioTracks().length){var r=t.createMediaStreamSource(e);this.isAnalyze&&this.script&&r.connect(this.script),r.connect(this.gainFilter),this.audioIn[e.id]=r,this.outputStream=this.destination.stream}},a.updateStream=function(e){if(this.audioIn)for(var t in this.audioIn)this.audioIn[t]&&this.audioIn[t].disconnect(0),this.audioIn[t]=null;this.audioIn={},this.stream=e,this.initAudioIn()},a.setGain=function(e){this.support&&(this.gainFilter.gain.value=e,this.gain=e)},a.getGain=function(){return this.gain},a.off=function(){return this.setGain(0)},a.on=function(){this.setGain(1)},a.destroy=function(){function e(e){e&&e.getTracks().forEach(function(t){e.removeTrack(t)})}if(this.instant=0,this.slow=0,this.clip=0,this.gainFilter&&this.gainFilter.disconnect(0),this.script&&this.script.disconnect(0),this.audioIn)for(var t in this.audioIn)this.audioIn[t]&&this.audioIn[t].disconnect(0);this.audioIn={};var r=this.stream;/(MediaStream|LocalMediaStream)/.test(r.constructor)&&e(r),r.constructor===Array&&r.forEach(function(t){e(t)}),this.stream=null,this.outputStream=null},a.getVolumeData=function(){return this.instant.toFixed(2)},e.exports=t["default"]},,,,,,,,,,,function(e,t,r){var n=r(41),i=r(3)("toStringTag"),o="Arguments"==n(function(){return arguments}()),a=function(e,t){try{return e[t]}catch(r){}};e.exports=function(e){var t,r,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=a(t=Object(e),i))?r:o?n(t):"Object"==(s=n(t))&&"function"==typeof t.callee?"Arguments":s}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(t){return{e:!0,v:t}}}},function(e,t,r){var n=r(14),i=r(12),o=r(150);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=o.f(e),a=r.resolve;return a(t),r.promise}},function(e,t,r){var n=r(14),i=r(56),o=r(3)("species");e.exports=function(e,t){var r,a=n(e).constructor;return void 0===a||void 0==(r=n(a)[o])?t:i(r)}},function(e,t,r){var n,i,o,a=r(45),s=r(315),c=r(68),u=r(47),d=r(2),l=d.process,p=d.setImmediate,f=d.clearImmediate,h=d.MessageChannel,m=d.Dispatch,v=0,g={},y="onreadystatechange",S=function(){var e=+this;if(g.hasOwnProperty(e)){var t=g[e];delete g[e],t()}},b=function(e){S.call(e.data)};p&&f||(p=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return g[++v]=function(){s("function"==typeof e?e:Function(e),t)},n(v),v},f=function(e){delete g[e]},"process"==r(41)(l)?n=function(e){l.nextTick(a(S,e,1))}:m&&m.now?n=function(e){m.now(a(S,e,1))}:h?(i=new h,o=i.port2,i.port1.onmessage=b,n=a(o.postMessage,o,1)):d.addEventListener&&"function"==typeof postMessage&&!d.importScripts?(n=function(e){d.postMessage(e+"","*")},d.addEventListener("message",b,!1)):n=y in u("script")?function(e){c.appendChild(u("script"))[y]=function(){c.removeChild(this),S.call(e)}}:function(e){setTimeout(a(S,e,1),0)}),e.exports={set:p,clear:f}},,,,,,function(e,t){var r=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v";
}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{push:"invalid",names:["value"]}]};Object.keys(r).forEach(function(e){var t=r[e];t.forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},function(e,t,r){"use strict";var n={};n.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},n.splitSections=function(e){var t=e.split("\nm=");return t.map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},n.getDescription=function(e){var t=n.splitSections(e);return t&&t[0]},n.getMediaSections=function(e){var t=n.splitSections(e);return t.shift(),t},n.matchPrefix=function(e,t){return n.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},n.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var r={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(e){return e.substr(14).split(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.numChannels=3===t.length?parseInt(t[2],10):1,r},n.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)t=n[i].trim().split("="),r[t[0].trim()]=t[1];return r},n.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach(function(t){n.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},n.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},n.getDtlsParameters=function(e,t){var r=n.matchPrefix(e+t,"a=fingerprint:");return{role:"auto",fingerprints:r.map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},n.getIceParameters=function(e,t){var r=n.splitLines(e);r=r.concat(n.splitLines(t));var i={usernameFragment:r.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:r.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)};return i},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=n.splitLines(e),i=r[0].split(" "),o=3;o<i.length;o++){var a=i[o],s=n.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(s){var c=n.parseRtpMap(s),u=n.matchPrefix(e,"a=fmtp:"+a+" ");switch(c.parameters=u.length?n.parseFmtp(u[0]):{},c.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(n.parseRtcpFb),t.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(n.parseExtmap(e))}),t},n.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=n.writeRtpMap(e),r+=n.writeFmtp(e),r+=n.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(r+="a=maxptime:"+i+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(e){r+=n.writeExtmap(e)}),r},n.parseRtpEncodingParameters=function(e){var t,r=[],i=n.parseRtpParameters(e),o=i.fecMechanisms.indexOf("RED")!==-1,a=i.fecMechanisms.indexOf("ULPFEC")!==-1,s=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,u=n.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:t}};r.push(n),o&&(n=JSON.parse(JSON.stringify(n)),n.fec={ssrc:t,mechanism:a?"red+ulpfec":"red"},r.push(n))}}),0===r.length&&c&&r.push({ssrc:c});var d=n.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,r.forEach(function(e){e.maxBitrate=d})),r},n.parseRtcpParameters=function(e){var t={},r=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var i=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=n.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},n.parseMsid=function(e){var t,r=n.matchPrefix(e,"a=msid:");if(1===r.length)return t=r[0].substr(7).split(" "),{stream:t[0],track:t[1]};var i=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?(t=i[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(e,t){var r,i=void 0!==t?t:2;return r=e?e:n.generateSessionId(),"v=0\r\no=thisisadapterortc "+r+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,r,i){var o=n.writeRtpDescription(e.kind,t);if(o+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",o+=e.direction?"a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),o},n.getDirection=function(e,t){for(var r=n.splitLines(e),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substr(2)}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){var t=n.splitLines(e),r=t[0].split(" ");return r[0].substr(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},n.parseMLine=function(e){var t=n.splitLines(e),r=t[0].substr(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},n.parseOLine=function(e){var t=n.matchPrefix(e,"o=")[0],r=t.substr(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.exports=n},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(124),o=n(i),a=r(123),s=n(a),c=r(7),u=n(c),d=r(17),l=n(d),p=r(16),f=n(p),h=r(147),m=n(h),v=r(20),g=function(e){function t(){(0,u["default"])(this,t);var r=(0,l["default"])(this,e.call(this));return r.init(),r}return(0,f["default"])(t,e),t}(v);t["default"]=g;var y=g.prototype;y.init=function(){if(this.getDevices()["catch"](function(e){console.warn(e)}),navigator.mediaDevices&&navigator.mediaDevices.addEventListener){var e=void 0,t=this;navigator.mediaDevices.ondevicechange=function(r){e&&(clearTimeout(e),e=null);var n=Object.assign({},t.devicesCache);e=setTimeout(function(){e=null,t.getDevices(!0).then(function(){t.emit("deviceStatus",t.devicesCache),t.filterDeviceChange(t.devicesCache,n)})["catch"](function(){})},500)}}},y.filterDeviceChange=function(e,t){function r(e){var t={};return Object.keys(e).forEach(function(r){e[r].forEach(function(e){t[r+e.deviceId]=Object.assign({},e,{type:r})})}),t}var n=r(e),i=r(t),o=Object.keys(n),a=Object.keys(i);if(o.length>a.length){var s=[];o.forEach(function(e){a.indexOf(e)===-1&&s.push(n[e])}),s.length&&this.emit("deviceAdd",s)}else{var c=[];a.forEach(function(e){o.indexOf(e)===-1&&c.push(i[e])}),c.length&&this.emit("deviceRemove",c)}},y.getDevicesOfType=function(e){return void 0!==e?this.getDevices().then(function(t){return[t[e]]}):this.getDevices()},y.getDevices=function(e){var t=this,r=void 0;return!e&&this.devicesCache?Promise.resolve(this.devicesCache):new Promise(function(e,n){var i=this;(0,s["default"])(o["default"].mark(function a(){return o["default"].wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,m["default"].getDevices()["catch"](function(e){return n(e)});case 2:if(r=i.sent){i.next=5;break}return i.abrupt("return",n("没有找到可用设备"));case 5:return t.devicesCache=r,i.abrupt("return",e(r));case 7:case"end":return i.stop()}},a,i)}))()})},y.getDeviceStatus=function(){return{hasAudio:this.devicesCache&&this.devicesCache.audioIn.length>0||!1,hasVideo:this.devicesCache&&this.devicesCache.video.length>0||!1}},e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(7),o=n(i),a=r(17),s=n(a),c=r(16),u=n(c),d=r(175),l=n(d),p=r(20),f={},h=function(e){function t(){(0,o["default"])(this,t);var r=(0,s["default"])(this,e.call(this));return r.recordedChunks=[],r.isRecording=!1,r.contentTypes=["video/mp4;codecs=opus","video/webm","video/webm;codecs=h264","video/x-matroska;codecs=opus","video/invalid"],r}return(0,u["default"])(t,e),t.init=function(e){f=e||window.Logger},t.prototype.validation=function(e){return e.filter(function(e){return MediaRecorder.isTypeSupported(e)})},t.prototype.format=function(){var e=this,t=this.stream,r=this.option;return new Promise(function(n,i){if(/(LocalMediaStream|MediaStream)/.test(t.constructor)&&(t=[t]),t.constructor!==Array)return i("音视频录制输入错误");if("audio"===r.type)return e.audioController=new l["default"]({stream:t,uid:e.uid}),e.opStream=e.audioController.outputStream,window.audios=e.opStream,n();var o=new MediaStream;return t.forEach(function(e){e&&/(LocalMediaStream|MediaStream)/.test(e.constructor)&&e.getTracks().forEach(function(e){o.addTrack(e)})}),0===o.getTracks().length?i("当前没有任何音视频数据，无法进行录制"):(e.opStream=o,void n())})},t.prototype.start=function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{type:"video"};if(!r.uid&&!r.account)return Promise.reject("需要录制的帐号缺失");if(!e)return Promise.reject("获取视频流失败");if(!window.MediaRecorder||!MediaRecorder.isTypeSupported)return Promise.reject("当前浏览器不支持音视频录制功能");this.stream=e,this.option=r,"audio"===r.type&&(this.contentTypes=["audio/wav","audio/ogg","audio/pcm","audio/webm"]);var n=this.mimeType=this.validation(this.contentTypes)[0];return n?this.isRecording?Promise.reject("音视频正在录制中，请勿重复操作"):this.format().then(function(){return t._start()})["catch"](function(e){return Promise.reject(e)}):Promise.reject("当前浏览器不支持对应格式的视频录制")},t.prototype._start=function(){var e={audioBitsPerSecond:128e3,videoBitsPerSecond:25e5,mimeType:this.mimeType},t=this.recorder=new MediaRecorder(this.opStream,e);return t.ondataavailable=this.ondataavailable.bind(this),t.onstop=this.onstop.bind(this),this.isRecording=!0,this.status="started",this.recorder.start(),this.startTimer(),Promise.resolve(this.option)},t.prototype.stop=function(e){if(!this.isRecording||!this.recorder)return Promise.reject("请先开启音视频录制");if(this.status="stopped",f.log("MediaRecorder: stop event",this.recorder.state),"inactive"===this.recorder.state)return f.warn("MediaRecorder already stopped:",this.recorder.state),Promise.reject("音视频录制已结束，请勿重复操作");var t=(this.option.account||this.option.uid)+"--"+Date.now()+"--"+(this.option.type||"video");return this.fileName=e||t,this.recorder.stop(),Promise.resolve()},t.prototype.leave=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.isRecording&&this.recorder){var t=e.uid;t&&this.option&&this.option&&t===+this.option.uid&&this.stop()}},t.prototype.ondataavailable=function(e){return f.log("MediaRecorder: data received"),e.data.size>0?void this.recordedChunks.push(e.data):(this.stop(),Promise.reject("获取视频流失败"))},t.prototype.onstop=function(){if(f.log("MediaRecorder: onstop"),"stopped"!==this.status)return this._start();var e=new Blob(this.recordedChunks,{type:this.mimeType}),t=URL.createObjectURL(e),r=document.createElement("a");document.body.appendChild(r),r.style="display: none",r.href=t,r.download=(this.fileName||Date.now())+".webm",r.click(),window.URL.revokeObjectURL(t),this.destroy(),this.clearTimer(),this.emit("stopRecord")},t.prototype.pause=function(){this.recorder&&this.recorder.pause()},t.prototype.resume=function(){this.recorder&&this.recorder.resume()},t.prototype.destroy=function(){this.stream=null,this.recorder=null,this.recordedChunks=[],this.isRecording=!1,this.audioController&&this.audioController.destroy(),this.audioController=null,this.fileName=this.fileNameDefault="",this.option={},this.status=""},t.prototype.startTimer=function(){var e=this;this.timer||(this.timer=setInterval(function(){f.log((new Date).toLocaleString()+" --> MediaRecorder status: "+e.recorder.state)},2e3))},t.prototype.clearTimer=function(){this.timer&&(clearInterval(this.timer),this.timer=null)},t}(p);t["default"]=h,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(7),o=n(i),a=r(17),s=n(a),c=r(16),u=n(c),d=r(175),l=r(20),p={},f=function(e){function t(r){(0,o["default"])(this,t);var n=(0,s["default"])(this,e.call(this));return n.isRemote=!!r.isRemote,n.constraint=r.constraint||{},n.stream=r.stream,n.audioStream=r.stream,n.container=r.container,n.uid=r.uid||"",n.poster=r.poster||"",n.isAudio="audio"===r.type,n.initNode(),n.videoRatioIntervalId=null,n.startVideoRatioMonitor(),n}return(0,u["default"])(t,e),t.init=function(e){p=e||window.console},t.destroyMedia=function(e){var t=this;if(e){var r=e.getTracks();r&&0!==r.length&&r.forEach(function(r){p.log("destroy track",t.uid||e.id,r),r.stop(),e.removeTrack(r)})}},t.getLocalStream=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{audio:!0,video:!0},r=e.audio?"audio":"";return/safari/gi.test(platform.name)&&e.video&&(e.video=!0),console.log("constraint",e),navigator.mediaDevices.getUserMedia(e).then(function(n){return"audio"===r?n:new t({stream:n,type:r,isRemote:!1,constraint:e})})["catch"](function(t){var r=t.constructor===Object?t.name:JSON.stringify(t);return console.error(e,t),Promise.reject(r)})},t.prototype.initNode=function(){this.node||(this.isAudio?this.initAudioNode():this.initVideoNode(),this.isRemote&&!this.isAudio&&this.initVideoEvent())},t.prototype.initAudioNode=function(){this.audioStream=this.stream,/safari/gi.test(platform.name)||(this.webAudio=new d({stream:this.audioStream,uid:this.uid,isAnalyze:!0,isRemote:this.isRemote}),this.stream=this.webAudio.outputStream),this.node=document.createElement("audio"),this.node.dataset.uid=this.uid},t.prototype.initVideoNode=function(){var e=this,t=document.createElement("div");t.style.overflow="hidden",t.style.position="relative",t.style.width="400px",t.style.height="400px",t.style.display="none";var r=document.createElement("video");r.setAttribute("x-webkit-airplay","x-webkit-airplay"),r.setAttribute("playsinline","playsinline"),r.setAttribute("webkit-playsinline","webkit-playsinline"),this.poster&&(r.poster=this.poster),r.preload="auto",r.dataset.uid=this.uid,r.autoplay="autoplay",r.style.position="absolute",r.style.left="50%",r.style.top="50%",r.style.transform="translate(-50%,-50%)",t.appendChild(r),this.node=r,this.videoContainer=t,setTimeout(function(){e.videoContainer&&(e.videoContainer.style.display="inline-block")},1e3),t.style.color="#fff";var n=document.createElement("p");n.textContent=this.uid,n.zIndex=1,t.appendChild(n)},t.prototype.initVideoEvent=function(){},t.prototype.setMuted=function(e){this.muted=!!e,this.node&&(this.node.muted=!!e,this.setPlayVolume(),e||this.show())},t.prototype.getMuted=function(){return!!this.muted},t.prototype.setPlayVolume=function(e){var t=void 0;e?(e.constructor===Number&&(t=e),e.constructor===Object&&(t=void 0===e.volume?1:e.volume)):t=this.volume,this.volume=t,this.getMuted()||this.node&&(t=void 0===t||t>1?1:t,this.node.volume=t)},t.prototype.getPlayVolume=function(){return void 0!==this.volume?this.volume:1},t.prototype.setGain=function(e){if(this.stream&&!this.isRemote){if(void 0===e&&(e=1),this.gainOff)return this.gain=e,e;this.webAudio&&this.webAudio.setGain(e),this.gain=e}},t.prototype.getGain=function(){return void 0!==this.gain?this.gain:1},t.prototype.setGainOff=function(){this.stream&&!this.isRemote&&(this.webAudio&&this.webAudio.setGain(0),this.gainOff=!0)},t.prototype.setGainOn=function(){this.stream&&!this.isRemote&&(this.webAudio&&this.webAudio.setGain(void 0!==this.gain?this.gain:1),this.gainOff=!1)},t.prototype.show=function(e,t){if(this.node){if(this.isAudio)return this.node.srcObject=this.audioStream,this.muted&&this.setMuted(this.muted),this.play(),void(this.enable=!0);this.poster=void 0===t?this.poster:t;var r=this.videoContainer;e=this.container=e||this.container,console.log("node container",r,e),r&&e&&(r.parentNode&&r.parentNode===r||(r.parentNode&&r.parentNode.removeChild(r),e.appendChild(r)),this.node.srcObject||(this.node.srcObject=this.stream),this.poster&&(this.node.poster=this.poster),this.play(),this.resizeOptions&&this.resize(),this.enable=!0)}},t.prototype.hide=function(){var e=this.videoContainer;e&&(this.node.paused||this.node.pause(),e.parentNode&&e.parentNode.removeChild(e),this.enable=!1)},t.prototype.addAudioStream=function(e){e&&this.webAudio&&(this.webAudio.addStream(e),this.stream=this.webAudio.outputStream,p.log("本地添加音频流:",e))},t.prototype.updateStream=function(e){var r=this.node;if(r&&e){if(this.isAudio)return this.webAudio&&(this.webAudio.updateStream(e),this.stream=this.webAudio.outputStream),p.log("webrtc::mediaStream::updateAudioTrack",e.getTracks()),this.audioStream&&t.destroyMedia(this.audioStream),void(this.audioStream=e);p.log("webrtc::mediaStream::updateVideoTrack",e.getTracks()),t.destroyMedia(this.stream),this.stream=e,r.srcObject=this.stream}},t.prototype.isShown=function(){return this.node&&this.node.srcObject&&this.enable},t.prototype.removeTrack=function(e){var t=this.stream;t&&t.removeTrack(e)},t.prototype.resize=function(e){if((e&&e.width&&e.height||this.resizeOptions)&&(this.resizeOptions=e||this.resizeOptions,e=this.resizeOptions,e.cut=void 0===e.cut||e.cut,this.node&&this.videoContainer&&!this.isAudio)){if(this.videoContainer.style.width=e.width+"px",this.videoContainer.style.height=e.height+"px",!e.cut)return this.node.style.height="100%",void(this.node.style.width="100%");if(this.node.videoWidth&&this.node.videoHeight){var t=this.node.videoWidth,r=this.node.videoHeight,n=t/r,i=e.width/e.height;n>i?(this.node.style.height="100%",this.node.style.width="auto"):(this.node.style.width="100%",this.node.style.height="auto")}else this.node.width=e.width,this.node.height=e.height}},t.prototype.startVideoRatioMonitor=function(){var e=this;this.isAudio||null===this.videoRatioIntervalId&&(this.preVideoWidth=this.node.videoWidth,this.preVideoHeight=this.node.videoHeight,this.videoRatioIntervalId=setInterval(function(){e.resizeOptions&&(e.preVideoWidth===e.node.videoWidth&&e.preVideoHeight===e.node.videoHeight||(e.resize(e.resizeOptions),e.preVideoWidth=e.node.videoWidth,e.preVideoHeight=e.node.videoHeight))},1e3))},t.prototype.getAudioVolume=function(){return this.webAudio&&this.webAudio.getVolumeData()||0},t.prototype.getMetaWidth=function(e){if(this.node&&!this.isAudio)return this.node.videoWidth},t.prototype.getMetaHeight=function(e){if(this.node&&!this.isAudio)return this.node.videoHeight},t.prototype.resume=function(){this.play()},t.prototype.pause=function(){this.node.pause()},t.prototype.play=function(){var e=this.node;4!==e.readyState&&e.load(),0!==e.played.length&&e.pause();var t=e.play();void 0!==t&&t["catch"](function(e){p.warn(e)}).then(function(){p.log("playing-。-",e,e.parentNode,e.srcObject&&e.srcObject.getTracks())})},t.prototype.stopDevice=function(){this.isAudio?(p.log("销毁音频流",this.uid,this.audioStream),t.destroyMedia(this.audioStream),this.audioStream=null):(t.destroyMedia(this.stream),this.stream=null)},t.prototype.destroy=function(){this.hide(),this.node&&(this.node.pause(),this.node=null),this.videoContainer=null,this.stream&&(t.destroyMedia(this.audioStream),this.isRemote||t.destroyMedia(this.stream),this.stream=null,this.audioStream=null,null!==this.videoRatioIntervalId&&(clearInterval(this.videoRatioIntervalId),this.videoRatioIntervalId=null),this.webAudio&&this.webAudio.context&&this.webAudio.destroy&&this.webAudio.destroy())},t}(l);t["default"]=f,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(174),o=n(i),a=r(329),s=null,c={},u=200,d={};t["default"]={init:function(e){s=o["default"].checkVersion(),d=e||window.console},fnShake:function(e){var t=this,r=e.fn,n=e.peer,i=void 0===n?{}:n;if(r)return i.id||(i.id=Object.keys(c).length+1),r="_"+r,c[i.id]||(c[i.id]={}),c[i.id]&&c[i.id][r]&&(d.log("destroy "+r+" timer"),clearTimeout(c[i.id][r]),c[i.id][r]=null),d.log("create "+r+" timer"),new Promise(function(n,o){c[i.id][r]=setTimeout(function(){c[i.id][r]=null,n(t[r](e))},u)})},createOffer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.fnShake({peer:e,fn:"createOffer"})},_createOffer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.peer;d.log("------ do createoffer ------");var r={offerToReceiveVideo:1,offerToReceiveAudio:1};if(t.uid-t.targetUid!==0){var n=t.getLocalStreams(),i=n[0]&&n[0].getTracks()||!1;i&&0!==i.length||t.addTransceiver&&"Safari"===s.prefix&&(t.addTransceiver("audio"),t.addTransceiver("video"))}return t.createOffer(r)},formatSdp:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.offerOrAnswer,n=t.uid,i=t.highAudio,o=t.stero,s=t.targetUid,c=t.stream||new MediaStream,u=r.sdp,l=r.type,p=[],f=[],h=a.parse(u);d.log(s+" 原始sdp "+l+" \n",u),d.log(h);var m=c.getAudioTracks()[0],v=c.getVideoTracks()[0],g=void 0;return h.media&&h.media.map(function(t,a){if(t.candidates&&delete t.candidates,s!==n?t.direction="recvonly":t.direction=/recvonly/.test(t.direction)?"recvonly":"sendonly",(/audio/.test(t.type)&&!m||/video/.test(t.type)&&!v)&&delete t.ssrcs&&delete t.ssrcGroups&&delete t.msid,"audio"===t.type&&(f.push(t.mid),g=t),"video"===t.type&&v&&t.ssrcs.map(function(e){/^label$/.test(e.attribute)&&e.value!==v.id&&p.push(e.id)}),"audio"===t.type&&(t.ptime=60,t.maxptime=60,t.fmtp&&t.fmtp.length)){var c=!1,u=i?48e3:16e3;t.fmtp.map(function(e){e.config&&e.config.indexOf("minptime=")!==-1&&(e.config=e.config.replace(/minptime=\d+/,"minptime=60")),e.config&&e.config.indexOf("sprop-maxcapturerate=")!==-1&&e.config.indexOf("maxplaybackrate")!==-1&&(c=!0,e.config=e.config.replace(/sprop-maxcapturerate=\d+/,"sprop-maxcapturerate="+u),e.config=e.config.replace(/maxplaybackrate=\d+/,"maxplaybackrate="+u)),c||(e.config+=";maxplaybackrate="+u+";sprop-maxcapturerate="+u),o&&(e.config+=";maxaveragebitrate=131072;stereo=1;sprop-stereo=1;cbr=1")})}if("offer"===r.type){var d=t.mid;h.groups&&h.groups.map(function(e){var r=e.mids.split(" ");r.indexOf(d)!==-1&&(r.splice(r.indexOf(d),1,t.mid),e.mids=r.join(" "))})}t.fmtp=e.limitFrame(t.fmtp)}),r.sdp=a.write(h),p.length>0&&p.map(function(e){var t=new RegExp("a=ssrc:"+e+".+\\r\\n","gi");r.sdp=r.sdp.replace(t,"")}),r},limitFrame:function(e){return e.map(function(e){/42e01f/gi.test(e.config)&&(e.config+=";max-fs=12288")}),e},setMediaBitrates:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.sdp,r=e.bit,n=void 0===r?{}:r,i=n.video,o=void 0===i?500:i,s=n.audio,c=void 0===s?500:s,u=a.parse(t);return u.media&&u.media.map(function(e,t){e.bandwidth=[{type:navigator.mozGetUserMedia?"TIAS":"AS",limit:"audio"===e.type?c:o}]}),a.write(u)},formatSSRCChrome:function(e,t,r){return e.map(function(e,n){return e.id=t+"0"+r+"0"+Math.floor(n/4),e.id-=0,e})},formatSSRCFirefox:function(e,t,r){return e.map(function(e,n){return e.id=t+"0"+r+"0"+Math.floor(n/4),e.id-=0,e})},formatSdpRemote:function(e,t){var r=/Chrome/gi.test(navigator.userAgent);return r?this.formatSdpRemoteChrome(e,t):this.formatSdpRemoteFirefox(e,t)},formatSdpRemoteChrome:function(e){return e=e.replace(/a=msid:.+\r\na=ssrc:\d+ cname:.+/gi,function(e,t){var r=e.match(/a=ssrc:(\d+)/),n=e.match(/a=msid:(.+) (.+)/);return r[1]&&(e=e.replace("a=msid","a=ssrc:"+r[1]+" msid")),n[1]&&r[1]&&(e+="\r\na=ssrc:"+r[1]+" mslabel:"+n[1]),n[2]&&r[1]&&(e+="\r\na=ssrc:"+r[1]+" label:"+n[2]),e}),d.log("formated: \n",e),e},formatSdpRemoteFirefox:function(e,t){if(e=e.replace(/\r\na=msid:.+\r\na=ssrc:\d+ cname:.+/gi,function(e,t){var r=e.match(/\r\na=ssrc:\d+ cname:.+/);return e=e.replace(/a=ssrc:\d+ cname:.+/,""),e=e.replace("a=msid",r[0]+"\r\na=msid")}),t&&t.sdp){var r=a.parse(e),n=a.parse(t.sdp);r.media.length!==n.media.length}return d.log("formated: \n",e),e},parse:function(e){var t=a.parse(e);d.log(t)},updateMediaStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.fn="updateMediaStream",this.fnShake(e)},_updateMediaStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.peer,r=e.currStream,n=e.streams,i=void 0===n?[]:n,o=this.checkCurrStream(t),a={},s=t,c=r||new MediaStream;i.map(function(e){e.getTracks().map(function(e){console.log("_updateMediaStream newTracks",e),a[e.id]=e})});var u=Object.keys(o.tracks).filter(function(e){return!a[e]});console.warn("webrtc-rtc::获取移除的列表",u);var l=Object.keys(a).filter(function(e){return!o.tracks[e]});return console.log("webrtc-rtc::获取新加的列表",l),u&&u.map(function(e){var t=o.tracks[e].sender,r=o.tracks[e].track;d.warn("remove old track",t,r),c.removeTrack(r),s.removeTrack(t)}),l&&l.map(function(e){var t=a[e];d.log("add new track",t),c.addTrack(t),s.addTrack(t,c)}),this.checkCurrStream(t),Promise.resolve(c)},removeTrack:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.peer,r=e.currStream,n=e.tracks,i=void 0===n?[]:n;if(0!==i.length){var o=this.checkCurrStream(t);i.map(function(e){o.tracks[e.id]&&(console.log("====remove track",e,e.readyState,o.tracks[e.id].sender),r.removeTrack(e),t.removeTrack(o.tracks[e.id].sender))})}},checkCurrStream:function(e){var t={},r=[],n=e.getSenders();return n&n.map(function(e){var n=e.track;return n?(t[n.id]={sender:e,track:n},void d.log(" --> track id:",n.kind+":"+n.id)):void r.push(e)}),d.log("current track status:",n,t),d.log("current empty sender:",r),{tracks:t,empty:r}},checkMediaStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.audio,r=e.video,n=e.sdp,i=e.uid,o={audio:!1,video:!1},s=a.parse(n),c=t&&t.getAudioTracks()[0],u=r&&r.getVideoTracks()[0];return d.log(i+" checkMediaStatus ----> track status",s),c&&d.log("webrtc::checkMediaStatus audioTrack ----> ",c),u&&d.log("webrtc::checkMediaStatus videoTrack ----> ",u),o.audio=c&&"ended"!==c.readyState&&new RegExp(c.id).test(n),o.video=u&&"ended"!==u.readyState&&new RegExp(u.id).test(n),o},validMediaStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.sdp,r=e.msid,n=e.trackid;if(!r||!n)return!1;
var i=!1;return r&&(i=new RegExp(r).test(t)),i?(n&&(i=new RegExp(n).test(t)),i):i}},e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0,t["default"]={randomSSRC:function(){var e=Math.floor(1e8*Math.random())+1e7;return e>1e8?99999999:e},_createLocalDescription:function(e,t){function r(e,r){var a={};switch(a.type=r,r){case"audio":case"video":a.protocol="RTP/SAVPF",a.port=9,a.direction="sendrecv";break;case"application":a.protocol="DTLS/SCTP",a.port=0,a.payloads="0",a.direction="inactive"}a.connection={ip:"127.0.0.1",version:4},a.mid=e,a.iceUfrag=i.usernameFragment,a.icePwd=i.password,a.candidates=[];for(var l=o,p=Array.isArray(l),f=0,l=p?l:l[Symbol.iterator]();;){var h;if(p){if(f>=l.length)break;h=l[f++]}else{if(f=l.next(),f.done)break;h=f.value}var m=h,v={};v.component=1,v.foundation=m.foundation,v.ip=m.ip,v.port=m.port,v.priority=m.priority,v.transport=m.protocol.toLowerCase(),v.type=m.type,"tcp"===v.transport&&(v.tcptype=m.tcpType),a.candidates.push(v)}if(a.endOfCandidates="end-of-candidates","offer"===t?a.setup="actpass":a.setup="server"===s.role?"active":"passive","audio"===r||"video"===r){a.rtp=[],a.rtcpFb=[],a.fmtp=[];for(var g=[],y=c.codecs,S=Array.isArray(y),b=0,y=S?y:y[Symbol.iterator]();;){var _;if(S){if(b>=y.length)break;_=y[b++]}else{if(b=y.next(),b.done)break;_=b.value}var C=_;if(!C.kind||C.kind===r){g.push(C.preferredPayloadType);var T={codec:C.name,payload:C.preferredPayloadType,rate:C.clockRate};if(C.numChannels>1&&(T.encoding=C.numChannels),a.rtp.push(T),C.parameters){for(var w={config:"",payload:C.preferredPayloadType},R=Object.keys(C.parameters),E=Array.isArray(R),O=0,R=E?R:R[Symbol.iterator]();;){var P;if(E){if(O>=R.length)break;P=R[O++]}else{if(O=R.next(),O.done)break;P=O.value}var k=P;w.config&&(w.config+=";"),w.config+=k+"="+C.parameters[k]}w.config&&a.fmtp.push(w)}for(var I=C.rtcpFeedback||[],A=Array.isArray(I),x=0,I=A?I:I[Symbol.iterator]();;){var M;if(A){if(x>=I.length)break;M=I[x++]}else{if(x=I.next(),x.done)break;M=x.value}var D=M;a.rtcpFb.push({payload:C.preferredPayloadType,subtype:D.parameter||void 0,type:D.type})}}}0===g.length?(a.payloads="9",a.port=0,a.direction="inactive"):a.payloads=g.join(" "),a.ssrcs=[],a.ssrcGroups=[];for(var L=u.values(),j=Array.isArray(L),N=0,L=j?L:L[Symbol.iterator]();;){var V;if(j){if(N>=L.length)break;V=L[N++]}else{if(N=L.next(),N.done)break;V=N.value}var U=V,F=U.rtpSender,B=U.stream.id,G=F.track;if("ended"!==G.readyState&&G.kind===r){U.ssrc||(U.ssrc=this.randomSSRC());var W=d&&"video"===G.kind;W&&!U.rtxSsrc&&(U.rtxSsrc=U.ssrc+1),a.ssrcs.push({attribute:"cname",id:U.ssrc,value:CNAME}),a.ssrcs.push({attribute:"msid",id:U.ssrc,value:B+" "+G.id}),a.ssrcs.push({attribute:"mslabel",id:U.ssrc,value:B}),a.ssrcs.push({attribute:"label",id:U.ssrc,value:G.id}),W&&(a.ssrcs.push({attribute:"cname",id:U.rtxSsrc,value:CNAME}),a.ssrcs.push({attribute:"msid",id:U.rtxSsrc,value:B+" "+G.id}),a.ssrcs.push({attribute:"mslabel",id:U.rtxSsrc,value:B}),a.ssrcs.push({attribute:"label",id:U.rtxSsrc,value:G.id}),a.ssrcGroups.push({semantics:"FID",ssrcs:U.ssrc+" "+U.rtxSsrc}))}}a.ext=[];for(var H=c.headerExtensions,Y=Array.isArray(H),z=0,H=Y?H:H[Symbol.iterator]();;){var K;if(Y){if(z>=H.length)break;K=H[z++]}else{if(z=H.next(),z.done)break;K=z.value}var J=K;J.kind&&J.kind!==r||a.ext.push({value:J.preferredId,uri:J.uri})}a.rtcpMux="rtcp-mux",a.rtcpRsize="rtcp-rsize"}n.media.push(a)}var n={},i=this._iceGatherer.getLocalParameters(),o=this._iceGatherer.getLocalCandidates(),a=this._dtlsTransport.getLocalParameters(),s=this._dtlsTransport.getRemoteParameters(),c=this._localCapabilities,u=this._localTrackInfos;"offer"===t&&this._sdpGlobalFields.version++,n.version=0,n.origin={address:"127.0.0.1",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"jitsi-ortc-webrtc-shim"},n.name="-",n.timing={start:0,stop:0},n.msidSemantic={semantic:"WMS",token:"*"},n.groups=[{mids:Array.from(this._mids.keys()).join(" "),type:"BUNDLE"}],n.media=[],n.fingerprint={hash:a.fingerprints[0].value,type:a.fingerprints[0].algorithm};for(var d=!1,l=c.codecs,p=Array.isArray(l),f=0,l=p?l:l[Symbol.iterator]();;){var h;if(p){if(f>=l.length)break;h=l[f++]}else{if(f=l.next(),f.done)break;h=f.value}var m=h;if("video"===m.kind&&"rtx"===m.name){d=!0;break}}for(var v=this._mids,g=Array.isArray(v),y=0,v=g?v:v[Symbol.iterator]();;){var S;if(g){if(y>=v.length)break;S=v[y++]}else{if(y=v.next(),y.done)break;S=y.value}var b=S,_=b[0],C=b[1];r.call(this,_,C)}var T=new RTCSessionDescription({type:t,_sdpObject:n});return T},mergeConstraints:function(e,t){if(!e||!t)return e||t;var r=e;for(var n in t)r[n]=t[n];return r},iceCandidateType:function(e){return e.split(" ")[7]},formatTypePreference:function(e){if(/Chrome\/\d+/.test(navigator.userAgent))switch(e){case 0:return"TURN/TLS";case 1:return"TURN/TCP";case 2:return"TURN/UDP"}else if(/Firefox\/\d+/.test(navigator.userAgent))switch(e){case 0:return"TURN/TCP";case 5:return"TURN/UDP"}return""},maybeSetOpusOptions:function(e,t){return"true"===t.opusStereo?e=this.setCodecParam(e,"opus/48000","stereo","1"):"false"===t.opusStereo&&(e=this.removeCodecParam(e,"opus/48000","stereo")),"true"===t.opusFec?e=this.setCodecParam(e,"opus/48000","useinbandfec","1"):"false"===t.opusFec&&(e=this.removeCodecParam(e,"opus/48000","useinbandfec")),"true"===t.opusDtx?e=this.setCodecParam(e,"opus/48000","usedtx","1"):"false"===t.opusDtx&&(e=this.removeCodecParam(e,"opus/48000","usedtx")),t.opusMaxPbr&&(e=this.setCodecParam(e,"opus/48000","maxplaybackrate",t.opusMaxPbr)),e},maybeSetAudioSendBitRate:function(e,t){return t.audioSendBitrate?(console.log("Prefer audio send bitrate: "+t.audioSendBitrate),this.preferBitRate(e,t.audioSendBitrate,"audio")):e},maybeSetAudioReceiveBitRate:function(e,t){return t.audioRecvBitrate?(console.log("Prefer audio receive bitrate: "+t.audioRecvBitrate),this.preferBitRate(e,t.audioRecvBitrate,"audio")):e},maybeSetVideoSendBitRate:function(e,t){return t.videoSendBitrate?(console.log("Prefer video send bitrate: "+t.videoSendBitrate),this.preferBitRate(e,t.videoSendBitrate,"video")):e},maybeSetVideoReceiveBitRate:function(e,t){return t.videoRecvBitrate?(console.log("Prefer video receive bitrate: "+t.videoRecvBitrate),this.preferBitRate(e,t.videoRecvBitrate,"video")):e},preferBitRate:function(e,t,r){var n=e.split("\r\n"),i=this.findLine(n,"m=",r);if(null===i)return console.log("Failed to add bandwidth line to sdp, as no m-line found"),e;var o=this.findLineInRange(n,i+1,-1,"m=");null===o&&(o=n.length);var a=this.findLineInRange(n,i+1,o,"c=");if(null===a)return console.log("Failed to add bandwidth line to sdp, as no c-line found"),e;var s=this.findLineInRange(n,a+1,o,"b=AS");s&&n.splice(s,1);var c="b=AS:"+t;return n.splice(a+1,0,c),e=n.join("\r\n")},maybeSetVideoSendInitialBitRate:function(e,t){var r=t.videoSendInitialBitrate;if(!r)return e;var n=r,i=t.videoSendBitrate;i&&(r>i&&(console.log("Clamping initial bitrate to max bitrate of "+i+" kbps."),r=i,t.videoSendInitialBitrate=r),n=i);var o=e.split("\r\n"),a=this.findLine(o,"m=","video");if(null===a)return console.log("Failed to find video m-line"),e;var s=t.videoRecvCodec;return e=this.setCodecParam(e,s,"x-google-min-bitrate",t.videoSendInitialBitrate.toString()),e=this.setCodecParam(e,s,"x-google-max-bitrate",n.toString())},removePayloadTypeFromMline:function(e,t){e=e.split(" ");for(var r=0;r<e.length;++r)e[r]===t.toString()&&e.splice(r,1);return e.join(" ")},removeCodecByName:function(e,t){var r=this.findLine(e,"a=rtpmap",t);if(null===r)return e;var n=this.getCodecPayloadTypeFromLine(e[r]);e.splice(r,1);var i=this.findLine(e,"m=","video");return null===i?e:(e[i]=this.removePayloadTypeFromMline(e[i],n),e)},removeCodecByPayloadType:function(e,t){var r=this.findLine(e,"a=rtpmap",t.toString());if(null===r)return e;e.splice(r,1);var n=this.findLine(e,"m=","video");return null===n?e:(e[n]=this.removePayloadTypeFromMline(e[n],t),e)},maybeRemoveVideoFec:function(e,t){if("false"!==t.videoFec)return e;var r=e.split("\r\n"),n=this.findLine(r,"a=rtpmap","red");if(null===n)return e;var i=this.getCodecPayloadTypeFromLine(r[n]);if(r=this.removeCodecByPayloadType(r,i),r=this.removeCodecByName(r,"ulpfec"),n=this.findLine(r,"a=fmtp",i.toString()),null===n)return e;var o=this.parseFmtpLine(r[n]),a=o.pt;return null===a?e:(r.splice(n,1),r=this.removeCodecByPayloadType(r,a),r.join("\r\n"))},maybePreferAudioSendCodec:function(e,t){return this.maybePreferCodec(e,"audio","send",t.audioSendCodec)},maybePreferAudioReceiveCodec:function(e,t){return this.maybePreferCodec(e,"audio","receive",t.audioRecvCodec)},maybePreferVideoSendCodec:function(e,t){return this.maybePreferCodec(e,"video","send",t.videoSendCodec)},maybePreferVideoReceiveCodec:function(e,t){return this.maybePreferCodec(e,"video","receive",t.videoRecvCodec)},maybePreferCodec:function(e,t,r,n){var i=t+" "+r+" codec";if(!n)return console.log("No preference on "+i+"."),e;console.log("Prefer "+i+": "+n);var o=e.split("\r\n"),a=this.findLine(o,"m=",t);if(null===a)return e;var s=this.getCodecPayloadType(o,n);return s?o[a]=this.setDefaultCodec(o[a],s):console.error("no prefered codec found for ",n),e=o.join("\r\n")},setCodecParam:function(e,t,r,n){var i=e.split("\r\n"),o=this.findFmtpLine(i,t),a={};if(null===o){var s=this.findLine(i,"a=rtpmap",t);if(null===s)return e;var c=this.getCodecPayloadTypeFromLine(i[s]);a.pt=c.toString(),a.params={},a.params[r]=n,i.splice(s+1,0,this.writeFmtpLine(a))}else a=this.parseFmtpLine(i[o]),a.params[r]=n,i[o]=this.writeFmtpLine(a);return e=i.join("\r\n")},removeCodecParam:function(e,t,r){var n=e.split("\r\n"),i=this.findFmtpLine(n,t);if(null===i)return e;var o=this.parseFmtpLine(n[i]);delete o.params[r];var a=this.writeFmtpLine(o);return null===a?n.splice(i,1):n[i]=a,e=n.join("\r\n")},parseFmtpLine:function(e){var t={},r=e.indexOf(" "),n=e.substring(r+1).split("; "),i=new RegExp("a=fmtp:(\\d+)"),o=e.match(i);if(!o||2!==o.length)return null;t.pt=o[1];for(var a={},s=0;s<n.length;++s){var c=n[s].split("=");2===c.length&&(a[c[0]]=c[1])}return t.params=a,t},writeFmtpLine:function(e){if(!e.hasOwnProperty("pt")||!e.hasOwnProperty("params"))return null;var t=e.pt,r=e.params,n=[],i=0;for(var o in r)n[i]=o+"="+r[o],++i;return 0===i?null:"a=fmtp:"+t.toString()+" "+n.join("; ")},findFmtpLine:function(e,t){var r=this.getCodecPayloadType(e,t);return r?this.findLine(e,"a=fmtp:"+r.toString()):null},findLine:function(e,t,r){return this.findLineInRange(e,0,-1,t,r)},findLineInRange:function(e,t,r,n,i){for(var o=r!==-1?r:e.length,a=t;a<o;++a)if(0===e[a].indexOf(n)&&(!i||e[a].toLowerCase().indexOf(i.toLowerCase())!==-1))return a;return null},getCodecPayloadType:function(e,t){var r=this.findLine(e,"a=rtpmap",t);return r?this.getCodecPayloadTypeFromLine(e[r]):null},getCodecPayloadTypeFromLine:function(e){var t=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+"),r=e.match(t);return r&&2===r.length?r[1]:null},setDefaultCodec:function(e,t){var r=e.split(" "),n=r.slice(0,3);n.push(t);for(var i=3;i<r.length;i++)r[i]!==t&&n.push(r[i]);return n.join(" ")}},e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(7),o=n(i),a=r(17),s=n(a),c=r(16),u=n(c),d=r(20),l=n(d),p=function(e){function t(r){(0,o["default"])(this,t);var n=(0,s["default"])(this,e.call(this));return n.peer=r.peer,n.mediaStreamTrack=r.mediaStreamTrack,n.interval=5e3,n.init(),n}return(0,u["default"])(t,e),t.prototype.init=function(){this.reset(),this.initStatsResult(),this.initStatsParser(),this.initStatsParserFn()},t.prototype.reset=function(){this.nomore=!1,this.AUDIO_codecs=["opus","isac","ilbc"],this.VIDEO_codecs=["vp9","vp8","h264"],this.SSRC={audio:{send:[],recv:[]},video:{send:[],recv:[]}},this.LOCAL_candidateType=[],this.LOCAL_transport=[],this.LOCAL_ipAddress=[],this.LOCAL_networkType=[],this.REMOTE_candidateType=[],this.REMOTE_transport=[],this.REMOTE_ipAddress=[],this.REMOTE_networkType=[]},t.prototype.initStatsResult=function(){var e=((navigator.connection||{}).type||"unknown").toString().toLowerCase();this.statsResult={encryption:"sha-256",audio:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0},bytesSent:0,bytesReceived:0},video:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0},bytesSent:0,bytesReceived:0},results:{},connectionType:{systemNetworkType:e,systemIpAddress:"192.168.1.2",local:{candidateType:[],transport:[],ipAddress:[],networkType:[]},remote:{candidateType:[],transport:[],ipAddress:[],networkType:[]}},resolutions:{send:{width:0,height:0},recv:{width:0,height:0}},internal:{audio:{send:{},recv:{}},video:{send:{},recv:{}},candidates:{}},nomore:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){nomore=!0})}},t.prototype.initStatsParser=function(){var e=this;this.statsParser={checkIfOfferer:function(t){"googLibjingleSession"===t.type&&(e.statsResult.isOfferer=t.googInitiator)}}},t.prototype.initStatsParserFn=function(){var e=this.AUDIO_codecs,t=this.VIDEO_codecs,r=this.SSRC,n=this.statsParser,i=this.statsResult,o=this.LOCAL_candidateType,a=this.LOCAL_transport,s=this.LOCAL_ipAddress,c=this.LOCAL_networkType,u=this.REMOTE_candidateType,d=this.REMOTE_transport,l=this.REMOTE_ipAddress,p=this.REMOTE_networkType;n.datachannel=function(e){"datachannel"===e.type&&(i.datachannel={state:e.state})},n.googCertificate=function(e){"googCertificate"===e.type&&(i.encryption=e.googFingerprintAlgorithm)},n.checkAudioTracks=function(t){if(t.googCodecName&&"audio"===t.mediaType&&e.indexOf(t.googCodecName.toLowerCase())!==-1){var r=t.id.split("_").pop();if(i.audio[r].codecs.indexOf(t.googCodecName)===-1&&i.audio[r].codecs.push(t.googCodecName),t.bytesSent){var n=0;if(t.bytesSent){i.internal.audio[r].prevBytesSent||(i.internal.audio[r].prevBytesSent=t.bytesSent);var o=t.bytesSent-i.internal.audio[r].prevBytesSent;i.internal.audio[r].prevBytesSent=t.bytesSent,n=o/1024}i.audio[r].availableBandwidth=n.toFixed(1)}if(t.bytesReceived){var n=0;if(t.bytesReceived){i.internal.audio[r].prevBytesReceived||(i.internal.audio[r].prevBytesReceived=t.bytesReceived);var o=t.bytesReceived-i.internal.audio[r].prevBytesReceived;i.internal.audio[r].prevBytesReceived=t.bytesReceived,n=o/1024}t.availableBandwidth=n.toFixed(1),i.audio[r].availableBandwidth=t.availableBandwidth}i.audio[r].tracks.indexOf(t.googTrackId)===-1&&i.audio[r].tracks.push(t.googTrackId)}},n.checkVideoTracks=function(e){if(e.googCodecName&&"video"===e.mediaType&&t.indexOf(e.googCodecName.toLowerCase())!==-1){var r=e.id.split("_").pop();if(i.video[r].codecs.indexOf(e.googCodecName)===-1&&i.video[r].codecs.push(e.googCodecName),e.bytesSent){var n=0;i.internal.video[r].prevBytesSent||(i.internal.video[r].prevBytesSent=e.bytesSent);var o=e.bytesSent-i.internal.video[r].prevBytesSent;i.internal.video[r].prevBytesSent=e.bytesSent,n=o/1024}if(e.bytesReceived){var n=0;i.internal.video[r].prevBytesReceived||(i.internal.video[r].prevBytesReceived=e.bytesReceived);var o=e.bytesReceived-i.internal.video[r].prevBytesReceived;i.internal.video[r].prevBytesReceived=e.bytesReceived,n=o/1024}e.availableBandwidth=n.toFixed(1),i.video[r].availableBandwidth=e.availableBandwidth,e.googFrameHeightReceived&&e.googFrameWidthReceived&&(i.resolutions[r].width=e.googFrameWidthReceived,i.resolutions[r].height=e.googFrameHeightReceived),e.googFrameHeightSent&&e.googFrameWidthSent&&(i.resolutions[r].width=e.googFrameWidthSent,i.resolutions[r].height=e.googFrameHeightSent),i.video[r].tracks.indexOf(e.googTrackId)===-1&&i.video[r].tracks.push(e.googTrackId)}},n.bweforvideo=function(e){"VideoBwe"===e.type&&(i.video.bandwidth={googActualEncBitrate:e.googActualEncBitrate,googAvailableSendBandwidth:e.googAvailableSendBandwidth,googAvailableReceiveBandwidth:e.googAvailableReceiveBandwidth,googRetransmitBitrate:e.googRetransmitBitrate,googTargetEncBitrate:e.googTargetEncBitrate,googBucketDelay:e.googBucketDelay,googTransmitBitrate:e.googTransmitBitrate})},n.googCandidatePair=function(e){if("googCandidatePair"===e.type&&(i.connectionType.bitsSentPerSecond=8*(e.bytesSent-(i.connectionType.prevBytesSent||0))/1024/2,i.connectionType.bitsReceivedPerSecond=8*(e.bytesReceived-(i.connectionType.prevBytesReceived||0))/1024/2,i.connectionType.bitsSentPerSecond=i.connectionType.bitsSentPerSecond.toFixed(1),i.connectionType.bitsReceivedPerSecond=i.connectionType.bitsReceivedPerSecond.toFixed(1),i.connectionType.prevBytesSent=e.bytesSent,i.connectionType.prevBytesReceived=e.bytesReceived,"true"===e.googActiveConnection)){i.connectionType.local.ipAddress=e.googLocalAddress,i.connectionType.remote.ipAddress=e.googRemoteAddress,i.connectionType.transport=e.googTransportType;var t=i.internal.candidates[e.localCandidateId];t&&t.ipAddress&&(i.connectionType.systemIpAddress=t.ipAddress);var r=i.internal.candidates[e.remoteCandidateId];r&&r.ipAddress&&(i.connectionType.systemIpAddress=r.ipAddress)}},n.localcandidate=function(e){"localcandidate"===e.type&&(e.candidateType&&o.indexOf(e.candidateType)===-1&&o.push(e.candidateType),e.transport&&a.indexOf(e.transport)===-1&&a.push(e.transport),e.ipAddress&&s.indexOf(e.ipAddress+":"+e.portNumber)===-1&&s.push(e.ipAddress+":"+e.portNumber),e.networkType&&c.indexOf(e.networkType)===-1&&c.push(e.networkType),i.internal.candidates[e.id]={candidateType:o,ipAddress:s,portNumber:e.portNumber,networkType:c,priority:e.priority,transport:a,timestamp:e.timestamp,id:e.id,type:e.type},i.connectionType.local.candidateType=o,i.connectionType.local.ipAddress=s,i.connectionType.local.networkType=c,i.connectionType.local.transport=a)},n.remotecandidate=function(e){"remotecandidate"===e.type&&(e.candidateType&&u.indexOf(e.candidateType)===-1&&u.push(e.candidateType),e.transport&&d.indexOf(e.transport)===-1&&d.push(e.transport),e.ipAddress&&l.indexOf(e.ipAddress+":"+e.portNumber)===-1&&l.push(e.ipAddress+":"+e.portNumber),e.networkType&&p.indexOf(e.networkType)===-1&&p.push(e.networkType),i.internal.candidates[e.id]={candidateType:u,ipAddress:l,portNumber:e.portNumber,networkType:p,priority:e.priority,transport:d,timestamp:e.timestamp,id:e.id,type:e.type},i.connectionType.remote.candidateType=u,i.connectionType.remote.ipAddress=l,i.connectionType.remote.networkType=p,i.connectionType.remote.transport=d)},n.dataSentReceived=function(e){!e.googCodecName||"video"!==e.mediaType&&"audio"!==e.mediaType||(e.bytesSent&&(i[e.mediaType].bytesSent=parseInt(e.bytesSent)),e.bytesReceived&&(i[e.mediaType].bytesReceived=parseInt(e.bytesReceived)))},n.ssrc=function(e){if(e.googCodecName&&("video"===e.mediaType||"audio"===e.mediaType)&&"ssrc"===e.type){var t=e.id.split("_").pop();r[e.mediaType][t].indexOf(e.ssrc)===-1&&r[e.mediaType][t].push(e.ssrc),i[e.mediaType][t].streams=r[e.mediaType][t].length}}},t.prototype.start=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.interval;if(this.statsTimer&&clearInterval(this.statsTimer),!e)throw Error("no peer for stats");this.peer=e,this.interval=t,this.statsTimer=setInterval(this.getStats.bind(this),t)},t.prototype.stop=function(){this.statsTimer&&(clearInterval(this.statsTimer),this.statsTimer=null,this.reset())},t.prototype.getStats=function(){var e=this.formatResult.bind(this),t=this.peer,r=this.mediaStreamTrack;"undefined"!=typeof window.InstallTrigger?t.getStats(r,function(t){var r=[];t.forEach(function(e){r.push(e)}),e(r)},e):t.getStats(function(t){var r=[];t.result().forEach(function(e){var t={};e.names().forEach(function(r){t[r]=e.stat(r)}),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,r.push(t)}),e(r)})},t.prototype.formatResult=function(e){var t=this.peer,r=(this.mediaStreamTrack,this.statsParser),n=this.statsResult;e.forEach(function(e){Object.keys(r).forEach(function(t){"function"==typeof r[t]&&r[t](e)})});try{t.iceConnectionState.search(/failed/gi)!==-1&&(this.nomore=!0)}catch(i){this.nomore=!0}this.nomore===!0&&(n.datachannel&&(n.datachannel.state="close"),n.ended=!0),n.results=e,this.emit("stats",n)},t}(l["default"]);t["default"]=p,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(124),o=n(i),a=r(123),s=n(a),c=r(7),u=n(c),d=r(17),l=n(d),p=r(16),f=n(p),h=r(20),m=n(h),v=r(296),g=n(v),y=function(e){function t(){return(0,u["default"])(this,t),(0,l["default"])(this,e.apply(this,arguments))}return(0,f["default"])(t,e),t.prototype.reset=function(){this.timer&&clearInterval(this.timer),this.timer=null,this.interval=0,this.controller=null},t.prototype.start=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.controller,r=e.interval,n=void 0===r?2:r;this.controller=t,this.interval=n,this.timer=setInterval(this.getStats.bind(this),1e3*n)},t.prototype.stop=function(){this.reset()},t.prototype.getStats=function(){function e(){return t.apply(this,arguments)}var t=(0,s["default"])(o["default"].mark(function r(){var e;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e={},t.next=3,this.getLocalStats();case 3:return e.self=t.sent,t.next=6,this.getRemoteStats();case 6:e.other=t.sent,Object.keys(e.other).map(function(t){e.self=Object.assign(e.self,e.other[t])}),this.emit("stats",e.self);case 9:case"end":return t.stop()}},r,this)}));return e}(),t.prototype.getLocalStats=function(){function e(){return t.apply(this,arguments)}var t=(0,s["default"])(o["default"].mark(function r(){var e;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.controller,e&&e.rtc){t.next=3;break}return t.abrupt("return",{});case 3:return e.rtc.rtcConnection.interval=this.interval,t.next=6,g["default"].getStats(e.rtc.rtcConnection);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}},r,this)}));return e}(),t.prototype.getRemoteStats=function(){function e(){return t.apply(this,arguments)}var t=(0,s["default"])(o["default"].mark(function r(){var e,t,n,i,a,c,u,d,l=this;return o["default"].wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(this.controller&&this.controller.remoteNode){r.next=2;break}return r.abrupt("return",{});case 2:e={},t=this.controller.remoteNode,n=Object.keys(t).map(function(){var r=(0,s["default"])(o["default"].mark(function n(r){return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!t[r].rtc){n.next=6;break}return t[r].rtc.rtcConnection.interval=l.interval,n.next=4,g["default"].getStats(t[r].rtc.rtcConnection);case 4:return e[r]=n.sent,n.abrupt("return",e[r]);case 6:case"end":return n.stop()}},n,l)}));return function(e){return r.apply(this,arguments)}}()),i=n,a=Array.isArray(i),c=0,i=a?i:i[Symbol.iterator]();case 6:if(!a){r.next=12;break}if(!(c>=i.length)){r.next=9;break}return r.abrupt("break",21);case 9:u=i[c++],r.next=16;break;case 12:if(c=i.next(),!c.done){r.next=15;break}return r.abrupt("break",21);case 15:u=c.value;case 16:return d=u,r.next=19,d;case 19:r.next=6;break;case 21:return r.abrupt("return",e);case 22:case"end":return r.stop()}},r,this)}));return e}(),t}(m["default"]);t["default"]=y,e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0;var r={K:{framesEncoded:1,qpSum:1,audioOutputLevel:1,googDecodingCTN:1,googDecodingNormal:1,googAvailableSendBandwidth:1,googTargetEncBitrate:1,googActualEncBitrate:1,googRetransmitBitrate:1,googTransmitBitrate:1},T:{googCaptureStartNtpTimeMs:1}};t["default"]={getStats:function(e){var t=this;if(e&&!/(failed|closed)/gi.test(e.iceConnectionState))return navigator.mozGetUserMedia?this.getStatsFirefox(e):new Promise(function(r,n){e.getStats(function(n){var i={},o=n.result();o.forEach(function(e){var t={};e.names().forEach(function(r){t[r]=e.stat(r)}),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,i[t.id]=t}),e.lastStats=e.lastStats||{},i=t.format(e,i),r(i)})})},getStatsFirefox:function(e){var t=this;return e.getStats(null).then(function(r){return e.lastStats=e.lastStats||{},r=t.format(e,r),Promise.resolve(r)})},format:function(e,t){return!e||/(failed|closed)/gi.test(e.iceConnectionState)?{}:t=e.uid-e.targetUid===0?this.ssrcLocal(e,t):this.ssrcRemote(e,t)},formatSSRC:function(e,t,r,n){var i=navigator.mozGetUserMedia?"_formatSSRC_F":"_formatSSRC_G";return this[i](e,t,r,n)},_formatSSRC_G:function(e,t,r,n){var i=this,o={};return Object.values(t).map(function(t){if(("recv"!==n||/^ssrc_/gi.test(t.id))&&("send"!==n||/^(bweforvideo|ssrc_)/gi.test(t.id))){t=i.formatData(t);var r=new RegExp("ssrc_(\\d+)_"+n),a=t.id.match(r),s=t.id;if(o[s]=t,a&&a[1]){if("recv"===n&&0===e.uid)return void delete o[s];t.id="ssrc_"+e.uid+"_"+n+"_"+("recv"===n?e.targetUid:0)+"_"+t.mediaType,t=i.computeData(e,t),o[t.id]=t,delete o[s]}}}),o},_formatSSRC_F:function(e,t,r,n){var i=this,o={},a="send"===n?"outbound":"inbound",s=new RegExp("^"+a+"_","i");return Object.values(t).map(function(t){if(s.test(t.id)){var r=t.id;t.id=t.id.replace(/\d+/,e.uid+"_"+n+"_"+("recv"===n?e.targetUid:0)),t=i.computeData(e,t),o[t.id]=t,delete o[r]}}),o},formatData:function(e){return Object.keys(e).map(function(t){r.K[t]&&(e[t]=(e[t]/1024).toFixed(2)),r.T[t]&&(e[t]=(e[t]/1024/1024).toFixed(2))}),e},computeData:function(e,t){var r={peer:e,ssrcKey:t.id,currentItem:t};return t.bytesSent&&(t.bitsSentPerSecond=this.getLastStats(Object.assign({},r,{valueKey:"bytesSent"}))),t.packetsSent&&(t.packetsSentPerSecond=this.getLastStats(Object.assign({},r,{valueKey:"packetsSent"}))),t.bytesReceived&&(t.bitsReceivedPerSecond=this.getLastStats(Object.assign({},r,{valueKey:"bytesReceived"}))),t.packetsReceived&&(t.packetsReceivedPerSecond=this.getLastStats(Object.assign({},r,{valueKey:"packetsReceived"}))),t},ssrcLocal:function(e,t){var r=e.localDescription;return this.formatSSRC(e,t,r.sdp,"send")},ssrcRemote:function(e,t){var r=e.remoteDescription;return this.formatSSRC(e,t,r.sdp,"recv")},getLastStats:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.peer,r=e.ssrcKey,n=e.valueKey,i=e.currentItem,o=null;return o=t.lastStats[r]&&t.lastStats[r][n]?i[n]-t.lastStats[r][n]:i[n],o=/bytes/gi.test(n)?(8*o*1e3/t.interval/1024).toFixed(2):1e3*o/t.interval,t.lastStats[r]=i[n],o}},e.exports=t["default"]},function(e,t,r){"use strict";t.__esModule=!0;var n=r(49);t["default"]={getAccount:function(){return this.baseGetAccount()},getUid:function(){return this.baseGetUid()},isCurrentChannelId:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.baseIsCurrentChannelId(e)},notCurrentChannelId:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!this.isCurrentChannelId(e)},switchVideoToAudio:function(){var e=this;return this.controller.uploadDataApi("update",{key:"switch_p2p_type"}),this.controller.switchVideoToAudio().then(function(){return e.type=n.constantRtc.NETCALL_TYPE_AUDIO,Promise.resolve()})["catch"](function(e){return Promise.resolve(e)})},switchAudioToVideo:function(){var e=this;return this.controller.uploadDataApi("update",{key:"switch_p2p_type"}),this.controller.switchAudioToVideo().then(function(){return e.type=n.constantRtc.NETCALL_TYPE_VIDEO,Promise.resolve()})["catch"](function(e){return Promise.resolve(e)})},changeRoleToPlayer:function(){return 0===this.imInfo.role?Promise.resolve({role:"player"}):(this.imInfo.role=0,this.controller.switchRole().then(function(){return Promise.resolve({role:"player"})}))},changeRoleToAudience:function(){return 1===this.imInfo.role?Promise.resolve({role:"audience"}):(this.imInfo.role=1,this.controller.switchRole().then(function(){return Promise.resolve({role:"audience"})}))},updateRtmpUrl:function(e){return this.controller.setSessionConfig({rtmpUrl:e}),this.controller.updateRtmpUrl(e),Promise.resolve()},setSessionConfig:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.controller.setSessionConfig(e)},setSessionVideoQuality:function(e){this.controller.setSessionVideoQuality(e)},setSessionVideoFrameRate:function(e){this.controller.setSessionVideoFrameRate(e)},setSessionAudioQuality:function(e){this.controller.setSessionAudioQuality(e)},setCaptureVolume:function(e){return e=void 0===e?1:e/255,this.controller.setCaptureVolume(e)},setPlayVolume:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.constructor===String&&(e=+e),e.constructor===Number&&(e={volume:e}),e.volume=void 0===e.volume?1:e.volume/255,e.volume=e.volume>1?1:e.volume,this.controller.setPlayVolume(e)},destroyMediaStream:function(e){this.controller.destroyMediaStream({uid:e,type:"remote"})},updateRtmpHostVideo:function(e){var t=e.account,r=e.uid;return t&&(r=this.getUidWithAccount(t)),r?this.controller.updateRtmpHostVideo(r):Promise.reject("账号不在房间中，无法进行操作")}},e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0,t["default"]={getDevicesOfType:function(e){return this.controller.getDevicesOfType(e).then(function(e){return{devices:e}})},stopDevice:function(e){return this.controller.stopDevice(e)},startDevice:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.controller.startDevice(e)}},e.exports=t["default"]},function(e,t,r){"use strict";t.__esModule=!0;var n=r(40);t["default"]={startRecordMp4:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.controller.uploadDataApi("update",{key:"record"}),this.controller.startRecordMp4(e)},stopRecordMp4:function(){return this.controller.stopRecord()},startRecordAac:function(){return this.controller.uploadDataApi("update",{key:"audio_record"}),this.controller.startRecordAac()},stopRecordAac:function(){return this.controller.stopRecord()},setVideoViewSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.controller.setVideoViewSize(e)},setVideoViewRemoteSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.controller.setVideoViewRemoteSize(e)},startLocalStream:function(e){return this.controller.uploadDataApi("update",{key:"display"}),e=n.element.n2node(e),this.controller.startLocalStream(e)},stopLocalStream:function(){return this.controller.stopLocalStream()},startRemoteStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.node=n.element.n2node(e.node),e.account&&(e.uid=this.getUidWithAccount(e.account)),this.controller.startRemoteStream(e)},stopRemoteStream:function(e){return this.controller.stopRemoteStream(e)},suspendLocalStream:function(){return this.controller.suspendLocalStream()},resumeLocalStream:function(){return this.controller.resumeLocalStream()},suspendRemoteStream:function(e){return this.controller.suspendRemoteStream(e)},resumeRemoteStream:function(e){return this.controller.resumeRemoteStream(e)},setAudioStart:function(e){return this.controller.setAudioStart(e)},setAudioBlack:function(e){return this.controller.setAudioBlack(e)},setVideoBlack:function(e){return this.controller.setVideoBlack(e)},setVideoShow:function(e){return this.controller.setVideoShow(e)}},e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(7),o=n(i),a=r(17),s=n(a),c=r(16),u=n(c),d=r(146),l=n(d),p=r(117),f=r(49),h=r(67),m=r(306),v=n(m),g=r(303),y=n(g),S=r(302),b=n(S),_=r(304),C=n(_),T=r(301),w=n(T),R=r(305),E=n(R),O=null,P=function(e){function t(r){(0,o["default"])(this,t);var n=(0,s["default"])(this,e.call(this,r));return n.logger=r.logger||{},n.resetStatus(),n.init(),n}return(0,u["default"])(t,e),t.prototype.resetStatus=function(){this.rtc&&"closed"!==this.rtc.signalingState&&this.rtc.close(),this.stopStats(),this.stopAudioMonitor(),this.destroyLocalMediaStream(),this.destroyRemoteNode(),this._reset(),this.currRmoteOffer=null,this.rtc=null,this.rtcLogined=!1,this.rtcConnected=!1,this.reConnectCount=0,this.remote_SdpOffers=[],this.remoteStreams={},this.remoteNode={},this.currRemoteTrack={},this.deviceVideoStatus=!1,this.deviceAudioStatus=!1,this.monitorRemoteStreamStartTime=null,this.userJoinTimeoutId=null;
},t.prototype.destroy=function(){this.stopSession(),this.resetStatus(),this.mediaDevices=null,this.rtcRecorder=null,this.stats=null,this.statsNew=null,this.dataStats=null,this.dataRtc=null},t.prototype.init=function(){this.mediaDevices=new p.MDevices,this.mediaDevices.on("deviceStatus",this.onDeviceStatusChange.bind(this)),this.mediaDevices.on("deviceAdd",this.onDeviceAdd.bind(this)),this.mediaDevices.on("deviceRemove",this.onDeviceRemove.bind(this)),this.rtcRecorder=new p.Recorder,this.initStats(),h.RtcUtil.init(this.logger),p.Recorder.init(this.logger),p.MStream.init(this.logger),O||(O=h.RtcSupport.checkVersion())},t.prototype.startSession=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.imInfo=t,this.sessionConfig=Object.assign(this.sessionConfig,t.sessionConfig);var r=f.constantTool.getVideoSessionConfig({quality:this.sessionConfig.videoQuality,frameRate:this.sessionConfig.videoFrameRate});return this.imInfo=Object.assign(this.imInfo,{videoConfig:r}),this._startSession().then(function(t){return e.rtcLogin()}).then(function(t){e.startStats(),e.rtcLogined=!0;var r=e.mediaDevices.getDeviceStatus(),n=e.deviceAudioStatus&&r.hasAudio&&!e.imInfo.role||!1,i=e.deviceVideoStatus&&r.hasVideo&&!e.imInfo.role||!1;console.log("this.deviceAudioStatus",e.deviceAudioStatus),console.log("deviceStatus.hasAudio",r.hasAudio),console.log("this.imInfo.role",e.imInfo.role),(n||i)&&e.initRtc(),e.startAudioMonitor()})["catch"](function(e){return Promise.reject(e)})},t.prototype.stopSession=function(){var e=this;return this.stopStats(),this.rtcLogout(),this._stopSession(),this.stopRecord()["catch"](function(t){return e.logger.warn("webrtc-controller::停止音视频录制相关工作")}),this.resetStatus(),Promise.resolve()},t.prototype.initRtcEvent=function(e){var t=this;e&&(e.on("sessionConnected",function(){t.emit("sessionConnected")}),e.on("getRemoteStream",this.onRemoteStream.bind(this)),e.on("iceCandidate",this.onLocalIceCandidate.bind(this)),e.on("negotiationneeded",this.onNegotiationNeeded.bind(this)),e.on("icestatechange",this.onIceStateChange.bind(this)),this.mediaDevices.getDevices().then(function(e){t.emit("devices",e)}))},t.prototype.rtcLogin=function(){var e=this;return console.log("rtcLogin"),this.sendLocalMessage({isLogin:!0}),new Promise(function(t,r){e.once("LoginSuccess",function(r){e.logger.log("once LoginSuccess-->",r),t()}),e.once("LoginFailed",function(t){e.logger.log("once LoginFailed-->",t),r(t)})})},t.prototype.rtcLogout=function(){var e=Date.now(),t={params:{content:{timestamp:e}}};this.sendMsg("logout",t)},t.prototype.initRtc=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return console.log("initRtc"),this.rtc?Promise.resolve():(this.rtc=new v["default"]({imInfo:this.imInfo,logger:this.logger,sessionConfig:this.sessionConfig,controller:this}),this.initRtcEvent(this.rtc),this.uploadDataRtcStart(),this.updateRtcStream(),this.startRtc(e))},t.prototype.updateRtc=function(){var e=0===this.imInfo.role||"p2p"===this.imInfo.sessionMode;return e||this.rtc?this.rtc?(this.updateRtcStream(),this.createOffer({isUpdate:!0})):this.initRtc(!0):Promise.resolve()},t.prototype.startRtc=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=this.imInfo.sessionMode;return this.createOffer({isUpdate:t}).then(function(){return new Promise(function(t,n){e.once("sessionConnected",function(r){e.logger.log("rtc connect success"),e.rtcConnected=!0,e.setSessionConfig({rtcEndTime:Date.now()}),t(r)}),e.once("rtcConnectError",function(t){e.uploadDataRtcStop(),n(t)}),"p2p"===r&&(e.userJoinTimeoutId=setTimeout(function(){n("user join timeout")},5e4))})})["catch"](function(e){return Promise.reject(e)})},t.prototype.sendMsg=function(e,t){var r={type:e,uid:this.imInfo.uid+"",cid:this.imInfo.cid+""};r=Object.assign(r,t),this.signal&&this.logger.log("webrtc-controller::sendMsg ---> "+e,r),this.signal&&this.signal.send(r)},t.prototype.onSignalMessage=function(e){if(e&&e.cid&&e.uid&&(e.cid=+e.cid,e.uid=+e.uid),e.cid!==this.imInfo.cid)return this.logger.error("webrtc-controller::websocket message not belong to this session");var t=e.type;this["on"+t]&&this["on"+t](e)},t.prototype.hangup=function(){this.stopSession(),null!==this.userJoinTimeoutId&&(clearTimeout(this.userJoinTimeoutId),this.userJoinTimeoutId=null),this.resetStatus()},t.prototype.onSignalTimeout=function(e){this.emit("signalClosed"),this.resetStatus()},t.prototype.onlogin_ack=function(e){this.logger.log("onlogin_ack-->",e);var t=e.params.auth_res-0;return 200!==t?(this.logger.warn("服务器验证不通过, 断开连接"),this.emit("LoginFailed",{code:t,error:"服务器验证不通过, 断开连接"}),void this.stopSession()):(this.logger.log("音视频服务器登录成功",e),void this.emit("LoginSuccess"))},t.prototype.onclient_join=function(e){console.log("onclient_join, ",e),this.emit("userJoined",{uid:e.params.client_id,cid:this.imInfo.cid})},t.prototype._onclient_join=function(e){if(this.remoteNode[e])return this._onclient_update(e,!0);var t=new v["default"]({imInfo:this.imInfo,logger:this.logger,sessionConfig:this.sessionConfig,targetUid:e,controller:this});this.initRtcEvent(t),this.remoteNode[e]={isAudioEnable:!1,isVideoEnable:!1,container:this.info.remoteContainer,rtc:t},this.createOffer({rtc:t})},t.prototype.onclient_update=function(e){console.log("onclient_update, ",e,this.remoteNode[t]);var t=e.params.client_id,r=e.params,n=r.has_video,i=r.has_audio;return this.emit("remoteStreamUpdate",{uid:t,audio:i,video:n}),this.remoteNode[t]?"Firefox"===O.prefix&&O.version-0>=59?this._delayVideoShow(t,n):this._onclient_update(t,n):void(!i&&!n||this.remoteNode[t]||this._onclient_join(t))},t.prototype._onclient_update=function(e,t){if(!this.remoteNode[e])return void this._onclient_join(e);var r=this.remoteNode[e].rtc;r&&(t?this.createOffer({rtc:r}):this.delayVideoShow(e,t))},t.prototype.onclient_logout=function(e){var t=e.params.content.logout_type;t="normal"===t?f.constantRtc.HANGUP_TYPE_NORMAL:f.constantRtc.HANGUP_TYPE_TIMEOUT;var r=e.uid,n=e.cid;this.emit("leaveChannel",{uid:r,cid:n,type:t}),this.remoteNode.hasOwnProperty(r)&&(this.destroyRemoteNode(r),this.removeRemoteUserStream(r),this.rtcRecorder&&this.rtcRecorder.leave({uid:r}))},t.prototype.startAudioMonitor=function(){function e(){var e={},t=0;this.localAudioStream&&(t=this.localAudioStream.getAudioVolume()),e.self={status:t},this.uploadDataRtc("volume",e.self.status);var r=this.remoteNode;for(var n in r){var i=this.info.client.getAccountWithUid(n);t=r[n]&&r[n].remoteAudioStream?r[n].remoteAudioStream.getAudioVolume():0,e[i||n]={status:t}}this.emit("audioVolume",e)}var t=this.audioMonitorTimer;t||(t=this.audioMonitorTimer=setInterval(e.bind(this),500))},t.prototype.stopAudioMonitor=function(){var e=this.audioMonitorTimer;e&&(clearInterval(e),e=this.audioMonitorTimer=null)},t}(l["default"]),k=P.prototype;k=Object.assign(k,y["default"]),k=Object.assign(k,b["default"]),k=Object.assign(k,w["default"]),k=Object.assign(k,C["default"]),k=Object.assign(k,E["default"]),t["default"]=P,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(40),o=r(49),a=r(67),s=r(4),c=n(s),u=null,d="//"+c["default"].roomserver+"/v1/sdk/command/rooms/";t["default"]={switchRole:function(){return this.rtcLogined?(u||(u=a.RtcSupport.checkVersion()),"Firefox"!==u.prefix||"Firefox"===u.prefix&&u.version-0<59?this.updateRtc():(0===this.imInfo.role?(this.enableDevice(o.constantRtc.DEVICE_TYPE_AUDIO_IN),this.enableDevice(o.constantRtc.DEVICE_TYPE_VIDEO)):(this.disableDevice(o.constantRtc.DEVICE_TYPE_AUDIO_IN),this.disableDevice(o.constantRtc.DEVICE_TYPE_VIDEO)),this.rtcConnected?Promise.resolve():(0===this.imInfo.role&&this.updateRtc(),Promise.resolve()))):Promise.resolve()},switchVideoToAudio:function(){return this.rtcLogined?(this.localVideoStream&&this.disableDevice(o.constantRtc.DEVICE_TYPE_VIDEO),Promise.resolve()):Promise.reject("no connection")},switchAudioToVideo:function(){return this.rtcLogined?(this.localVideoStream&&this.enableDevice(o.constantRtc.DEVICE_TYPE_VIDEO),Promise.resolve()):Promise.reject("no connection")},setSessionConfig:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.sessionConfig=Object.assign(this.sessionConfig,e)},setSessionVideoQuality:function(e){void 0!==e&&this.setSessionConfig({videoQuality:e})},setSessionVideoFrameRate:function(e){void 0!==e&&this.setSessionConfig({videoFrameRate:e})},setSessionAudioQuality:function(e){this.setSessionConfig({highAudio:!!e})},startRecordMp4:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.account,r=e.uid;if(t)if(t===this.info.client.getAccount())r=this.imInfo.uid;else if(r=this.info.client.getUidWithAccount(t),!r)return Promise.reject("账号不在房间中，无法进行录制");t=t||this.info.client.getAccount();var n=[];if(r&&r-this.imInfo.uid!==0){var i=this.remoteNode[r];if(!i)return Promise.reject("需要录制的账号不正确");i.remoteAudioStream&&n.push(i.remoteAudioStream.stream),i.remoteVideoStream&&n.push(i.remoteVideoStream.stream)}else this.localAudioStream&&n.push(this.localAudioStream.stream),this.localVideoStream&&n.push(this.localVideoStream.stream);return 0===n.length?Promise.reject("当前没有音视频数据，无法进行录制"):this.rtcRecorder.start(n,{account:t,uid:r})},stopRecord:function(){return this.rtcRecorder.stop()},startRecordAac:function(){var e=this.info.client.getAccount(),t=this.imInfo.uid,r=[];this.localAudioStream&&r.push(this.localAudioStream.stream);var n=this.remoteNode;for(var i in n)n[i].remoteAudioStream&&n[i].remoteAudioStream.stream&&r.push(n[i].remoteAudioStream.stream);return this.rtcRecorder.start(r,{account:e,uid:t,type:"audio"})},updateRtmpUrl:function(){this.sendMsg("update_bypass_url",{params:{content:{bypass_url:this.sessionConfig.rtmpUrl}}})},updateRtmpHostVideo:function(e){if(!e)return Promise.reject("账号不在房间中，无法进行操作");var t=d+this.imInfo.cid,r=this.imInfo.turnToken||this.imInfo.serverMap&&this.imInfo.serverMap.token;return r?(0,i.ajax)({type:"post",url:t,data:{suid:this.imInfo.uid,cid:this.imInfo.cid,uid:+e,cmd:10001},header:{Token:r}}).then(function(e){if(200===e.code)return Promise.resolve();var t=void 0;switch(e.code){case 404:t="房间不存在";break;case 405:t="目标用户不在房间中";break;case 406:t="没有权限";break;case 417:t="请求数据不对";break;case 600:t="服务器内部错误";break;default:t="请求参数不正确"}return Promise.reject(t)}):Promise.reject("token缺失, 请检查")}},e.exports=t["default"]},function(e,t,r){"use strict";t.__esModule=!0;var n=r(117),i=r(49),o=r(67),a=null,s={audio:null,video:null,screen:null,debounceTime:500};t["default"]={getDeviceStatus:function(){return this.mediaDevices.getDeviceStatus()},getDevicesOfType:function(e){return this.mediaDevices.getDevicesOfType(i.constantTool.getDeviceTypeMap(e)).then(function(e){return Promise.resolve(e[0])})},onDeviceStatusChange:function(e){this.logger.log("webrtc-controller::onDeviceStatusChange:",e),this.emit("deviceStatus",e)},onDeviceAdd:function(e){this.logger.log("webrtc-controller::onDeviceAdd:",e),this.emit("deviceAdd",e)},onDeviceRemove:function(e){var t=this;this.logger.log("webrtc-controller::onDeviceRemove:",e),this.emit("deviceRemove",e),(this.localVideoStream||this.localAudioStream)&&e.forEach(function(e){t.localVideoStream&&e.deviceId===t.localVideoStream.constraint.video.deviceId&&(t.localVideoStream.destroy(),t.localVideoStream=null,t.client.devices.hasVideo=!1,t.rtcLogined&&t.updateRtc()),t.localAudioStream&&e.deviceId===t.localAudioStream.constraint.audio.deviceId&&(t.localAudioStream.destroy(),t.localAudioStream=null,t.client.devices.hasAudio=!1)})},checkDeviceStatus:function(e,t){return e===i.constantRtc.DEVICE_TYPE_VIDEO&&this.localVideoStream&&this.localVideoStream.constraint.video.deviceId===t.deviceId?(this.enableDevice(e),Promise.reject("设备已开启，重复操作")):e===i.constantRtc.DEVICE_TYPE_AUDIO_IN&&this.localAudioStream&&this.localAudioStream.audioStream&&this.localAudioStream.constraint.audio.deviceId===t.deviceId?(this.enableDevice(e),Promise.reject("设备已开启，重复操作")):Promise.resolve()},stopDevice:function(e){var t=this;return new Promise(function(r,n){if(e===i.constantRtc.DEVICE_TYPE_VIDEO){if(t.deviceVideoStatus=!1,a||(a=o.RtcSupport.checkVersion()),t.localVideoStream&&("Safari"===a.prefix||"Firefox"===a.prefix&&a.version-0>=59))return t.disableDevice(e).then(r,n);if(t.localVideoStream)return t.localVideoStream.destroy(),t.localVideoStream=null,t.rtcLogined&&t.updateRtc(),r()}else if(e===i.constantRtc.DEVICE_TYPE_AUDIO_IN){if(t.deviceAudioStatus=!1,t.localAudioStream)return t.localAudioStream.stopDevice(),r()}else e===i.constantRtc.DEVICE_TYPE_AUDIO_OUT_LOCAL?t.localAudioStream&&t.localAudioStream.setMuted(!0):e===i.constantRtc.DEVICE_TYPE_AUDIO_OUT_CHAT&&t.setAudioBlack();r()})},destroyDevice:function(e){this.logger.log("webrtc-controller::destroyDevice: 销毁设备",e);var t=e===i.constantRtc.DEVICE_TYPE_AUDIO_IN?"localAudioStream":"localVideoStream";return this[t]&&this[t].destroy(),this[t]=null,Promise.resolve()},disableDevice:function(e){this.logger.log("webrtc-controller::disableDevice: 暂停设备",e);var t=e===i.constantRtc.DEVICE_TYPE_AUDIO_IN?"localAudioStream":"localVideoStream",r=this[t]&&this[t].stream&&this[t].stream.getTracks()||[];return r.forEach(function(e){e.enabled=!1}),Promise.resolve()},enableDevice:function(e){this.logger.log("webrtc-controller::disableDevice: 恢复设备",e);var t=e===i.constantRtc.DEVICE_TYPE_AUDIO_IN?"localAudioStream":"localVideoStream",r=this[t]&&this[t].stream&&this[t].stream.getTracks()||[];return r.forEach(function(e){e.enabled=!0}),Promise.resolve()},startDevice:function(e){var t=this;return new Promise(function(r,n){var o=e.type,a=e.device,s=e.account,c=e.uid;if(o===i.constantRtc.DEVICE_TYPE_VIDEO&&(t.deviceVideoStatus=!0),o===i.constantRtc.DEVICE_TYPE_AUDIO_IN&&(t.deviceAudioStatus=!0),o===i.constantRtc.DEVICE_TYPE_AUDIO_OUT_LOCAL)return t.setAudioStart({uid:-1}),r();if(o===i.constantRtc.DEVICE_TYPE_AUDIO_OUT_CHAT)return t.setAudioStart({account:s,uid:c}),r();var u=Promise.resolve();o!==i.constantRtc.DEVICE_TYPE_DESKTOP_SCREEN&&o!==i.constantRtc.DEVICE_TYPE_DESKTOP_WINDOW&&(a&&a.deviceId||(u=t.getDevicesOfType(o))),u.then(function(e){return a=a||e&&e[0],t.checkDeviceStatus(o,a).then(function(){return o===i.constantRtc.DEVICE_TYPE_VIDEO?t.getStream("Video",a,r,n):o===i.constantRtc.DEVICE_TYPE_AUDIO_IN?t.getStream("Audio",a,r,n):o===i.constantRtc.DEVICE_TYPE_DESKTOP_SCREEN||o===i.constantRtc.DEVICE_TYPE_DESKTOP_WINDOW?t.getStream("Screen",o,r,n):void 0})["catch"](function(e){/重复操作/.test(e)?r():n(e)})}).then(function(e){r(e)})["catch"](function(e){n(e)})})},getStream:function(e,t,r,n){var i="_get"+e+"Stream";return s[e]&&s[e].lockerTimer&&(this.logger.log("webrtc-controller::destroy "+i+" timer"),clearTimeout(s[e].lockerTimer)),this.logger.log("webrtc-controller::create "+i+" timer"),s[e]={},this[i](t,r,n)},_getVideoStream:function(e,t,r){var s=this,c={};if(a||(a=o.RtcSupport.checkVersion()),this.localVideoStream&&("Safari"===a.prefix||"Firefox"===a.prefix&&a.version-0>=59))return this.enableDevice(i.constantRtc.DEVICE_TYPE_VIDEO).then(t,r);this.localVideoStream&&(this.localVideoStream.destroy(),this.localVideoStream=null);var u={};u.deviceId=e.deviceId;var d=i.constantTool.getVideoSessionConfig({quality:this.sessionConfig.videoQuality,frameRate:this.sessionConfig.videoFrameRate});return u=Object.assign(u,d),c.video=u,this.logger.log("webrtc-controller::_getVideoStream:",c),n.MStream.getLocalStream(c).then(function(r){s.localVideoStream=r,s.rtcLogined&&s.updateRtc(),t({device:e,stream:r})})["catch"](function(e){r(e)})},_getAudioStream:function(e,t,r){var i=this,o={};if(this.localAudioStream&&this.localAudioStream.audioStream)return this.enableDevice("audio").then(t);var a=e&&e.deviceId;return o.audio=!a||{deviceId:a},this.logger.log("webrtc-controller::_getAudioStream:",o),n.MStream.getLocalStream(o).then(function(r){i._initAudioStream(o,r),t({device:e,stream:r})})["catch"](function(e){r(e)})},_initAudioStream:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new MediaStream;this.localAudioStream?this.localAudioStream.updateStream(t):(this.localAudioStream=new n.MStream({stream:t,type:"audio",isRemote:!1,constraint:e}),this.rtcLogined&&this.updateRtc())},_getScreenStream:function(e,t,r){var o=this;this.localVideoStream&&(this.localVideoStream.destroy(),this.localVideoStream=null),e=e===i.constantRtc.DEVICE_TYPE_DESKTOP_SCREEN?"screen":"window";var a={audio:!1,video:{mediaSource:e}};return this.logger.log("webrtc-controller::_getScreenStream:",a),n.MStream.getLocalStream(a).then(function(e){o.localVideoStream=e,o.rtcLogined&&o.updateRtc()})["catch"](r)}},e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(117),o=r(61),a=n(o);t["default"]={destroyMediaStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{type:"all"};if("local"!==e.type&&"all"!==e.type||(this.destroyLocalMediaStream(),"local"!==e.type)){if("remote"===e.type)return void this.destroyRemoteMediaStream(e.uid);for(var t in this.remoteNode)this.destroyRemoteMediaStream(t);this.remoteNode={}}},destroyLocalMediaStream:function(){this.localAudioStream&&(this.localAudioStream.destroy(),this.localAudioStream=null),this.localVideoStream&&(this.localVideoStream.destroy(),this.localVideoStream=null)},destroyRemoteMediaStream:function(e){if(e&&this.remoteNode&&this.remoteNode[e]){var t=this.remoteNode[e];t.remoteVideoStream&&t.remoteVideoStream.destroy(),t.remoteAudioStream&&t.remoteAudioStream.destroy(),t.remoteVideoStream=null,t.remoteAudioStream=null,this.remoteNode[e]=null;var r=this.remoteStreams[e];this.switchTrackEvent({stream:r,uid:e,isOn:!1}),i.MStream.destroyMedia(r)}},setCaptureVolume:function(e){(void 0===e||e>1)&&(e=1),this.localAudioStream&&this.localAudioStream.setGain(e)},setPlayVolume:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.option={volume:e.volume},this.localAudioStream&&this.localAudioStream.setPlayVolume(e.volume),this.optionRemoteStream("setPlayVolume",e)},setAudioStart:function(e){var t=e.account,r=e.uid;return console.log("setAudioStart",r),r===-1?void(this.localAudioStream&&this.localAudioStream.show()&&this.localAudioStream.setMuted(!1)):this.optionRemoteStream("setMuted",{account:t,uid:r,isAudio:!0,option:!1})},setAudioBlack:function(e){return this.optionRemoteStream("setMuted",{account:e,isAudio:!0,option:!0})},setVideoBlack:function(e){return this.optionRemoteStream("hide",e)},setVideoShow:function(e){return this.optionRemoteStream("show",e)},setVideoViewSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.videoViewSizeOptions=e,this.localVideoStream&&this.localVideoStream.resize(this.videoViewSizeOptions)},setVideoViewRemoteSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.option=e,this.optionRemoteStream("resize",e)},startLocalStream:function(e){var t=this;if(this.localVideoStream){if(this.localVideoStream.container=e||this.info.container,!this.localVideoStream.container)return this.logger.error("webrtc-controller::startLocalStream:开启本地视频流失败 -> video容器节点缺失"),Promise.reject("开启本地视频流失败: video容器节点缺失");this.localVideoStream.resize(this.videoViewSizeOptions),this.localVideoStream.show(),this.localVideoStream.on("resize",function(e){t.emit("streamResize",e)}),this.localVideoStream.on("error",function(e){t.emit("error",e)}),this.localVideoStream.isShown()||this.updateRtcStream()}},stopLocalStream:function(){this.localVideoStream&&this.localVideoStream.hide()},startRemoteStream:function(){function e(e){e.container=t&&n||e.container,e.isVideoEnable=!0,e.remoteVideoStream&&(e.remoteVideoStream.resize(e.videoSizeOptions),e.remoteVideoStream.show(e.container,i))}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.uid,n=t.node,i=t.poster,o=void 0;if("p2p"===this.imInfo.sessionMode&&!r&&(r=this.info.client.target.uid,!this.info.remoteContainer&&!n))return Promise.reject("startRemoteStream失败：点对点模式实例化Netcall必须设置remoteContainer与target；或者参数必须包含account，node");if(o=this.remoteNode[r],r&&!o)return Promise.reject("未收到对应账号的音视频流信息，无法播放");if(n=n||this.info.remoteContainer,o)return o.container=t&&n||o.container,o.container?(e(o),Promise.resolve(o.remoteVideoStream.node)):Promise.reject(r+" 开启显示远端视频画面失败: 请传递video容器");var a=this.remoteNode;for(var s in a){if(a[s].container=t&&n||a[s].container,!a[s].container)return Promise.reject(r+" 开启显示远端视频画面失败: 请传递video容器");e(a[s])}return Promise.resolve()},stopRemoteStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.optionRemoteStream("hide",e)},suspendLocalStream:function(){return this.localVideoStream?(this.localVideoStream.pause(),Promise.resolve()):Promise.reject("本地没有音视频流，无法进行操作")},resumeLocalStream:function(){return this.localVideoStream?(this.localVideoStream.resume(),Promise.resolve()):Promise.reject("本地没有音视频流，无法进行操作")},suspendRemoteStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.optionRemoteStream("pause",e)},resumeRemoteStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.optionRemoteStream("resume",e)},optionRemoteStream:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.constructor===String&&(t={account:t}),t.fn=e;var r=t,n=r.account;return n&&n.constructor===Object&&(t=Object.assign(t,n),t.account.constructor===Object&&delete t.account),t.uid||a["default"].CURRENT.SDK_TYPE!==a["default"].SDK_TYPE.NRTC||(t.uid=t.account,delete t.account),this.doOptionRemoteStream(t)},doOptionRemoteStream:function(){function e(e){return o?(e.remoteAudioStream&&e.remoteAudioStream[r]&&e.remoteAudioStream[r](a),void(e.isAudioEnable=!0)):("resize"===r&&(e.videoSizeOptions=a||this.videoViewRemoteSizeOptions),e.remoteVideoStream&&e.remoteVideoStream[r]&&e.remoteVideoStream[r](a),void(e.isVideoEnable="hide"!==r))}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.fn,n=t.uid,i=t.account,o=t.isAudio,a=t.option,s=void 0;if(o=o||/(setPlayVolume|setGain)/.test(r),"p2p"!==this.imInfo.sessionMode||n||(n=this.info.client.target.uid),!n&&i&&(n=this.info.client.getUidWithAccount(i),!n))return Promise.reject("目标账号不正确或者未在当前会话中");if(n)return s=this.remoteNode[n],s&&e(s),Promise.resolve();s=this.remoteNode;for(var c in s)s[c]&&e(s[c]);return Promise.resolve()},addStream:function(e){!e||!this.localAudioStream}},e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(15),o=n(i),a=r(67),s=r(117),c=r(4),u=c.info.nrtcSdkVersion,d=null,l=3;t["default"]={destroyRemoteNode:function(e){if(e)return this.destroyRemoteRtc(e),void this.destroyRemoteMediaStream(e);var t=this.remoteNode;for(var r in t)this.destroyRemoteRtc(r),this.destroyRemoteMediaStream(r)},destroyRemoteRtc:function(e){if(e&&this.remoteNode&&this.remoteNode[e]){var t=this.remoteNode[e];t.rtc&&t.rtc.close()}},createOffer:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.isUpdate,n=void 0!==r&&r,i=t.rtc,o=void 0===i?this.rtc:i;return o.createOffer().then(function(e){return o.setLocalDescription(e,n)}).then(function(t){return e.sendOffer({offer:t,isUpdate:n,targetUid:o.targetUid}),Promise.resolve()})},sendOffer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.targetUid===this.imInfo.uid?this.sendLocalMessage(e):this.sendRemoteMessage(e)},sendLocalMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.offer,r=e.isUpdate,n=e.isLogin,i=void 0!==n&&n,o=this.imInfo,a=this.imInfo.videoConfig,s=this.sessionConfig||{},c=i?"client_login":r?"sdp_update":"sdp_offer",d=this.mediaDevices.getDeviceStatus(),l={session_mode:o.sessionMode||"p2p",record:{support_video_record:s.recordVideo||!1,support_audio_record:s.recordAudio||!1},bypass_rtmp:{is_host:!!s.rtmpUrl,support_bypass_rtmp:s.liveEnable||!1,support_bypass_rtmp_record:s.rtmpRecord||!1,bypass_rtmp_url:s.rtmpUrl||"",participant_mode:"M-"+s.splitMode,layout:s.layout||""},params:{version:+u,token:o.token||o.cid+"",user_type:o.token?3:2,user_token_type:0,content:i?"":t,streamSetting:{video:{width:a.width,height:a.height,frameRate:s.liveEnable&&a.frameRate>15?15:a.frameRate}},dst_id:this.imInfo.uid,is_multi_peerconnection:!0},hasAudio:!i&&(this.deviceAudioStatus&&d.hasAudio&&!this.imInfo.role||!1),hasVideo:!i&&(this.deviceVideoStatus&&d.hasVideo&&!this.imInfo.role||!1)};this.sendMsg(c,l)},sendRemoteMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.offer,r=e.targetUid,n=this.imInfo,i="sdp_offer",o={session_mode:n.sessionMode||"p2p",params:{token:n.token||n.cid+"",user_type:n.token?3:2,user_token_type:0,content:t,version:+u,dst_id:r,is_multi_peerconnection:!0}};this.sendMsg(i,o)},sendAnswer:function(e,t){var r=this.imInfo.videoConfig,n={params:{content:e,streamSetting:{video:r}}};t&&(n.params.dst_id=t),this.sendMsg("sdp_answer",n)},onsdp_answer:function(e){this.logger.log("webrtc-controller::onSdp_answer:uid -> ",e);var t=e.params.auth_res-0,r=e.params.dst_id||this.imInfo.uid;if(200!==t)return this.logger.error("webrtc-controller::onSdp_answer:服务器验证不通过, 断开连接"),this.emit("signalClosed",{code:t,error:"服务器验证不通过, 断开连接"}),void this.stopSession();var n=r-this.imInfo.uid===0?this.rtc:this.remoteNode[r].rtc;n&&n.setRemoteDescription(e.params.content,"answer")},onice_answer:function(e){var t=e.params.content,r=e.params.dst_id||this.imInfo.uid;"object"!==("undefined"==typeof t?"undefined":(0,o["default"])(t))&&(t={candidate:t});var n=r-this.imInfo.uid===0?this.rtc:this.remoteNode[r].rtc;n&&n.addRemoteIceCandidate(t)},monitorRemoteStream:function(e){if(this.remoteVideoStream||this.remoteAudioStream){if(!e.ssrc.remote||!e.ssrc.remote.total)return;var t=e.ssrc.remote.total;if(t.bytesReceivedRate>0||!this.monitorRemoteStreamStartTime)this.monitorRemoteStreamStartTime=Date.now();else{var r=Date.now();r-this.monitorRemoteStreamStartTime>1e4&&(this.logger.warn("webrtc-controller::monitorRemoteStream:10秒内未收到音视频数据"),this.emit("remoteStreamNoData"),this.monitorRemoteStreamStartTime=null)}}else this.monitorRemoteStreamStartTime=null},onRemoteStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.uid,r=e.stream,n=e.track;return window.myRemoteStreams=this.remoteStreams,window.myRemoteNode=this.remoteNode,this.logger.log("webrtc-controller::onRemoteStream:get remote stream",e),this.remoteStreams[t]=r,t?void this.doRemoteStream(r,t,n):this.logger.warn("webrtc-controller::onRemoteStream:无法找到远程流对应的uid!!,先暂存",r)},composeTrack:function(e,t,r,n){if(e!==this.imInfo.uid){var i=this.remoteNode[e],o=new MediaStream,a="audio"===r?"remoteAudioStream":"remoteVideoStream";o.addTrack(t),i[a]?i[a].updateStream(o):i[a]=new s.MStream({uid:e,stream:o,type:r,isRemote:!0,container:i.container}),this.logger.log("webrtc::composeTrack ",e,r,t.id,t.readyState),"audio"===r&&i.isAudioEnable&&i[a].show(),"video"===r&&this.delayVideoShow(e)}},delayVideoShow:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];setTimeout(function(){t._delayVideoShow(e,r)},100)},_delayVideoShow:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e&&e!==this.imInfo.uid){var r=this.remoteNode[e],n=r.remoteVideoStream;if(r&&n){if(console.log("_delayVideoShow",e,t),d||(d=a.RtcSupport.checkVersion()),"Firefox"!==d.prefix){var i={};r.isVideoEnable&&t&&(i=this.checkRemoteTrack(e,r.rtc.sdpAnswer.sdp)),t=i.video}var o=r.isVideoEnable&&t?"show":"hide";n[o]&&n[o](),"show"===o&&n.resize(r.videoSizeOptions||this.videoViewRemoteSizeOptions),this.logger.log("webrtc-controller::delayVideoShow: "+e+" video "+o)}}},switchTrackEvent:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.stream,n=t.uid,i=t.isOn,o=void 0===i||i;if(r&&n){if(!o)return r.onaddtrack=null,r.onremovetrack=null,this.logger.log("webrtc-controller::remove trackevent: onaddtrack",r.id),void this.logger.log("webrtc-controller::remove trackevent: onremovetrack",r.id);r.onaddtrack||(this.logger.log("webrtc-controller::add trackevent onaddtrack",r.id),r.onaddtrack=function(t){e.emit("addtrack",t);var i=t.track,o=i.kind;if(e.logger.log("webrtc-controller::on add track:",r.id,o,i.id,i.readyState),e.composeTrack(n,i,o),e.emit("remoteTrack",{uid:n,track:i}),"video"===o){var a=e.remoteNode[n].rtc,s=a.rtcConnection&&a.rtcConnection.remoteDescription.sdp;e.checkRemoteTrack(n,s),e.delayVideoShow(n)}}),r.onremovetrack||(this.logger.log("webrtc-controller::add trackevent onremovetrack",r.id),r.onremovetrack=function(t){var i=t.track,o=i.kind,a=e.remoteNode[n];a&&(e.logger.warn("webrtc-controller::on remove track:",r.id,o,i.id,i.readyState),e.emit("removetrack",t),"video"===o&&a.remoteVideoStream&&a.remoteVideoStream.hide())})}},doRemoteStream:function(e,t,r){/Firefox/gi.test(navigator.userAgent)?this.doRemoteStreamFirefox(e,t,r):this.doRemoteStreamChrome(e,t,r)},doRemoteStreamChrome:function(e,t){var r=this;this.logger.log("webrtc-controller::get "+t+" stream, track num: "+e.getTracks().length,e),e&&e.getTracks().forEach(function(e){r.logger.log("   > track id:",e.kind+":"+e.id,e)});var n=e.getAudioTracks()[0],i=e.getVideoTracks()[0];n&&this.composeTrack(t,n,"audio",e),i&&this.composeTrack(t,i,"video",e),this.switchTrackEvent({stream:e,uid:t}),n&&this.emit("remoteTrack",{uid:t,track:n}),i&&this.emit("remoteTrack",{uid:t,track:i})},doRemoteStreamFirefox:function(e,t,r){var n=this.remoteNode[t];if(n&&n.rtc){this.logger.log("webrtc-controller::get "+t+" track: ",r&&r.id,r),d||(d=a.RtcSupport.checkVersion());r&&(this.composeTrack(t,r,r.kind,e),this.emit("remoteTrack",{uid:t,track:r}))}},onLocalIceCandidate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger.log("webrtc-controller::onLocalIceCandidate",e);var t=e.uid,r=e.ice;if(!/\d tcp \d/gi.test(r.candidate)){var n={params:{content:r,dst_id:t}};this.sendMsg("ice_offer",n)}},onNegotiationNeeded:function(e){this.rtcConnected&&this.logger.log("webrtc-controller::onNegotiationNeeded",e.target)},onIceStateChange:function(e){var t=e.rtc,r=e.state,n=t.targetUid;if(this.logger.log("webrtc-controller::"+n+" ice connection state change to: "+r),"connected"===r&&n===this.imInfo.uid&&this.emit("sessionConnected"),"failed"===r){if(this.logger.error("webrtc-controller::"+n+" ice failed"),n-this.imInfo.uid===0)return void this.onLocalIceFail();this.onRemoteFail(n)}},onLocalIceFail:function(){var e=this;return l?(this.stopSession(),void this.emit("signalClosed")):(this.reConnectCount++,this.logger.log("webrtc-controller::3s后尝试第"+this.reConnectCount+"次重连服务器"),void setTimeout(function(){e.logger.log("webrtc-controller::假的重连")},3e3))},onRemoteFail:function(e){this.emit("remoteSignalClosed",e),this.remoteNode.hasOwnProperty(e)&&(this.destroyRemoteNode(e),this.removeRemoteUserStream(e),this.remoteNode[e]=null,delete this.remoteNode[e],this.rtcRecorder&&this.rtcRecorder.leave({uid:e}))},updateRtcStream:function(){var e=0===this.imInfo.role||"p2p"===this.imInfo.sessionMode;this.logger.log("webrtc-controller::updateRtcStream:role -> ",e?"player":"audience");var t=[];if(e){var r=this.localAudioStream,n=this.localVideoStream;r&&r.stream&&t.push(r.stream),n&&n.stream&&t.push(n.stream)}this.rtc&&this.rtc.updateStream(t)},removeRemoteUserStream:function(e){this.logger.log("webrtc-controller::removeRemoteUserStream:uid -> ",e),delete this.remoteNode[e]},checkRemoteTrack:function(e,t){var r=this.remoteNode[e];if(!r)return{};var n=r.remoteAudioStream&&r.remoteAudioStream.audioStream,i=r.remoteVideoStream&&r.remoteVideoStream.stream;if(!n&&!i||!r.rtc)return{};var o=r.rtc.checkMediaStatus({audio:n,video:i,sdp:t,uid:e});return this.logger.log("webrtc-controller::checkRemoteTrack:uid -> ",e,o),o.video||r.remoteVideoStream&&r.remoteVideoStream.hide(),o}},e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(61),o=n(i),a=r(49),s=r(67),c=r(152);
t["default"]={stopStats:function(){this.stats&&this.stats.stop(),this.statsNew&&this.statsNew.stop(),this.dataRtc&&this.dataRtc.stop(),this.dataStats&&this.dataStats.stop()},initStats:function(){var e=this;this.stats=new s.RtcStats({controller:this,interval:2e3}),this.stats.on("stats",function(t){e.monitorRemoteStream(t),e.uploadDataRtc(t)}),this.statsNew=new s.RtcStatsNew({controller:this,interval:1e3}),this.statsNew.on("stats",function(t){e.uploadDataRtcNew(t)}),this.dataRtc=(0,c.DataRtc)({appkey:this.info.appKey}),this.dataStats=(0,c.DataStats)({appkey:this.info.appKey})},startStats:function(){this.statsNew.start({controller:this}),this.uploadDataStatsStart()},uploadDataRtcStart:function(){this.info.appKey&&o["default"].STATS_FUN[o["default"].CURRENT.SDK_TYPE]&&this.dataRtc&&this.dataRtc.start({info:this.info,controller:this,imInfo:this.imInfo,sessionConfig:this.sessionConfig,videoConfig:this.imInfo.videoConfig,uid:this.imInfo.uid})},uploadDataRtcStop:function(){o["default"].STATS_RTC[o["default"].CURRENT.SDK_TYPE]&&this.dataRtc&&this.dataRtc.stop()},uploadDataRtcOnce:function(e){if(o["default"].STATS_RTC[o["default"].CURRENT.SDK_TYPE]&&this.dataRtc){var t=a.constantTool.getVideoSessionConfig({quality:this.sessionConfig.videoQuality,frameRate:this.sessionConfig.videoFrameRate});this.dataRtc.updateOnce({info:this.info,imInfo:e,sessionConfig:this.sessionConfig,videoConfig:t})}},uploadDataRtc:function(e,t){if(o["default"].STATS_RTC[o["default"].CURRENT.SDK_TYPE]&&this.info.appKey&&this.dataRtc)return"volume"===e?void this.dataRtc.updateLocalVolumn(t):void this.dataRtc.update(e,t)},uploadDataStatsStart:function(){o["default"].STATS_RTC[o["default"].CURRENT.SDK_TYPE]&&this.dataStats&&this.dataStats.start({info:this.info,cid:this.imInfo.cid,uid:this.imInfo.uid})},uploadDataRtcNewStop:function(){o["default"].STATS_RTC[o["default"].CURRENT.SDK_TYPE]&&this.dataStats&&this.dataStats.stop()},uploadDataRtcNew:function(e){o["default"].STATS_RTC[o["default"].CURRENT.SDK_TYPE]&&this.dataStats&&this.dataStats.update(e)}},e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(7),o=n(i),a=r(17),s=n(a),c=r(16),u=n(c),d=r(67);r(332);var l=r(20),p=function(e){function t(r){(0,o["default"])(this,t);var n=(0,s["default"])(this,e.call(this));return n.logger=r.logger,n.imInfo=r.imInfo,n.sessionConfig=r.sessionConfig,n.controller=r.controller,n.targetUid=r.targetUid||n.imInfo.uid,n.init(),n.isProgress=!1,n}return(0,u["default"])(t,e),t}(l);t["default"]=p;var f=p.prototype;f.resetStatus=function(){this.sdpOffer=null,this.sdpAnswer=null,this.iceOffer=[],this.iceAnswer=[],this.offerCount=0},f.setProgress=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isProgress=e,e===!1&&"completed"===this.rtcConnection.iceConnectionState&&this.emit("ready")},f.init=function(){var e=this;if(this.resetStatus(),!this.rtcConnection){var t=/Firefox/gi.test(navigator.userAgent),r={iceServers:[{url:"stun:turn.ideasip.com"}]},n=this.rtcConnection=new RTCPeerConnection(r);n.uid=this.imInfo.uid,n.targetUid=this.targetUid,n.onicecandidate=this.onIceCandidate.bind(this),n.onnegotiationneeded=this.onNegotiationneeded.bind(this),n.oniceconnectionstatechange=this.onIceStateChange.bind(this),t?n.ontrack=this.onRemoteTrack.bind(this):(n.onaddstream=this.onRemoteStream.bind(this),n.onremovestream=function(t){e.logger.warn("webrtc-rtc::",e.targetUid,"on remove stream:",t.stream)}),window.myRtc=n}},f.doSendIce=function(){if(this.sdpAnswer&&!this.iceCompleted&&0!==this.iceOffer.length){var e=this.iceOffer.shift();this.emit("iceCandidate",{uid:this.targetUid,ice:e}),this.doSendIce()}},f.onIceCandidate=function(e){if(e.candidate){if(/ tcp /gi.test(e.candidate.candidate))return;return this.logger.log("webrtc-rtc::",this.targetUid,"gather candidate",e.candidate.candidate),this.iceOffer.push(e.candidate),void this.offerCount++}this.logger.log("webrtc-rtc::",this.targetUid,"onicecandidate end"),this.doSendIce()},f.onIceStateChange=function(){if(this.rtcConnection){var e=this.rtcConnection.iceConnectionState;"connected"===e&&this.iceCompleted&&this.setProgress(!1),this.emit("icestatechange",{rtc:this,state:this.rtcConnection.iceConnectionState})}},f.onNegotiationneeded=function(e){this.emit("negotiationneeded",e)},f.getReceivers=function(){return this.rtcConnection.getReceivers()},f.getRemoteStreams=function(){return this.rtcConnection.getRemoteStreams()},f.onRemoteStream=function(e){if(this.targetUid!==this.imInfo.uid)return this.logger.log("webrtc-rtc::",this.targetUid,"on remote stream",e),!e.stream||e.stream&&"default"===e.stream.id?this.logger.log("webrtc-rtc::remote stream is default stream, do nothing"):void this.emit("getRemoteStream",{uid:this.targetUid,stream:e.stream})},f.onRemoteTrack=function(e){if(this.targetUid!==this.imInfo.uid){var t=e.streams[0];t&&this.emit("getRemoteStream",{uid:this.targetUid,stream:t,track:e.track})}},f.getIceConnectionState=function(){if(this.rtcConnection)return this.rtcConnection.iceConnectionState},f.checkNegotiation=function(){return!(0===this.oldTracks&&0===this.newTracks)},f.updateStream=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];d.RtcUtil.updateMediaStream({peer:this.rtcConnection,currStream:this.currStream,streams:t}).then(function(t){e.currStream||(e.currStream=t)})},f.removeTrack=function(e){d.RtcUtil.removeTrack({peer:this.rtcConnection,currStream:this.currStream,tracks:e})},f.createAnswer=function(e){var t=this;return this.setProgress(!0),this.rtcConnection.createAnswer().then(function(e){return e.sdp=d.SdpUtil.maybePreferVideoReceiveCodec(e.sdp,{videoRecvCodec:"H264"}),e=d.RtcUtil.formatSdp({offerOrAnswer:e,uid:t.imInfo.uid,cid:t.imInfo.cid,stream:t.currStream,highAudio:t.sessionConfig.highAudio,stero:t.sessionConfig.stero,targetUid:t.targetUid})})["catch"](function(e){t.logger.error("webrtc-rtc::",e)})},f.createOffer=function(){var e=this;return this.setProgress(!0),d.RtcUtil.createOffer(this.rtcConnection).then(function(t){return e.logger.log("\r\nwebrtc-rtc::","---------------netease: activity start----------------\r\n"),e.resetStatus(),t.sdp=d.SdpUtil.maybePreferVideoReceiveCodec(t.sdp,{videoRecvCodec:"H264"}),e.logger.log("webrtc-rtc::this.currentStream",e.currStream&&e.currStream.getTracks()),t=d.RtcUtil.formatSdp({offerOrAnswer:t,uid:e.imInfo.uid,cid:e.imInfo.cid,stream:e.currStream,highAudio:e.sessionConfig.highAudio,stero:e.sessionConfig.stero,targetUid:e.targetUid}),Promise.resolve(t)})["catch"](function(t){return e.logger.error("webrtc-rtc::createOffer",t),Promise.reject(t)})},f.getLocalSdp=function(){return this.rtcConnection.localDescription},f.getRemoteSdp=function(){return this.rtcConnection.remoteDescription},f.checkMediaStatus=function(e,t,r){return d.RtcUtil.checkMediaStatus(e,t,r)},f.logSdp=function(){this.rtcConnection.remoteDescription&&console.log("webrtc-rtc::remoteDescription after set",this.rtcConnection.remoteDescription.sdp),this.rtcConnection.currentRemoteDescription&&console.log("webrtc-rtc::currentRemoteDescription after set",this.rtcConnection.currentRemoteDescription.sdp)},f.setRemoteDescription=function(e,t){var r=this;"offer"===e.type&&this.logger.log("\r\nwebrtc-rtc::","---------------netease: activity start----------------\r\n"),this.setProgress("offer"===e.type),this.logger.log("webrtc-rtc::"+this.targetUid+" get remote sdp "+t+" --> "+e.type+"\n",e.sdp);var n={sdp:e.sdp,type:e.type};if("offer"===e.type&&!this.sdpAnswer)return Promise.reject();n.sdp=d.SdpUtil.maybePreferVideoSendCodec(n.sdp,{videoRecvCodec:"H264"}),n.sdp=d.RtcUtil.formatSdpRemote(n.sdp,this.sdpOffer),d.RtcUtil.parse(n.sdp),this.sdpAnswer="answer"===e.type?n:null;var i=this.rtcConnection;return i.setRemoteDescription(n).then(function(){if("answer"===e.type){if(r.iceCompleted)return void r.emit("iceCompleted");r.doSendIce()}return Promise.resolve()})["catch"](function(e){return console.error("webrtc-rtc::",i.uid," setRemoteDescription error: ",e),Promise.reject(e)})},f.setLocalDescription=function(e,t){var r=this;return this.sdpOffer=e,this.logger.log("webrtc-rtc::"+this.targetUid+" set local sdp "+e.type+"\n",e.sdp),this.rtcConnection.setLocalDescription(e).then(function(){return e.sdp=d.RtcUtil.setMediaBitrates({sdp:e.sdp}),"answer"===e.type?(r.sdpAnswer=e,r.iceCompleted&&r.emit("iceCompleted"),r.setProgress(!1)):r.sdpAnswer=null,Promise.resolve(e)})["catch"](function(t){return r.logger.warn(t),Promise.resolve(e)})},f.addRemoteIceCandidate=function(e){var t=this;this.logger.log("webrtc-rtc::"+this.targetUid+" set remote ICE ",e),this.rtcConnection.addIceCandidate(new RTCIceCandidate(e)).then(function(){t.iceAnswer.push(e),t.iceAnswer.length===t.offerCount&&(t.iceCompleted=!0,t.iceAnswer=[],t.offerCount=0,t.emit("iceCompleted"))})["catch"](function(e){t.logger.warn(e)})},f.close=function(){this.logger.log("webrtc-rtc::close rtc ",this.targetUid,this.rtcConnection),this.rtcConnection&&this.rtcConnection.close(),this.rtcConnection=null},e.exports=t["default"]},,,,function(e,t){"use strict";t.__esModule=!0,t["default"]={pipe:function(){var e=[].concat(Array.prototype.slice.call(arguments));return this._pipe(1===e.length?e[0]:e)},_pipe:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments[1],n=t.shift(),i=r&&r.constructor===Promise?r:Promise.resolve(r);return i.then(function(){return 0===t.length?e._pipeLast(n,r):e._pipeLast(n,r).then(function(r){return e._pipe(t,r)})})},_pipeLast:function(e,t){if(!e||e.constructor!==Function&&e.constructor!==Promise)return Promise.resolve(e);if(e.constructor===Promise)return e;if(e.constructor===Function){var r=e(t);return r&&r.constructor===Promise?r:Promise.resolve(r)}return Promise.resolve(e)}},e.exports=t["default"]},function(e,t,r){e.exports={"default":r(312),__esModule:!0}},function(e,t,r){r(70),r(71),r(72),r(323),r(324),r(325),e.exports=r(11).Promise},function(e,t){e.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e}},function(e,t,r){var n=r(45),i=r(317),o=r(316),a=r(14),s=r(69),c=r(322),u={},d={},t=e.exports=function(e,t,r,l,p){var f,h,m,v,g=p?function(){return e}:c(e),y=n(r,l,t?2:1),S=0;if("function"!=typeof g)throw TypeError(e+" is not iterable!");if(o(g)){for(f=s(e.length);f>S;S++)if(v=t?y(a(h=e[S])[0],h[1]):y(e[S]),v===u||v===d)return v}else for(m=g.call(e);!(h=m.next()).done;)if(v=i(m,y,h.value,t),v===u||v===d)return v};t.BREAK=u,t.RETURN=d},function(e,t){e.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},function(e,t,r){var n=r(26),i=r(3)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||o[i]===e)}},function(e,t,r){var n=r(14);e.exports=function(e,t,r,i){try{return i?t(n(r)[0],r[1]):t(r)}catch(o){var a=e["return"];throw void 0!==a&&n(a.call(e)),o}}},function(e,t,r){var n=r(3)("iterator"),i=!1;try{var o=[7][n]();o["return"]=function(){i=!0},Array.from(o,function(){throw 2})}catch(a){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var o=[7],a=o[n]();a.next=function(){return{done:r=!0}},o[n]=function(){return a},e(o)}catch(s){}return r}},function(e,t,r){var n=r(2),i=r(190).set,o=n.MutationObserver||n.WebKitMutationObserver,a=n.process,s=n.Promise,c="process"==r(41)(a);e.exports=function(){var e,t,r,u=function(){var n,i;for(c&&(n=a.domain)&&n.exit();e;){i=e.fn,e=e.next;try{i()}catch(o){throw e?r():t=void 0,o}}t=void 0,n&&n.enter()};if(c)r=function(){a.nextTick(u)};else if(!o||n.navigator&&n.navigator.standalone)if(s&&s.resolve){var d=s.resolve();r=function(){d.then(u)}}else r=function(){i.call(n,u)};else{var l=!0,p=document.createTextNode("");new o(u).observe(p,{characterData:!0}),r=function(){p.data=l=!l}}return function(n){var i={fn:n,next:void 0};t&&(t.next=i),e||(e=i,r()),t=i}}},function(e,t,r){var n=r(9);e.exports=function(e,t,r){for(var i in t)r&&e[i]?e[i]=t[i]:n(e,i,t[i]);return e}},function(e,t,r){"use strict";var n=r(2),i=r(11),o=r(10),a=r(8),s=r(3)("species");e.exports=function(e){var t="function"==typeof i[e]?i[e]:n[e];a&&t&&!t[s]&&o.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,r){var n=r(186),i=r(3)("iterator"),o=r(26);e.exports=r(11).getIteratorMethod=function(e){if(void 0!=e)return e[i]||e["@@iterator"]||o[n(e)]}},function(e,t,r){"use strict";var n,i,o,a,s=r(29),c=r(2),u=r(45),d=r(186),l=r(18),p=r(12),f=r(56),h=r(313),m=r(314),v=r(189),g=r(190).set,y=r(319)(),S=r(150),b=r(187),_=r(188),C="Promise",T=c.TypeError,w=c.process,R=c[C],E="process"==d(w),O=function(){},P=i=S.f,k=!!function(){try{var e=R.resolve(1),t=(e.constructor={})[r(3)("species")]=function(e){e(O,O)};return(E||"function"==typeof PromiseRejectionEvent)&&e.then(O)instanceof t}catch(n){}}(),I=function(e){var t;return!(!p(e)||"function"!=typeof(t=e.then))&&t},A=function(e,t){if(!e._n){e._n=!0;var r=e._c;y(function(){for(var n=e._v,i=1==e._s,o=0,a=function(t){var r,o,a=i?t.ok:t.fail,s=t.resolve,c=t.reject,u=t.domain;try{a?(i||(2==e._h&&D(e),e._h=1),a===!0?r=n:(u&&u.enter(),r=a(n),u&&u.exit()),r===t.promise?c(T("Promise-chain cycle")):(o=I(r))?o.call(r,s,c):s(r)):c(n)}catch(d){c(d)}};r.length>o;)a(r[o++]);e._c=[],e._n=!1,t&&!e._h&&x(e)})}},x=function(e){g.call(c,function(){var t,r,n,i=e._v,o=M(e);if(o&&(t=b(function(){E?w.emit("unhandledRejection",i,e):(r=c.onunhandledrejection)?r({promise:e,reason:i}):(n=c.console)&&n.error&&n.error("Unhandled promise rejection",i)}),e._h=E||M(e)?2:1),e._a=void 0,o&&t.e)throw t.v})},M=function(e){return 1!==e._h&&0===(e._a||e._c).length},D=function(e){g.call(c,function(){var t;E?w.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})})},L=function(e){var t=this;t._d||(t._d=!0,t=t._w||t,t._v=e,t._s=2,t._a||(t._a=t._c.slice()),A(t,!0))},j=function(e){var t,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw T("Promise can't be resolved itself");(t=I(e))?y(function(){var n={_w:r,_d:!1};try{t.call(e,u(j,n,1),u(L,n,1))}catch(i){L.call(n,i)}}):(r._v=e,r._s=1,A(r,!1))}catch(n){L.call({_w:r,_d:!1},n)}}};k||(R=function(e){h(this,R,C,"_h"),f(e),n.call(this);try{e(u(j,this,1),u(L,this,1))}catch(t){L.call(this,t)}},n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},n.prototype=r(320)(R.prototype,{then:function(e,t){var r=P(v(this,R));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=E?w.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&A(this,!1),r.promise},"catch":function(e){return this.then(void 0,e)}}),o=function(){var e=new n;this.promise=e,this.resolve=u(j,e,1),this.reject=u(L,e,1)},S.f=P=function(e){return e===R||e===a?new o(e):i(e)}),l(l.G+l.W+l.F*!k,{Promise:R}),r(30)(R,C),r(321)(C),a=r(11)[C],l(l.S+l.F*!k,C,{reject:function(e){var t=P(this),r=t.reject;return r(e),t.promise}}),l(l.S+l.F*(s||!k),C,{resolve:function(e){return _(s&&this===a?R:this,e)}}),l(l.S+l.F*!(k&&r(318)(function(e){R.all(e)["catch"](O)})),C,{all:function(e){var t=this,r=P(t),n=r.resolve,i=r.reject,o=b(function(){var r=[],o=0,a=1;m(e,!1,function(e){var s=o++,c=!1;r.push(void 0),a++,t.resolve(e).then(function(e){c||(c=!0,r[s]=e,--a||n(r))},i)}),--a||n(r)});return o.e&&i(o.v),r.promise},race:function(e){var t=this,r=P(t),n=r.reject,i=b(function(){m(e,!1,function(e){t.resolve(e).then(r.resolve,n)})});return i.e&&n(i.v),r.promise}})},function(e,t,r){"use strict";var n=r(18),i=r(11),o=r(2),a=r(189),s=r(188);n(n.P+n.R,"Promise",{"finally":function(e){var t=a(this,i.Promise||o.Promise),r="function"==typeof e;return this.then(r?function(r){return s(t,e()).then(function(){return r})}:e,r?function(r){return s(t,e()).then(function(){throw r})}:e)}})},function(e,t,r){"use strict";var n=r(18),i=r(150),o=r(187);n(n.S,"Promise",{"try":function(e){var t=i.f(this),r=o(e);return(r.e?t.reject:t.resolve)(r.v),t.promise}})},function(e,t,r){var n=function(){return this}()||Function("return this")(),i=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,o=i&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=r(327),i)n.regeneratorRuntime=o;else try{delete n.regeneratorRuntime}catch(a){n.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";function r(e,t,r,n){var o=t&&t.prototype instanceof i?t:i,a=Object.create(o.prototype),s=new f(n||[]);return a._invoke=u(e,r,s),a}function n(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(n){return{type:"throw",arg:n}}}function i(){}function o(){}function a(){}function s(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function c(e){function t(r,i,o,a){var s=n(e[r],e,i);if("throw"!==s.type){var c=s.arg,u=c.value;return u&&"object"==typeof u&&y.call(u,"__await")?Promise.resolve(u.__await).then(function(e){t("next",e,o,a)},function(e){t("throw",e,o,a)}):Promise.resolve(u).then(function(e){c.value=e,o(c)},a)}a(s.arg)}function r(e,r){function n(){return new Promise(function(n,i){t(e,r,n,i)})}return i=i?i.then(n,n):n()}var i;this._invoke=r}function u(e,t,r){var i=R;return function(o,a){if(i===O)throw new Error("Generator is already running");if(i===P){if("throw"===o)throw a;return m()}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var c=d(s,r);if(c){if(c===k)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===R)throw i=P,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=O;var u=n(e,t,r);if("normal"===u.type){if(i=r.done?P:E,u.arg===k)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=P,r.method="throw",r.arg=u.arg)}}}function d(e,t){var r=e.iterator[t.method];if(r===v){if(t.delegate=null,"throw"===t.method){if(e.iterator["return"]&&(t.method="return",t.arg=v,d(e,t),"throw"===t.method))return k;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return k}var i=n(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,k;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=v),t.delegate=null,k):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,k)}function l(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function p(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function f(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(l,this),this.reset(!0)}function h(e){if(e){var t=e[b];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function i(){for(;++r<e.length;)if(y.call(e,r))return i.value=e[r],i.done=!1,i;return i.value=v,i.done=!0,i};return n.next=n}}return{next:m}}function m(){return{value:v,done:!0}}var v,g=Object.prototype,y=g.hasOwnProperty,S="function"==typeof Symbol?Symbol:{},b=S.iterator||"@@iterator",_=S.asyncIterator||"@@asyncIterator",C=S.toStringTag||"@@toStringTag",T="object"==typeof e,w=t.regeneratorRuntime;if(w)return void(T&&(e.exports=w));w=t.regeneratorRuntime=T?e.exports:{},w.wrap=r;var R="suspendedStart",E="suspendedYield",O="executing",P="completed",k={},I={};I[b]=function(){return this};var A=Object.getPrototypeOf,x=A&&A(A(h([])));x&&x!==g&&y.call(x,b)&&(I=x);var M=a.prototype=i.prototype=Object.create(I);o.prototype=M.constructor=a,a.constructor=o,a[C]=o.displayName="GeneratorFunction",w.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},w.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,C in e||(e[C]="GeneratorFunction")),e.prototype=Object.create(M),e},w.awrap=function(e){return{__await:e}},s(c.prototype),c.prototype[_]=function(){return this},w.AsyncIterator=c,w.async=function(e,t,n,i){var o=new c(r(e,t,n,i));return w.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},s(M),M[C]="Generator",M[b]=function(){return this},M.toString=function(){return"[object Generator]"},w.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},w.values=h,f.prototype={constructor:f,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=v,this.done=!1,this.delegate=null,this.method="next",this.arg=v,this.tryEntries.forEach(p),!e)for(var t in this)"t"===t.charAt(0)&&y.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=v)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,n){return o.type="throw",o.arg=e,r.next=t,n&&(r.method="next",r.arg=v),!!n}if(this.done)throw e;for(var r=this,n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var a=y.call(i,"catchLoc"),s=y.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&y.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,k):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),k},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),p(r),k}},"catch":function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;p(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:h(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=v),k}}}(function(){return this}()||Function("return this")())},function(e,t,r){"use strict";function n(e,t,r,n,i){var o=u.writeRtpDescription(e.kind,t);if(o+=u.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=u.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":i||"active"),o+="a=mid:"+e.mid+"\r\n",o+=e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var s="msid:"+(n?n.id:"-")+" "+a+"\r\n";o+="a="+s,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+u.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+u.localCName+"\r\n"),o}function i(e,t){var r=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof n;return i&&(n=[n]),n=n.filter(function(e){var n=0===e.indexOf("turn:")&&e.indexOf("transport=udp")!==-1&&e.indexOf("turn:[")===-1&&!r;return n?(r=!0,!0):0===e.indexOf("stun:")&&t>=14393&&e.indexOf("?transport=udp")===-1}),delete e.url,e.urls=i?n[0]:n,!!n.length}})}function o(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},i=function(e,t,r,i){var o=n(e.parameters.apt,r),a=n(t.parameters.apt,i);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach(function(n){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(n.name.toLowerCase()===a.name.toLowerCase()&&n.clockRate===a.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&a.parameters.apt&&!i(n,a,e.codecs,t.codecs))continue;a=JSON.parse(JSON.stringify(a)),a.numChannels=Math.min(n.numChannels,a.numChannels),r.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var n=0;n<t.headerExtensions.length;n++){var i=t.headerExtensions[n];if(e.uri===i.uri){r.headerExtensions.push(i);break}}}),r}function a(e,t,r){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)!==-1}function s(e,t){var r=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return r||e.addRemoteCandidate(t),!r}function c(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}var u=r(197);e.exports=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function d(t,r){r.removeTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}function l(t,r,n,i){var o=new Event("track");o.track=r,o.receiver=n,o.transceiver={receiver:n},o.streams=i,e.setTimeout(function(){t._dispatchEvent("track",o)})}var p=function(r){var n=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){n[e]=o[e].bind(o)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this.localDescription=null,this.remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=i(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var a=r.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=u.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};p.prototype.onicecandidate=null,p.prototype.onaddstream=null,p.prototype.ontrack=null,p.prototype.onremovestream=null,p.prototype.onsignalingstatechange=null,p.prototype.oniceconnectionstatechange=null,p.prototype.onconnectionstatechange=null,p.prototype.onicegatheringstatechange=null,p.prototype.onnegotiationneeded=null,p.prototype.ondatachannel=null,p.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},p.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},p.prototype.getConfiguration=function(){return this._config},p.prototype.getLocalStreams=function(){return this.localStreams},p.prototype.getRemoteStreams=function(){return this.remoteStreams},p.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();n.iceTransport=i.iceTransport,n.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(n),n},p.prototype.addTrack=function(t,r){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n=this.transceivers.find(function(e){return e.track===t});if(n)throw c("InvalidAccessError","Track already exists.");for(var i,o=0;o<this.transceivers.length;o++)this.transceivers[o].track||this.transceivers[o].kind!==t.kind||(i=this.transceivers[o]);return i||(i=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(r)===-1&&this.localStreams.push(r),i.track=t,i.stream=r,i.rtpSender=new e.RTCRtpSender(t,i.dtlsTransport),i.rtpSender},p.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach(function(t){r.addTrack(t,e)});else{var n=e.clone();e.getTracks().forEach(function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})}),n.getTracks().forEach(function(e){r.addTrack(e,n)})}},p.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find(function(e){return e.rtpSender===t});if(!r)throw c("InvalidAccessError","Sender was not created by this connection.");var n=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null;var i=this.transceivers.map(function(e){return e.stream});i.indexOf(n)===-1&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},p.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var r=t.getSenders().find(function(t){return t.track===e});r&&t.removeTrack(r)})},p.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},p.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},p.prototype._createIceGatherer=function(t,r){var n=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;i.state=r?"completed":"gathering",null!==n.transceivers[t].bufferedCandidateEvents&&n.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},p.prototype._gather=function(t,r){var n=this,i=this.transceivers[r].iceGatherer;if(!i.onlocalcandidate){
var o=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,i.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),i.onlocalcandidate=function(e){if(!(n.usingBundle&&r>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:r};var a=e.candidate,s=!a||0===Object.keys(a).length;if(s)"new"!==i.state&&"gathering"!==i.state||(i.state="completed");else{"new"===i.state&&(i.state="gathering"),a.component=1,a.ufrag=i.getLocalParameters().usernameFragment;var c=u.writeCandidate(a);o.candidate=Object.assign(o.candidate,u.parseCandidate(c)),o.candidate.candidate=c,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var d=u.getMediaSections(n.localDescription.sdp);s?d[o.candidate.sdpMLineIndex]+="a=end-of-candidates\r\n":d[o.candidate.sdpMLineIndex]+="a="+o.candidate.candidate+"\r\n",n.localDescription.sdp=u.getDescription(n.localDescription.sdp)+d.join("");var l=n.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==n.iceGatheringState&&(n.iceGatheringState="gathering",n._emitGatheringStateChange()),s||n._dispatchEvent("icecandidate",o),l&&(n._dispatchEvent("icecandidate",new Event("icecandidate")),n.iceGatheringState="complete",n._emitGatheringStateChange())}},e.setTimeout(function(){o.forEach(function(e){i.onlocalcandidate(e)})},0)}},p.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var n=new e.RTCDtlsTransport(r);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:n}},p.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},p.prototype._transceive=function(e,r,n){var i=o(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:u.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),n&&e.rtpReceiver&&i.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?i.encodings=e.recvEncodingParameters:i.encodings=[{}],i.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(i.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},p.prototype.setLocalDescription=function(e){var t=this;if(["offer","answer"].indexOf(e.type)===-1)return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!a("setLocalDescription",e.type,t.signalingState)||t._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+t.signalingState));var r,n;if("offer"===e.type)r=u.splitSections(e.sdp),n=r.shift(),r.forEach(function(e,r){var n=u.parseRtpParameters(e);t.transceivers[r].localCapabilities=n}),t.transceivers.forEach(function(e,r){t._gather(e.mid,r)});else if("answer"===e.type){r=u.splitSections(t.remoteDescription.sdp),n=r.shift();var i=u.matchPrefix(n,"a=ice-lite").length>0;r.forEach(function(e,r){var a=t.transceivers[r],s=a.iceGatherer,c=a.iceTransport,d=a.dtlsTransport,l=a.localCapabilities,p=a.remoteCapabilities,f=u.isRejected(e)&&0===u.matchPrefix(e,"a=bundle-only").length;if(!f&&!a.rejected){var h=u.getIceParameters(e,n),m=u.getDtlsParameters(e,n);i&&(m.role="server"),t.usingBundle&&0!==r||(t._gather(a.mid,r),"new"===c.state&&c.start(s,h,i?"controlling":"controlled"),"new"===d.state&&d.start(m));var v=o(l,p);t._transceive(a,v.codecs.length>0,!1)}})}return t.localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?t._updateSignalingState("have-local-offer"):t._updateSignalingState("stable"),Promise.resolve()},p.prototype.setRemoteDescription=function(n){var i=this;if(["offer","answer"].indexOf(n.type)===-1)return Promise.reject(c("TypeError",'Unsupported type "'+n.type+'"'));if(!a("setRemoteDescription",n.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+n.type+" in state "+i.signalingState));var o={};i.remoteStreams.forEach(function(e){o[e.id]=e});var p=[],f=u.splitSections(n.sdp),h=f.shift(),m=u.matchPrefix(h,"a=ice-lite").length>0,v=u.matchPrefix(h,"a=group:BUNDLE ").length>0;i.usingBundle=v;var g=u.matchPrefix(h,"a=ice-options:")[0];return g?i.canTrickleIceCandidates=g.substr(14).split(" ").indexOf("trickle")>=0:i.canTrickleIceCandidates=!1,f.forEach(function(a,c){var l=u.splitLines(a),f=u.getKind(a),g=u.isRejected(a)&&0===u.matchPrefix(a,"a=bundle-only").length,y=l[0].substr(2).split(" ")[2],S=u.getDirection(a,h),b=u.parseMsid(a),_=u.getMid(a)||u.generateIdentifier();if("application"===f&&"DTLS/SCTP"===y||g)return void(i.transceivers[c]={mid:_,kind:f,rejected:!0});!g&&i.transceivers[c]&&i.transceivers[c].rejected&&(i.transceivers[c]=i._createTransceiver(f,!0));var C,T,w,R,E,O,P,k,I,A,x,M=u.parseRtpParameters(a);g||(A=u.getIceParameters(a,h),x=u.getDtlsParameters(a,h),x.role="client"),P=u.parseRtpEncodingParameters(a);var D=u.parseRtcpParameters(a),L=u.matchPrefix(a,"a=end-of-candidates",h).length>0,j=u.matchPrefix(a,"a=candidate:").map(function(e){return u.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===n.type||"answer"===n.type)&&!g&&v&&c>0&&i.transceivers[c]&&(i._disposeIceAndDtlsTransports(c),i.transceivers[c].iceGatherer=i.transceivers[0].iceGatherer,i.transceivers[c].iceTransport=i.transceivers[0].iceTransport,i.transceivers[c].dtlsTransport=i.transceivers[0].dtlsTransport,i.transceivers[c].rtpSender&&i.transceivers[c].rtpSender.setTransport(i.transceivers[0].dtlsTransport),i.transceivers[c].rtpReceiver&&i.transceivers[c].rtpReceiver.setTransport(i.transceivers[0].dtlsTransport)),"offer"!==n.type||g)"answer"!==n.type||g||(C=i.transceivers[c],T=C.iceGatherer,w=C.iceTransport,R=C.dtlsTransport,E=C.rtpReceiver,O=C.sendEncodingParameters,k=C.localCapabilities,i.transceivers[c].recvEncodingParameters=P,i.transceivers[c].remoteCapabilities=M,i.transceivers[c].rtcpParameters=D,j.length&&"new"===w.state&&(!m&&!L||v&&0!==c?j.forEach(function(e){s(C.iceTransport,e)}):w.setRemoteCandidates(j)),v&&0!==c||("new"===w.state&&w.start(T,A,"controlling"),"new"===R.state&&R.start(x)),i._transceive(C,"sendrecv"===S||"recvonly"===S,"sendrecv"===S||"sendonly"===S),!E||"sendrecv"!==S&&"sendonly"!==S?delete C.rtpReceiver:(I=E.track,b?(o[b.stream]||(o[b.stream]=new e.MediaStream),r(I,o[b.stream]),p.push([I,E,o[b.stream]])):(o["default"]||(o["default"]=new e.MediaStream),r(I,o["default"]),p.push([I,E,o["default"]]))));else{C=i.transceivers[c]||i._createTransceiver(f),C.mid=_,C.iceGatherer||(C.iceGatherer=i._createIceGatherer(c,v)),j.length&&"new"===C.iceTransport.state&&(!L||v&&0!==c?j.forEach(function(e){s(C.iceTransport,e)}):C.iceTransport.setRemoteCandidates(j)),k=e.RTCRtpReceiver.getCapabilities(f),t<15019&&(k.codecs=k.codecs.filter(function(e){return"rtx"!==e.name})),O=C.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var N=!1;if("sendrecv"===S||"sendonly"===S){if(N=!C.rtpReceiver,E=C.rtpReceiver||new e.RTCRtpReceiver(C.dtlsTransport,f),N){var V;I=E.track,b&&"-"===b.stream||(b?(o[b.stream]||(o[b.stream]=new e.MediaStream,Object.defineProperty(o[b.stream],"id",{get:function(){return b.stream}})),Object.defineProperty(I,"id",{get:function(){return b.track}}),V=o[b.stream]):(o["default"]||(o["default"]=new e.MediaStream),V=o["default"])),V&&(r(I,V),C.associatedRemoteMediaStreams.push(V)),p.push([I,E,V])}}else C.rtpReceiver&&C.rtpReceiver.track&&(C.associatedRemoteMediaStreams.forEach(function(e){var t=e.getTracks().find(function(e){return e.id===C.rtpReceiver.track.id});t&&d(t,e)}),C.associatedRemoteMediaStreams=[]);C.localCapabilities=k,C.remoteCapabilities=M,C.rtpReceiver=E,C.rtcpParameters=D,C.sendEncodingParameters=O,C.recvEncodingParameters=P,i._transceive(i.transceivers[c],!1,N)}}),void 0===i._dtlsRole&&(i._dtlsRole="offer"===n.type?"active":"passive"),i.remoteDescription={type:n.type,sdp:n.sdp},"offer"===n.type?i._updateSignalingState("have-remote-offer"):i._updateSignalingState("stable"),Object.keys(o).forEach(function(t){var r=o[t];if(r.getTracks().length){if(i.remoteStreams.indexOf(r)===-1){i.remoteStreams.push(r);var n=new Event("addstream");n.stream=r,e.setTimeout(function(){i._dispatchEvent("addstream",n)})}p.forEach(function(e){var t=e[0],n=e[1];r.id===e[2].id&&l(i,t,n,[r])})}}),p.forEach(function(e){e[2]||l(i,e[0],e[1],[])}),e.setTimeout(function(){i&&i.transceivers&&i.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},p.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},p.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},p.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&this.needNegotiation!==!0&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},p.prototype._updateIceConnectionState=function(){var e,t={"new":0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t["new"]>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},p.prototype._updateConnectionState=function(){var e,t={"new":0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t["new"]>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},p.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var i=r.transceivers.filter(function(e){return"audio"===e.kind}).length,o=r.transceivers.filter(function(e){return"video"===e.kind}).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(i=a.offerToReceiveAudio===!0?1:a.offerToReceiveAudio===!1?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(o=a.offerToReceiveVideo===!0?1:a.offerToReceiveVideo===!1?0:a.offerToReceiveVideo)}for(r.transceivers.forEach(function(e){"audio"===e.kind?(i--,i<0&&(e.wantReceive=!1)):"video"===e.kind&&(o--,o<0&&(e.wantReceive=!1))});i>0||o>0;)i>0&&(r._createTransceiver("audio"),i--),o>0&&(r._createTransceiver("video"),o--);var s=u.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach(function(n,i){var o=n.track,a=n.kind,s=n.mid||u.generateIdentifier();n.mid=s,n.iceGatherer||(n.iceGatherer=r._createIceGatherer(i,r.usingBundle));var c=e.RTCRtpSender.getCapabilities(a);t<15019&&(c.codecs=c.codecs.filter(function(e){return"rtx"!==e.name})),c.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),n.remoteCapabilities&&n.remoteCapabilities.codecs&&n.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),c.headerExtensions.forEach(function(e){var t=n.remoteCapabilities&&n.remoteCapabilities.headerExtensions||[];t.forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var d=n.sendEncodingParameters||[{ssrc:1001*(2*i+1)}];o&&t>=15019&&"video"===a&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1}),n.wantReceive&&(n.rtpReceiver=new e.RTCRtpReceiver(n.dtlsTransport,a)),n.localCapabilities=c,n.sendEncodingParameters=d}),"max-compat"!==r._config.bundlePolicy&&(s+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),s+="a=ice-options:trickle\r\n",r.transceivers.forEach(function(e,t){s+=n(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),s+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,s+="a="+u.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(s+="a=end-of-candidates\r\n"))});var d=new e.RTCSessionDescription({type:"offer",sdp:s});return Promise.resolve(d)},p.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var i=u.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(i+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var a=u.getMediaSections(r.remoteDescription.sdp).length;r.transceivers.forEach(function(e,s){if(!(s+1>a)){if(e.rejected)return"application"===e.kind?i+="m=application 0 DTLS/SCTP 5000\r\n":"audio"===e.kind?i+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(i+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(i+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");if(e.stream){var c;"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1})}var u=o(e.localCapabilities,e.remoteCapabilities),d=u.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length;!d&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,i+=n(e,u,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(i+="a=rtcp-rsize\r\n")}});var s=new e.RTCSessionDescription({type:"answer",sdp:i});return Promise.resolve(s)},p.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(n,i){if(!r.remoteDescription)return i(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var a=0;a<r.transceivers.length;a++)if(r.transceivers[a].mid===e.sdpMid){o=a;break}var d=r.transceivers[o];if(!d)return i(c("OperationError","Can not add ICE candidate"));if(d.rejected)return n();var l=Object.keys(e.candidate).length>0?u.parseCandidate(e.candidate):{};if("tcp"===l.protocol&&(0===l.port||9===l.port))return n();if(l.component&&1!==l.component)return n();if((0===o||o>0&&d.iceTransport!==r.transceivers[0].iceTransport)&&!s(d.iceTransport,l))return i(c("OperationError","Can not add ICE candidate"));var p=e.candidate.trim();0===p.indexOf("a=")&&(p=p.substr(2)),t=u.getMediaSections(r.remoteDescription.sdp),t[o]+="a="+(l.type?p:"end-of-candidates")+"\r\n",r.remoteDescription.sdp=u.getDescription(r.remoteDescription.sdp)+t.join("")}else for(var f=0;f<r.transceivers.length&&(r.transceivers[f].rejected||(r.transceivers[f].iceTransport.addRemoteCandidate({}),t=u.getMediaSections(r.remoteDescription.sdp),t[f]+="a=end-of-candidates\r\n",r.remoteDescription.sdp=u.getDescription(r.remoteDescription.sdp)+t.join(""),!r.usingBundle));f++);n()})},p.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(r){t[r]&&e.push(t[r].getStats())})});var t=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};return new Promise(function(r){var n=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(r){e[r].type=t(e[r]),n.set(r,e[r])})}),r(n)})})};var f=["createOffer","createAnswer"];return f.forEach(function(e){var t=p.prototype[e];p.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),f=["setLocalDescription","setRemoteDescription","addIceCandidate"],f.forEach(function(e){var t=p.prototype[e];p.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=p.prototype[e];p.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),p}},function(e,t,r){var n=r(330),i=r(331);t.write=i,t.parse=n.parse,t.parseFmtpConfig=n.parseFmtpConfig,t.parseParams=n.parseParams,t.parsePayloads=n.parsePayloads,t.parseRemoteCandidates=n.parseRemoteCandidates,t.parseImageAttributes=n.parseImageAttributes,t.parseSimulcastStreamList=n.parseSimulcastStreamList},function(e,t,r){var n=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,r,i){if(i&&!r)t[i]=n(e[1]);else for(var o=0;o<r.length;o+=1)null!=e[o+1]&&(t[r[o]]=n(e[o+1]))},o=function(e,t,r){var n=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:n&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:n?t[e.name]:t;i(r.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},a=r(196),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(s).forEach(function(e){var t=e[0],i=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var s=0;s<(a[t]||[]).length;s+=1){var c=a[t][s];if(c.reg.test(i))return o(c,n,i)}}),t.media=r,t};var c=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length&&(e[r[0]]=n(r[1])),e};t.parseParams=function(e){return e.split(/\;\s?/).reduce(c,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),i=0;i<r.length;i+=3)t.push({component:r[i],ip:r[i+1],port:r[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(c,{})})},t.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}})})}},function(e,t,r){var n=r(196),i=/%[sdv%]/g,o=function(e){var t=1,r=arguments,n=r.length;return e.replace(i,function(e){if(t>=n)return e;var i=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}})},a=function(e,t,r){var n=t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format,i=[e+"="+n];if(t.names)for(var a=0;a<t.names.length;a+=1){var s=t.names[a];t.name?i.push(r[t.name][s]):i.push(r[t.names[a]])}else i.push(r[t.name]);return o.apply(null,i)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var r=t.outerOrder||s,i=t.innerOrder||c,o=[];return r.forEach(function(t){n[t].forEach(function(r){r.name in e&&null!=e[r.name]?o.push(a(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){o.push(a(t,r,e))})})}),e.media.forEach(function(e){o.push(a("m",n.m[0],e)),i.forEach(function(t){n[t].forEach(function(r){r.name in e&&null!=e[r.name]?o.push(a(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){o.push(a(t,r,e))})})})}),o.join("\r\n")+"\r\n"}},function(e,t,r){(function(t){"use strict";var n=r(333);e.exports=n({window:t.window})}).call(t,function(){return this}())},function(e,t,r){"use strict";var n=r(73);e.exports=function(e,t){var i=e&&e.window,o={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var a in t)hasOwnProperty.call(t,a)&&(o[a]=t[a]);var s=n.log,c=n.detectBrowser(i),u={browserDetails:c,extractVersion:n.extractVersion,disableLog:n.disableLog,disableWarnings:n.disableWarnings},d=r(334)||null,l=r(337)||null,p=r(339)||null,f=r(341)||null,h=r(336)||null;switch(c.browser){case"chrome":if(!d||!d.shimPeerConnection||!o.shimChrome)return s("Chrome shim is not included in this adapter release."),u;s("adapter.js shimming chrome."),u.browserShim=d,h.shimCreateObjectURL(i),d.shimGetUserMedia(i),d.shimMediaStream(i),d.shimSourceObject(i),d.shimPeerConnection(i),d.shimOnTrack(i),d.shimAddTrackRemoveTrack(i),d.shimGetSendersWithDtmf(i),h.shimRTCIceCandidate(i);break;case"firefox":if(!p||!p.shimPeerConnection||!o.shimFirefox)return s("Firefox shim is not included in this adapter release."),u;s("adapter.js shimming firefox."),u.browserShim=p,h.shimCreateObjectURL(i),p.shimGetUserMedia(i),p.shimSourceObject(i),p.shimPeerConnection(i),p.shimOnTrack(i),p.shimRemoveStream(i),h.shimRTCIceCandidate(i);break;case"edge":if(!l||!l.shimPeerConnection||!o.shimEdge)return s("MS edge shim is not included in this adapter release."),u;s("adapter.js shimming edge."),u.browserShim=l,h.shimCreateObjectURL(i),l.shimGetUserMedia(i),l.shimPeerConnection(i),l.shimReplaceTrack(i);break;case"safari":if(!f||!o.shimSafari)return s("Safari shim is not included in this adapter release."),u;s("adapter.js shimming safari."),u.browserShim=f,h.shimCreateObjectURL(i),f.shimRTCIceServerUrls(i),f.shimCallbacksAPI(i),f.shimLocalStreamsAPI(i),f.shimRemoteStreamsAPI(i),f.shimTrackEventTransceiver(i),f.shimGetUserMedia(i),f.shimCreateOfferLegacy(i),h.shimRTCIceCandidate(i);break;default:s("Unsupported browser!")}return u}},function(e,t,r){"use strict";var n=r(73),i=n.log,o={shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return r._ontrackpoly||(r._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.track.id}):{track:n.track};var o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)}),t.stream.getTracks().forEach(function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.id}):{track:n};var o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)})},r.addEventListener("addstream",r._ontrackpoly)),t.apply(r,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var i=this,o=r.apply(i,arguments);return o||(o=t(i,e),i._senders.push(o)),o};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;n.apply(t,arguments);var r=t._senders.indexOf(e);r!==-1&&t._senders.splice(r,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;r._senders=r._senders||[],i.apply(r,[e]),e.getTracks().forEach(function(e){r._senders.push(t(r,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],o.apply(t,[e]),e.getTracks().forEach(function(e){var r=t._senders.find(function(t){return t.track===e});r&&t._senders.splice(t._senders.indexOf(r),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var r=this;return this._srcObject=e,this.src&&t.revokeObjectURL(this.src),e?(this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){r.src&&t.revokeObjectURL(r.src),r.src=t.createObjectURL(e)}),void e.addEventListener("removetrack",function(){r.src&&t.revokeObjectURL(r.src),r.src=t.createObjectURL(e)})):void(this.src="")}}))},shimAddTrackRemoveTrack:function(e){function t(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r})}function r(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r})}var i=n.detectBrowser(e);if(!(e.RTCPeerConnection.prototype.addTrack&&i.version>=64)){var o=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=o.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var a=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{},t.getTracks().forEach(function(e){var t=r.getSenders().find(function(t){return t.track===e});if(t)throw new DOMException("Track already exists.","InvalidAccessError")}),!r._reverseStreams[t.id]){var n=new e.MediaStream(t.getTracks());r._streams[t.id]=n,r._reverseStreams[n.id]=t,t=n}a.apply(r,[t])};var s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},s.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var o=n.getSenders().find(function(e){return e.track===t});if(o)throw new DOMException("Track already exists.","InvalidAccessError");n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{};var a=n._streams[r.id];if(a)a.addTrack(t),Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))});else{var s=new e.MediaStream([t]);n._streams[r.id]=s,n._reverseStreams[s.id]=r,n.addStream(s)}return n.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(r){var n=e.RTCPeerConnection.prototype[r];e.RTCPeerConnection.prototype[r]=function(){var e=this,r=arguments,i=arguments.length&&"function"==typeof arguments[0];return i?n.apply(e,[function(n){var i=t(e,n);r[0].apply(null,[i])},function(e){r[1]&&r[1].apply(null,e)},arguments[2]]):n.apply(e,arguments).then(function(r){return t(e,r)})}});var c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this;return arguments.length&&arguments[0].type?(arguments[0]=r(e,arguments[0]),c.apply(e,arguments)):c.apply(e,arguments)};var u=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=this,r=u.get.apply(this);return""===r.type?r:t(e,r)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===t.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");var r=e._pc===t;if(!r)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");t._streams=t._streams||{};var n;Object.keys(t._streams).forEach(function(r){var i=t._streams[r].getTracks().find(function(t){return e.track===t});i&&(n=t._streams[r])}),n&&(1===n.getTracks().length?t.removeStream(t._reverseStreams[n.id]):n.removeTrack(e.track),t.dispatchEvent(new Event("negotiationneeded")))}}},shimPeerConnection:function(e){var t=n.detectBrowser(e);if(e.RTCPeerConnection){var r=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(n.deprecated("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,i.push(a)):i.push(e.iceServers[o])}e.iceServers=i}return new r(e,t)},e.RTCPeerConnection.prototype=r.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return r.generateCertificate}})}else e.RTCPeerConnection=function(t,r){
return i("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,r)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}});var o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,r){var n=this,i=arguments;if(arguments.length>0&&"function"==typeof e)return o.apply(this,arguments);if(0===o.length&&(0===arguments.length||"function"!=typeof arguments[0]))return o.apply(this,[]);var a=function(e){var t={},r=e.result();return r.forEach(function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){r[t]=e.stat(t)}),t[r.id]=r}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var c=function(e){i[1](s(a(e)))};return o.apply(this,[c,arguments[0]])}return new Promise(function(e,t){o.apply(n,[function(t){e(s(a(t)))},t])}).then(t,r)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,n=new Promise(function(n,i){r.apply(t,[e[0],n,i])});return e.length<2?n:n.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(n,i){r.apply(e,[n,i,t])})}return r.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var a=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?a.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};e.exports={shimMediaStream:o.shimMediaStream,shimOnTrack:o.shimOnTrack,shimAddTrackRemoveTrack:o.shimAddTrackRemoveTrack,shimGetSendersWithDtmf:o.shimGetSendersWithDtmf,shimSourceObject:o.shimSourceObject,shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:r(335)}},function(e,t,r){"use strict";var n=r(73),i=n.log;e.exports=function(e){var t=n.detectBrowser(e),r=e&&e.navigator,o=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n="object"==typeof e[r]?e[r]:{ideal:e[r]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];var o={};"number"==typeof n.ideal?(o[i("min",r)]=n.ideal,t.optional.push(o),o={},o[i("max",r)]=n.ideal,t.optional.push(o)):(o[i("",r)]=n.ideal,t.optional.push(o))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",r)]=n.exact):["min","max"].forEach(function(e){void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,r)]=n[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,n){if(t.version>=61)return n(e);if(e=JSON.parse(JSON.stringify(e)),e&&"object"==typeof e.audio){var a=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};e=JSON.parse(JSON.stringify(e)),a(e.audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=o(e.audio)}if(e&&"object"==typeof e.video){var s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});var c=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||c)){delete e.video.facingMode;var u;if("environment"===s.exact||"environment"===s.ideal?u=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(u=["front"]),u)return r.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(e){return"videoinput"===e.kind});var r=t.find(function(e){return u.some(function(t){return e.label.toLowerCase().indexOf(t)!==-1})});return!r&&t.length&&u.indexOf("back")!==-1&&(r=t[t.length-1]),r&&(e.video.deviceId=s.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=o(e.video),i("chrome: "+JSON.stringify(e)),n(e)})}e.video=o(e.video)}return i("chrome: "+JSON.stringify(e)),n(e)},s=function(e){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},c=function(e,t,n){a(e,function(e){r.webkitGetUserMedia(e,t,function(e){n&&n(s(e))})})};r.getUserMedia=c;var u=function(e){return new Promise(function(t,n){r.getUserMedia(e,t,n)})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:u,enumerateDevices:function(){return new Promise(function(t){var r={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:r[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),r.mediaDevices.getUserMedia){var d=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return a(e,function(e){return d(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(s(e))})})}}else r.mediaDevices.getUserMedia=function(e){return u(e)};"undefined"==typeof r.mediaDevices.addEventListener&&(r.mediaDevices.addEventListener=function(){i("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof r.mediaDevices.removeEventListener&&(r.mediaDevices.removeEventListener=function(){i("Dummy mediaDevices.removeEventListener called.")})}},function(e,t,r){"use strict";function n(e,t,r){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);var o=function(e){n(r(e))};return this._eventMap=this._eventMap||{},this._eventMap[n]=o,i.apply(this,[e,o])};var o=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r])return o.apply(this,arguments);var n=this._eventMap[r];return delete this._eventMap[r],o.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)}})}}var i=r(197),o=r(73);e.exports={shimRTCIceCandidate:function(e){if(!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){"object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substr(2));var r=new t(e),n=i.parseCandidate(e.candidate),o=Object.assign(r,n);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o},n(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var r=t.createObjectURL.bind(t),n=t.revokeObjectURL.bind(t),i=new Map,a=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++a;return i.set(t,e),o.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return r(e)},t.revokeObjectURL=function(e){n(e),i["delete"](e)};var s=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return s.get.apply(this)},set:function(e){return this.srcObject=i.get(e)||null,s.set.apply(this,[e])}});var c=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=i.get(arguments[1])||null),c.apply(this,arguments)}}}}},function(e,t,r){"use strict";var n=r(73),i=r(328);e.exports={shimGetUserMedia:r(338),shimPeerConnection:function(e){var t=n.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCPeerConnection=i(e,t.version)},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},function(e,t){"use strict";e.exports=function(e){var t=e&&e.navigator,r=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e)["catch"](function(e){return Promise.reject(r(e))})}}},function(e,t,r){"use strict";var n=r(73),i={shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var r=new Event("track");r.track=t,r.receiver={track:t},r.transceiver={receiver:r.receiver},r.streams=[e.stream],this.dispatchEvent(r)}.bind(this))}.bind(this))}}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=n.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(r,n){if(t.version<38&&r&&r.iceServers){for(var i=[],o=0;o<r.iceServers.length;o++){var a=r.iceServers[o];if(a.hasOwnProperty("urls"))for(var s=0;s<a.urls.length;s++){var c={url:a.urls[s]};0===a.urls[s].indexOf("turn")&&(c.username=a.username,c.credential=a.credential),i.push(c)}else i.push(r.iceServers[o])}r.iceServers=i}return new e.mozRTCPeerConnection(r,n)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var i=function(e){var t=new Map;return Object.keys(e).forEach(function(r){t.set(r,e[r]),t[r]=e[r]}),t},o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,n){return a.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=i(e)),t.version<53&&!r)try{e.forEach(function(e){e.type=o[e.type]||e.type})}catch(n){if("TypeError"!==n.name)throw n;e.forEach(function(t,r){e.set(r,Object.assign({},t,{type:o[t.type]||t.type}))})}return e}).then(r,n)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;n.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(r){r.track&&e.getTracks().indexOf(r.track)!==-1&&t.removeTrack(r)})})}};e.exports={shimOnTrack:i.shimOnTrack,shimSourceObject:i.shimSourceObject,shimPeerConnection:i.shimPeerConnection,shimRemoveStream:i.shimRemoveStream,shimGetUserMedia:r(340)}},function(e,t,r){"use strict";var n=r(73),i=n.log;e.exports=function(e){var t=n.detectBrowser(e),r=e&&e.navigator,o=e&&e.MediaStreamTrack,a=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(e,n,o){var s=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n=e[r]="object"==typeof e[r]?e[r]:{ideal:e[r]};if(void 0===n.min&&void 0===n.max&&void 0===n.exact||t.push(r),void 0!==n.exact&&("number"==typeof n.exact?n.min=n.max=n.exact:e[r]=n.exact,delete n.exact),void 0!==n.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof n.ideal?i[r]={min:n.ideal,max:n.ideal}:i[r]=n.ideal,e.advanced.push(i),delete n.ideal,Object.keys(n).length||delete e[r]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(i("spec: "+JSON.stringify(e)),e.audio&&(e.audio=s(e.audio)),e.video&&(e.video=s(e.video)),i("ff37: "+JSON.stringify(e))),r.mozGetUserMedia(e,n,function(e){o(a(e))})},c=function(e){return new Promise(function(t,r){s(e,t,r)})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:c,addEventListener:function(){},removeEventListener:function(){}}),r.mediaDevices.enumerateDevices=r.mediaDevices.enumerateDevices||function(){return new Promise(function(e){var t=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];e(t)})},t.version<41){var u=r.mediaDevices.enumerateDevices.bind(r.mediaDevices);r.mediaDevices.enumerateDevices=function(){return u().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var d=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return d(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(a(e))})}}if(!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var l=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},p=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),l(e.audio,"autoGainControl","mozAutoGainControl"),l(e.audio,"noiseSuppression","mozNoiseSuppression")),p(e)},o&&o.prototype.getSettings){var f=o.prototype.getSettings;o.prototype.getSettings=function(){var e=f.apply(this,arguments);return l(e,"mozAutoGainControl","autoGainControl"),l(e,"mozNoiseSuppression","noiseSuppression"),e}}if(o&&o.prototype.applyConstraints){var h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),l(e,"autoGainControl","mozAutoGainControl"),l(e,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[e])}}}r.getUserMedia=function(e,i,o){return t.version<44?s(e,i,o):(n.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),void r.mediaDevices.getUserMedia(e).then(i,o))}}},function(e,t,r){"use strict";var n=r(73),i={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(r){r.id===e&&(t=r)}),this._remoteStreams&&this._remoteStreams.forEach(function(r){r.id===e&&(t=r)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.indexOf(e)===-1&&this._localStreams.push(e);var r=this;e.getTracks().forEach(function(n){t.call(r,n,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,r){return r&&(this._localStreams?this._localStreams.indexOf(r)===-1&&this._localStreams.push(r):this._localStreams=[r]),t.call(this,e,r)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(t!==-1){this._localStreams.splice(t,1);var r=this,n=e.getTracks();this.getSenders().forEach(function(e){n.indexOf(e.track)!==-1&&r.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){"object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];if(this._remoteStreams||(this._remoteStreams=[]),!(this._remoteStreams.indexOf(t)>=0)){this._remoteStreams.push(t);var r=new Event("addstream");r.stream=e.streams[0],this.dispatchEvent(r)}}.bind(this))}}))},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i};var s=function(e,t,r){var n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=s,s=function(e,t,r){var n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=s,s=function(e,t,r){var n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=s}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(n.deprecated("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,i.push(a)):i.push(e.iceServers[o])}e.iceServers=i}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var r=this;if(e){var n=r.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});e.offerToReceiveAudio===!1&&n?"sendrecv"===n.direction?n.setDirection("sendonly"):"recvonly"===n.direction&&n.setDirection("inactive"):e.offerToReceiveAudio!==!0||n||r.addTransceiver("audio");var i=r.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});e.offerToReceiveVideo===!1&&i?"sendrecv"===i.direction?i.setDirection("sendonly"):"recvonly"===i.direction&&i.setDirection("inactive"):e.offerToReceiveVideo!==!0||i||r.addTransceiver("video")}return t.apply(r,arguments)}}};e.exports={shimCallbacksAPI:i.shimCallbacksAPI,shimLocalStreamsAPI:i.shimLocalStreamsAPI,shimRemoteStreamsAPI:i.shimRemoteStreamsAPI,shimGetUserMedia:i.shimGetUserMedia,shimRTCIceServerUrls:i.shimRTCIceServerUrls,shimTrackEventTransceiver:i.shimTrackEventTransceiver,shimCreateOfferLegacy:i.shimCreateOfferLegacy}},,,,,,,,,,,,,,,,function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(152);Object.defineProperty(t,"monitor",{enumerable:!0,get:function(){return n(i)["default"]}});var o=r(135);Object.defineProperty(t,"signal",{enumerable:!0,get:function(){return n(o)["default"]}});var a=r(61);Object.defineProperty(t,"configMap",{enumerable:!0,get:function(){return n(a)["default"]}});var s=r(40);Object.defineProperty(t,"utils",{enumerable:!0,get:function(){return n(s)["default"]}})},,function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(7),o=n(i),a=r(17),s=n(a),c=r(16),u=n(c),d=r(357),l=r(49),p=r(40),f=r(145),h=n(f),m=r(300),v=n(m),g=r(299),y=n(g),S=r(298),b=n(S),_=r(297),C=n(_);d.configMap.CURRENT.SDK_TYPE=d.configMap.SDK_TYPE.NRTC;var T=function(e){function t(r){(0,o["default"])(this,t);var n=(0,s["default"])(this,e.call(this,r));return n.initNRTC(),n}return(0,u["default"])(t,e),t.prototype.initNRTC=function(){this.devices={hasAudio:!1,hasVideo:!1},this.initController()},t.prototype.initController=function(){var e=this;window.myNrtcContrl=this.controller=new v["default"]({logger:this.logger,container:this.container,remoteContainer:this.remoteContainer,client:this}),this.controller.on("sessionConnected",function(t){e.emit("sessionConnected",t)}),this.controller.on("signalClosed",function(t){e.emit("signalClosed",t)}),this.controller.on("remoteSignalClosed",function(t){e.emit("remoteSignalClosed",{uid:t})}),this.controller.on("userJoined",function(t){t.cid=e.imInfo.cid,e.emit("joinChannel",t)}),this.controller.on("leaveChannel",function(t){e.emit("leaveChannel",t)}),this.controller.on("remoteTrack",function(t){t.type=t.track.kind,e.emit("remoteTrack",t)}),this.controller.on("remoteStreamUpdate",function(t){e.emit("remoteStreamUpdate",t)}),this.controller.on("deviceStatus",function(t){e.emit("deviceStatus",t)}),this.controller.on("deviceAdd",function(t){e.emit("deviceAdd",t)}),this.controller.on("deviceRemove",function(t){e.emit("deviceRemove",t)}),this.controller.on("devices",function(t){e.emit("devices",t)}),this.controller.on("statistics",function(t){e.emit("statistics",t)}),this.controller.on("signalClosed",function(t){e.emit("signalClosed",t)}),this.controller.on("audioVolume",function(t){e.emit("audioVolume",t)})},t.prototype.startSession=function(){var e=this;return p.tool.verifyOptions(this.imInfo,"appkey cid uid token sessionMode wssArr"),this.controller.startSession(this.imInfo).then(function(t){return e.signalInited=!0,t})},t.prototype.stopSession=function(){var e=this;return this.controller.uploadDataApi("send"),this.controller.stopSession().then(function(t){return e.signalInited=!1,t})},t.prototype.startRtc=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.startSession(e)},t.prototype.joinChannel=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.cid=e.cid+"",e.uid=e.uid+"",p.tool.verifyOptions(e,"appkey cid uid token sessionMode wssArr"),e.liveEnable&&p.tool.verifyOptions(e,"turnToken");var t=Object.assign({},e.sessionConfig||{});if(this.imInfo=e,this.sessionMode=e.sessionMode,this.imInfo.token=e.token&&e.token+""||"",this.imInfo.turnToken=e.turnToken&&e.turnToken+""||"",this.imInfo.role=void 0===e.role?0:e.role,t.liveEnable=e.liveEnable||t.liveEnable,!e.wssArr)return Promise.reject("no wssArr");if(e.wssArr.constructor===String&&(e.wssArr=[e.wssArr]),e.appkey&&this.controller.setAppKey(e.appkey),this.imInfo.serverAddrs=e.wssArr,this.controller.uploadDataApi("start",{uid:this.imInfo.uid}),this.controller.uploadDataApi("update",{key:this.sessionMode}),t.highAudio&&this.controller.uploadDataApi("update",{key:"hd_audio"}),void 0!==t.videoFrameRate&&this.controller.uploadDataApi("update",{key:"fps",ext:0===+t.videoFrameRate?0:+t.videoFrameRate+1}),void 0!==t.videoQuality){var r=+t.videoQuality;r===l.constantRtc.CHAT_VIDEO_QUALITY_540P?r=l.constantRtc.CHAT_VIDEO_QUALITY_720P:r===l.constantRtc.CHAT_VIDEO_QUALITY_720P&&(r=l.constantRtc.CHAT_VIDEO_QUALITY_540P),this.controller.uploadDataApi("update",{key:"video_quality",ext:r||0})}return this.setSessionConfig(t),Promise.resolve(e)},t.prototype.leaveChannel=function(){return this.stopSession()},t.prototype.hangup=function(){return this.stopSession()},t.prototype.switchNetcallMode=function(e){e&&(this.imInfo.type=e)},t.prototype.destroy=function(){var e=this;this.controller.destroy(),this.controller=null,Object.keys(this).map(function(t){e[t]=null,delete e[t]})},t.prototype.control=function(){},t.prototype.onUserJoin=function(e){console.log("userjoin ----> from signal",e),this.emit("joinChannel",e)},t.prototype.sendCustomData=function(e){e&&this.controller(e)},t.prototype.setSessionConfig=function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.controller.setSessionConfig(this.sessionConfig)},t.prototype.setSessionVideoQuality=function(e){void 0!==e&&this.controller.setSessionConfig({videoQuality:e})},t.prototype.setSessionVideoFrameRate=function(e){void 0!==e&&this.controller.setSessionConfig({videoFrameRate:e})},t.prototype.setSessionAudioQuality=function(e){this.controller.setSessionConfig({highAudio:!!e})},t.prototype.changeRoleToPlayer=function(){return 0===this.imInfo.role?Promise.resolve({role:"player"}):(this.imInfo.role=0,this.controller.switchRole().then(function(){return Promise.resolve({role:"player"})}))},t.prototype.changeRoleToAudience=function(){return 1===this.imInfo.role?Promise.resolve({role:"audience"}):(this.imInfo.role=1,this.controller.switchRole().then(function(){return Promise.resolve({role:"audience"})}))},t.prototype.updateRtmpUrl=function(e){return this.controller.setSessionConfig({rtmpUrl:e}),this.controller.updateRtmpUrl(),Promise.resolve()},t.prototype.addStream=function(e){this.controller.addStream(e)},t}(h["default"]),w=T.prototype;w=Object.assign(w,y["default"]),w=Object.assign(w,b["default"]),w=Object.assign(w,C["default"]),t["default"]=T,e.exports=t["default"]}])});